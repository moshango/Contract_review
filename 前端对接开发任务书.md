# 前端对接开发任务书

## 📋 任务信息

**任务名称**：一键审查功能前后端对接  
**负责人**：前端工程师  
**预计工时**：2-3小时  
**优先级**：P0（高优先级）  
**截止日期**：本周内  

---

## 🎯 任务目标

将后端已完成的一键审查API对接到Vue3前端，实现完整的用户交互流程。

---

## 📝 需求描述

### 用户故事

```
作为 合同审查人员
我想要 一键上传合同并获得AI审查结果
以便 快速识别合同中的风险条款，提高审查效率
```

### 功能流程

```
1. 用户上传合同文件（.docx/.doc）
   ↓
2. 系统自动解析，提取甲方和乙方信息
   ↓
3. 用户选择审查立场（甲方/乙方/中立）
   ↓
4. 系统执行AI审查（5-10秒）
   ↓
5. 显示审查结果（检出X个问题）
   ↓
6. 用户可在线预览或下载带批注的文档
```

---

## 🔌 技术接口

### 接口1: 合同解析

**URL**: `POST /api/parse`

**请求**:
```javascript
FormData {
  file: File,           // 必填
  anchors: "generate",  // 固定值
  returnMode: "json"    // 固定值
}
```

**响应**:
```typescript
{
  filename: string      // "技术服务协议.docx"
  title: string        // "技术服务协议"
  partyA: string       // "广西商誉猫网络科技有限公司"
  partyB: string       // "中国银联股份有限公司"
  clauses: Array<{
    id: string
    anchorId: string
    heading: string
    fullText: string
  }>
  meta: {
    wordCount: number
    paragraphCount: number
  }
}
```

### 接口2: 一键审查

**URL**: `POST /api/qwen/rule-review/one-click-review`

**请求**:
```javascript
FormData {
  file: File,               // 必填（与接口1相同的文件）
  stance: "A方"|"B方"|"neutral"  // 必填
}
```

**响应**:
```typescript
{
  success: boolean
  message: string
  filename: string          // "xxx_一键审查_A方_20251103.docx"
  fileSize: number         // 245678
  issuesCount: number      // 5（检出的问题数）
  processingTime: number   // 8234（耗时ms）
  minioUrl: string         // "http://xxx/reports/xxx.docx"（用于预览）
  originalUrl: string      // "http://xxx/contracts/xxx.docx"（原文件）
  savedToMinio: boolean    // true
}
```

---

## 💻 实现要求

### UI组件要求

1. **步骤指示器** (ElSteps)
   - 4个步骤：上传文件 → 选择立场 → AI审查中 → 查看结果
   - 当前步骤高亮显示

2. **文件上传** (ElUpload)
   - 拖拽上传支持
   - 文件类型限制：.docx, .doc
   - 文件大小限制：50MB
   - 自动调用解析API

3. **立场选择** (卡片)
   - 3个可点击卡片：甲方、乙方、中立
   - 显示解析出的甲乙方名称
   - 当前选择高亮
   - 必须选择才能继续

4. **进度显示** (ElProgress)
   - 模拟进度条（0% → 100%）
   - 进度文字提示（解析中 → 规则匹配 → AI审查 → 生成批注）
   - Loading动画

5. **结果展示** (ElResult)
   - 成功图标
   - 显示检出问题数
   - 两个操作按钮：查看结果、下载文档

### 状态管理要求

```typescript
interface State {
  currentStep: 0 | 1 | 2 | 3  // 当前步骤
  uploadedFile: File | null    // 上传的文件对象
  parseResult: ParseResponse | null  // 解析结果
  selectedStance: 'A' | 'B' | 'neutral' | ''  // 选择的立场
  reviewResult: ReviewResponse | null  // 审查结果
  isReviewing: boolean  // 是否正在审查
  progress: number  // 进度值（0-100）
  progressText: string  // 进度文字
}
```

### 错误处理要求

| 错误场景 | 前端处理 |
|---------|---------|
| 文件格式错误 | ElMessage.error('只支持 .docx 和 .doc 格式') |
| 文件过大 | ElMessage.error('文件大小不能超过 50MB') |
| 解析失败 | ElMessage.error('文件解析失败，请检查文件是否损坏') |
| 审查超时 | ElMessage.error('审查超时，请重试') |
| 网络错误 | ElMessage.error('网络错误，请检查网络连接') |
| 服务不可用 | ElMessage.error('AI审查服务暂时不可用') |

---

## 🧪 测试用例

### 用例1：正常流程（甲方立场）

**步骤**:
1. 上传文件: `技术服务协议.docx`
2. 验证甲乙方: 显示"广西商誉猫网络科技有限公司"和"中国银联股份有限公司"
3. 选择立场: 点击"甲方"卡片
4. 提交审查: 点击"开始审查"
5. 等待完成: 显示进度条，约8秒
6. 查看结果: 显示"检出5个问题"
7. 在线预览: 点击"查看结果"，新窗口打开预览

**预期结果**: 所有步骤顺利完成，无错误提示

---

### 用例2：正常流程（乙方立场）

**步骤**: 同上，但选择"乙方"卡片

**预期结果**: 审查从乙方角度进行，检出问题可能不同

---

### 用例3：错误文件格式

**步骤**:
1. 上传文件: `test.pdf`（错误格式）

**预期结果**: 
- beforeUpload 拦截，显示错误提示
- 不调用后端API

---

### 用例4：超大文件

**步骤**:
1. 上传文件: `large_contract.docx`（60MB）

**预期结果**: 
- beforeUpload 拦截，显示"文件大小不能超过 50MB"
- 不调用后端API

---

### 用例5：网络超时

**步骤**:
1. 正常上传并选择立场
2. 断开网络
3. 点击"开始审查"

**预期结果**: 
- 显示进度条
- 60秒后超时
- 显示错误提示"审查超时，请重试"
- 返回立场选择页面

---

## 📊 验收标准

### 功能验收

- [ ] ✅ 可以正常上传.docx文件
- [ ] ✅ 可以正常上传.doc文件
- [ ] ✅ 自动解析并显示甲乙方
- [ ] ✅ 可以选择审查立场
- [ ] ✅ 审查过程有进度显示
- [ ] ✅ 审查完成显示问题数
- [ ] ✅ 可以在线预览结果
- [ ] ✅ 可以下载结果文档

### 性能验收

- [ ] ✅ 文件上传响应时间 < 2秒
- [ ] ✅ 整个审查流程 < 15秒
- [ ] ✅ 页面不卡顿
- [ ] ✅ 内存占用正常

### 体验验收

- [ ] ✅ 操作流程清晰
- [ ] ✅ 错误提示友好
- [ ] ✅ 加载状态明确
- [ ] ✅ 样式美观

### 兼容性验收

- [ ] ✅ Chrome浏览器正常
- [ ] ✅ Edge浏览器正常
- [ ] ✅ 不同分辨率适配

---

## 🚀 开发建议

### 开发顺序

1. **第1小时**：实现基础上传和解析
   - 创建组件骨架
   - 实现文件上传
   - 调用解析API
   - 显示甲乙方

2. **第2小时**：实现立场选择和审查
   - 实现立场选择UI
   - 调用一键审查API
   - 显示进度动画

3. **第3小时**：实现结果展示和优化
   - 结果页面
   - 在线预览
   - 错误处理
   - UI美化

### 技术选型

**推荐使用**:
- 组件库：Element Plus
- HTTP客户端：原生fetch（简单）或axios（功能丰富）
- 状态管理：Composition API（简单场景）或Pinia（复杂场景）
- 类型定义：TypeScript interface

**不推荐**:
- jQuery（过时）
- XMLHttpRequest（复杂）

---

## 📚 参考资料

### 代码参考

1. **已有实现**（可直接参考）:
   - `src/views/ContractReview/List.vue`
   - 第385-484行：submit() 方法
   - 第324-345行：handleUploadSuccess() 方法

2. **示例代码**（本任务书提供）:
   - 完整Vue组件示例
   - TypeScript类型定义
   - API Service层

### 文档参考

1. **完整技术文档**: `一键审查前后端对接文档.md`
2. **API Prompt**: `一键审查API对接Prompt.md`
3. **快速清单**: `前端对接超简洁清单.md`
4. **Postman集合**: `一键审查API.postman_collection.json`

### 后端API文档

- `Contract_review/文档中心/01_API接口说明/03_一键式审查API快速参考.md`

---

## 💬 沟通协作

### 需要后端协助

1. **API测试**: 使用Postman测试集合验证API
2. **错误调试**: 提供后端日志辅助排查
3. **参数确认**: 确认stance参数的准确值

### 需要产品确认

1. **交互细节**: 审查失败后是否需要返回上一步？
2. **进度显示**: 是否需要真实进度还是模拟进度？
3. **结果展示**: 是否需要显示详细的审查问题列表？

---

## ✅ 交付清单

### 代码交付

- [ ] Vue组件文件（.vue）
- [ ] TypeScript类型定义（.ts）
- [ ] API Service层（.ts）
- [ ] 样式文件（.scss）

### 文档交付

- [ ] 功能说明文档（Markdown）
- [ ] 测试报告（包含截图）
- [ ] 已知问题列表

### 测试交付

- [ ] 至少3个成功测试截图
- [ ] 错误处理测试截图
- [ ] 不同立场的测试结果对比

---

## 🏆 加分项

如果时间允许，可以实现以下增强功能：

1. **进度优化**
   - WebSocket实时进度推送
   - 更精确的进度估算

2. **结果优化**
   - 问题列表展示（表格形式）
   - 按风险等级分类显示
   - 问题统计图表

3. **交互优化**
   - 拖拽排序立场优先级
   - 批量文件上传
   - 历史记录保存

4. **性能优化**
   - 文件上传进度显示
   - 大文件分片上传
   - 结果缓存

---

## 🔍 自检清单

开发完成后，请逐项检查：

### 代码质量

- [ ] 代码符合项目规范
- [ ] TypeScript类型完整
- [ ] 无ESLint错误
- [ ] 无Console.error
- [ ] 变量命名清晰

### 功能完整性

- [ ] 所有步骤都能正常流转
- [ ] 所有API都正确调用
- [ ] 所有错误都有处理
- [ ] 所有Loading状态都有显示

### 用户体验

- [ ] 操作流程顺畅
- [ ] 等待时有反馈
- [ ] 错误提示清晰
- [ ] 样式美观统一

---

## 📞 技术支持

**后端负责人**: 查看 `Contract_review/` 目录下的文档  
**API测试工具**: `一键审查API.postman_collection.json`  
**测试脚本**: `测试一键审查API.bat`

**遇到问题请提供**:
1. 前端Console完整错误信息
2. Network面板的Request/Response
3. 后端日志（如果能访问）

---

## 📅 时间安排

| 时间段 | 任务 | 输出 |
|--------|------|------|
| **Day 1 上午** | 环境准备、需求理解 | 技术方案 |
| **Day 1 下午** | 核心功能开发 | 基础功能可用 |
| **Day 2 上午** | 错误处理、UI美化 | 完整功能 |
| **Day 2 下午** | 测试、修复Bug | 可交付版本 |

---

## 🎁 资源包

所有需要的资源已准备好：

```
Contract_review/
├── 一键审查前后端对接文档.md              ← 完整技术文档
├── 一键审查API对接Prompt.md               ← 开发Prompt
├── 前端对接超简洁清单.md                   ← 快速参考
├── 前端对接开发任务书.md                   ← 本文档
├── 一键审查API.postman_collection.json    ← Postman测试
└── 测试一键审查API.bat                     ← 快速测试脚本
```

**推荐阅读顺序**:
1. 前端对接超简洁清单.md（5分钟）
2. 一键审查API对接Prompt.md（10分钟）
3. 一键审查前后端对接文档.md（按需查阅）

---

**任务创建时间**: 2025-11-03  
**文档版本**: v1.0  
**状态**: 📋 待开发

