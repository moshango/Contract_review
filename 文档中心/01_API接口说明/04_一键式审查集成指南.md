# ä¸€é”®å¼å®¡æŸ¥åŠŸèƒ½é›†æˆæŒ‡å—

**æœ€åæ›´æ–°**: 2025-10-27
**çŠ¶æ€**: âœ… å®ç°å®Œæˆ

---

## æ¦‚è¿°

æœ¬æŒ‡å—å¸®åŠ©å¼€å‘è€…å¿«é€Ÿé›†æˆå’Œä½¿ç”¨ **ä¸€é”®å¼å®¡æŸ¥ï¼ˆOne-Click Reviewï¼‰** åŠŸèƒ½åˆ°ç°æœ‰çš„Webåº”ç”¨ä¸­ã€‚

---

## å‰ç½®æ¡ä»¶

### åç«¯é…ç½®

âœ… **å·²å®Œæˆçš„å‡†å¤‡å·¥ä½œ**ï¼š

1. **Spring Boot åº”ç”¨** - ç‰ˆæœ¬ 3.5.6+
2. **Qwen API é…ç½®** - åœ¨ `application.properties` ä¸­è®¾ç½®ï¼š
   ```properties
   qwen.api-key=sk-xxxxxxxxxxxxx
   qwen.base-url=https://dashscope.aliyuncs.com/compatible-mode/v1
   qwen.model=qwen-max-latest
   ```
3. **API ç«¯ç‚¹å·²å®ç°** - `/api/qwen/rule-review/one-click-review`
4. **æ–‡ä»¶ç³»ç»Ÿæƒé™** - åº”ç”¨æœ‰æƒé™å†™å…¥ `æ–‡æ¡£ä¸­å¿ƒ/å·²ç”Ÿæˆçš„å®¡æŸ¥æŠ¥å‘Š/` ç›®å½•

### æ–‡ä»¶æ ¼å¼æ”¯æŒ

- âœ… `.docx` - Word 2007+ æ ¼å¼
- âœ… `.doc` - Word 97-2003 æ ¼å¼
- âŒ å…¶ä»–æ ¼å¼ï¼ˆPDFã€TXTç­‰ï¼‰ä¸æ”¯æŒ

---

## å‰ç«¯é›†æˆ

### 1. HTML ç•Œé¢

#### æœ€å°åŒ–å®ç°

```html
<!-- æ–‡ä»¶ä¸Šä¼ è¡¨å• -->
<form id="reviewForm">
    <!-- æ–‡ä»¶é€‰æ‹© -->
    <div class="form-group">
        <label for="contractFile">åˆåŒæ–‡ä»¶</label>
        <input type="file" id="contractFile"
               accept=".docx,.doc"
               required>
    </div>

    <!-- ç«‹åœºé€‰æ‹© -->
    <div class="form-group">
        <label for="stance">å®¡æŸ¥ç«‹åœº</label>
        <select id="stance">
            <option value="neutral">ä¸­ç«‹</option>
            <option value="Aæ–¹">Aæ–¹ï¼ˆç”²æ–¹ï¼‰</option>
            <option value="Bæ–¹">Bæ–¹ï¼ˆä¹™æ–¹ï¼‰</option>
        </select>
    </div>

    <!-- æŒ‰é’® -->
    <button type="button" id="oneClickReviewBtn" class="btn btn-primary">
        ğŸš€ å¼€å§‹ä¸€é”®å®¡æŸ¥
    </button>
    <button type="button" id="cancelBtn" class="btn btn-secondary">
        å–æ¶ˆ
    </button>
</form>

<!-- è¿›åº¦æç¤º -->
<div id="progressContainer" style="display:none;">
    <p id="progressText">å®¡æŸ¥ä¸­...</p>
    <div class="progress">
        <div id="progressBar" class="progress-bar" style="width: 0%"></div>
    </div>
</div>
```

#### å®Œæ•´ Bootstrap å®ç°

```html
<div class="container mt-5">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h3>ğŸš€ AI æ™ºèƒ½åˆåŒå®¡æŸ¥</h3>
                    <p class="text-muted mb-0">ä¸€é”®å®ŒæˆåˆåŒè§£æã€å®¡æŸ¥å’Œæ‰¹æ³¨</p>
                </div>

                <div class="card-body">
                    <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
                    <div class="form-group mb-4">
                        <label class="form-label">
                            <strong>ğŸ“„ ä¸Šä¼ åˆåŒæ–‡ä»¶</strong>
                        </label>
                        <div class="input-group">
                            <input type="file"
                                   class="form-control"
                                   id="contractFile"
                                   accept=".docx,.doc"
                                   required>
                            <span class="input-group-text text-muted">
                                æ”¯æŒ .docx å’Œ .doc æ ¼å¼
                            </span>
                        </div>
                        <div id="fileInfo" class="mt-2 text-muted"></div>
                    </div>

                    <!-- ç«‹åœºé€‰æ‹© -->
                    <div class="form-group mb-4">
                        <label class="form-label">
                            <strong>ğŸ‘¥ é€‰æ‹©å®¡æŸ¥ç«‹åœº</strong>
                        </label>
                        <select id="stance" class="form-select">
                            <option value="neutral" selected>
                                âš–ï¸ ä¸­ç«‹ - å®¢è§‚ã€å¹³è¡¡çš„è§’åº¦
                            </option>
                            <option value="Aæ–¹">
                                ğŸ‘¤ Aæ–¹ï¼ˆç”²æ–¹ï¼‰- ä»Aæ–¹åˆ©ç›Šå‡ºå‘
                            </option>
                            <option value="Bæ–¹">
                                ğŸ‘¥ Bæ–¹ï¼ˆä¹™æ–¹ï¼‰- ä»Bæ–¹åˆ©ç›Šå‡ºå‘
                            </option>
                        </select>
                        <small class="form-text text-muted">
                            ä¸åŒçš„ç«‹åœºä¼šå½±å“å®¡æŸ¥çš„é‡ç‚¹å’Œå»ºè®®
                        </small>
                    </div>

                    <!-- è¿›åº¦æ˜¾ç¤º -->
                    <div id="progressContainer" style="display:none;" class="mb-4">
                        <div class="alert alert-info">
                            <p id="progressText" class="mb-0">
                                <span class="spinner-border spinner-border-sm me-2"></span>
                                å®¡æŸ¥ä¸­ï¼Œè¯·è€å¿ƒç­‰å¾…...
                            </p>
                        </div>
                        <div class="progress">
                            <div id="progressBar" class="progress-bar progress-bar-animated"
                                 style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- é”™è¯¯æ˜¾ç¤º -->
                    <div id="errorContainer" style="display:none;" class="mb-4">
                        <div class="alert alert-danger alert-dismissible fade show">
                            <button type="button" class="btn-close"
                                    data-bs-dismiss="alert"></button>
                            <strong>å®¡æŸ¥å¤±è´¥ï¼š</strong>
                            <span id="errorText"></span>
                        </div>
                    </div>

                    <!-- æ“ä½œæŒ‰é’® -->
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="button" id="oneClickReviewBtn"
                                class="btn btn-primary btn-lg">
                            ğŸš€ å¼€å§‹ä¸€é”®å®¡æŸ¥
                        </button>
                        <button type="button" id="cancelBtn"
                                class="btn btn-secondary btn-lg">
                            âŒ æ¸…é™¤
                        </button>
                    </div>
                </div>

                <div class="card-footer text-muted text-center">
                    <small>
                        å®¡æŸ¥è¿‡ç¨‹é€šå¸¸éœ€è¦ 5-10 ç§’ï¼Œç”Ÿæˆçš„æ–‡æ¡£ä¼šè‡ªåŠ¨ä¿å­˜åˆ°æ–‡æ¡£ä¸­å¿ƒ
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>
```

### 2. JavaScript å®ç°

#### åŸºç¡€å®ç°

```javascript
document.getElementById('oneClickReviewBtn').addEventListener('click', async function() {
    const fileInput = document.getElementById('contractFile');
    const stanceSelect = document.getElementById('stance');
    const progressContainer = document.getElementById('progressContainer');

    // éªŒè¯æ–‡ä»¶
    if (!fileInput.files || fileInput.files.length === 0) {
        alert('è¯·é€‰æ‹©åˆåŒæ–‡ä»¶');
        return;
    }

    // æ˜¾ç¤ºè¿›åº¦
    progressContainer.style.display = 'block';

    // æ„å»ºè¡¨å•æ•°æ®
    const formData = new FormData();
    formData.append('file', fileInput.files[0]);
    formData.append('stance', stanceSelect.value);

    try {
        // å‘é€è¯·æ±‚
        const response = await fetch('/api/qwen/rule-review/one-click-review', {
            method: 'POST',
            body: formData
        });

        // æ£€æŸ¥å“åº”çŠ¶æ€
        if (!response.ok) {
            const error = await response.json();
            throw new Error(error.error || 'å®¡æŸ¥å¤±è´¥');
        }

        // ä¸‹è½½æ–‡ä»¶
        const blob = await response.blob();
        downloadFile(blob, fileInput.files[0].name);

    } catch (error) {
        alert('å®¡æŸ¥å¤±è´¥: ' + error.message);
    } finally {
        progressContainer.style.display = 'none';
    }
});

// æ–‡ä»¶ä¸‹è½½è¾…åŠ©å‡½æ•°
function downloadFile(blob, originalName) {
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = originalName.replace(/\.docx?$/, '') + '_ä¸€é”®å®¡æŸ¥.docx';
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
}
```

#### å®Œæ•´å®ç°ï¼ˆå¸¦è¿›åº¦æ›´æ–°ï¼‰

```javascript
// ä¸€é”®å®¡æŸ¥åŠŸèƒ½å®Œæ•´å®ç°
class OneClickReview {
    constructor() {
        this.fileInput = document.getElementById('contractFile');
        this.stanceSelect = document.getElementById('stance');
        this.reviewBtn = document.getElementById('oneClickReviewBtn');
        this.cancelBtn = document.getElementById('cancelBtn');
        this.progressContainer = document.getElementById('progressContainer');
        this.progressText = document.getElementById('progressText');
        this.progressBar = document.getElementById('progressBar');
        this.errorContainer = document.getElementById('errorContainer');
        this.errorText = document.getElementById('errorText');
        this.fileInfo = document.getElementById('fileInfo');

        this.init();
    }

    init() {
        // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
        this.fileInput.addEventListener('change', (e) => this.onFileSelected(e));

        // æŒ‰é’®äº‹ä»¶
        this.reviewBtn.addEventListener('click', () => this.startReview());
        this.cancelBtn.addEventListener('click', () => this.reset());
    }

    onFileSelected(e) {
        const file = e.target.files[0];
        if (!file) return;

        const isValid = this.validateFile(file);
        if (!isValid) {
            this.showError('ä»…æ”¯æŒ .docx å’Œ .doc æ ¼å¼çš„Wordæ–‡ä»¶');
            this.fileInput.value = '';
            return;
        }

        // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
        const sizeMB = (file.size / 1024 / 1024).toFixed(2);
        this.fileInfo.innerHTML = `âœ“ å·²é€‰æ‹©: ${file.name} (${sizeMB} MB)`;
    }

    validateFile(file) {
        const validTypes = [
            'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
            'application/msword'
        ];
        const validExt = ['.docx', '.doc'];

        const hasValidType = validTypes.includes(file.type);
        const hasValidExt = validExt.some(ext => file.name.toLowerCase().endsWith(ext));

        return hasValidType || hasValidExt;
    }

    async startReview() {
        // éªŒè¯æ–‡ä»¶
        if (!this.fileInput.files || this.fileInput.files.length === 0) {
            this.showError('è¯·é€‰æ‹©åˆåŒæ–‡ä»¶');
            return;
        }

        // ç¦ç”¨æŒ‰é’®ï¼Œæ˜¾ç¤ºè¿›åº¦
        this.reviewBtn.disabled = true;
        this.progressContainer.style.display = 'block';
        this.errorContainer.style.display = 'none';

        try {
            await this.performReview();
        } catch (error) {
            this.showError(error.message);
        } finally {
            this.reviewBtn.disabled = false;
            this.progressContainer.style.display = 'none';
        }
    }

    async performReview() {
        const formData = new FormData();
        formData.append('file', this.fileInput.files[0]);
        formData.append('stance', this.stanceSelect.value);

        const steps = [
            'éªŒè¯æ–‡ä»¶...',
            'è§£æåˆåŒ...',
            'ç”Ÿæˆå®¡æŸ¥æç¤º...',
            'è°ƒç”¨AIå®¡æŸ¥...',
            'æ‰¹æ³¨æ–‡æ¡£...',
            'ä¿å­˜æ–‡ä»¶...'
        ];

        for (let i = 0; i < steps.length; i++) {
            this.updateProgress(i, steps[i]);
            await this.sleep(1000); // æ¨¡æ‹Ÿè¿›åº¦
        }

        // å‘é€è¯·æ±‚
        this.updateProgress(0, 'å‘é€å®¡æŸ¥è¯·æ±‚...');
        const response = await fetch('/api/qwen/rule-review/one-click-review', {
            method: 'POST',
            body: formData,
            timeout: 300000 // 5åˆ†é’Ÿè¶…æ—¶
        });

        if (!response.ok) {
            const error = await response.json().catch(() => ({ error: 'æœªçŸ¥é”™è¯¯' }));
            throw new Error(error.error || 'å®¡æŸ¥å¤±è´¥');
        }

        // ä¸‹è½½æ–‡ä»¶
        this.updateProgress(100, 'ä¸‹è½½æ–‡ä»¶...');
        const blob = await response.blob();
        this.downloadFile(blob, this.fileInput.files[0].name);

        // æˆåŠŸæç¤º
        setTimeout(() => {
            alert('âœ… å®¡æŸ¥å®Œæˆï¼æ–‡ä»¶å·²ä¸‹è½½ã€‚\nç”Ÿæˆçš„æ–‡æ¡£ä¹Ÿå·²ä¿å­˜åˆ°æ–‡æ¡£ä¸­å¿ƒã€‚');
            this.reset();
        }, 500);
    }

    updateProgress(progress, message) {
        this.progressBar.style.width = progress + '%';
        this.progressText.textContent = message;
    }

    downloadFile(blob, originalName) {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = originalName.replace(/\.docx?$/, '') + '_ä¸€é”®å®¡æŸ¥.docx';
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);
    }

    showError(message) {
        this.errorText.textContent = message;
        this.errorContainer.style.display = 'block';
    }

    reset() {
        this.fileInput.value = '';
        this.fileInfo.innerHTML = '';
        this.stanceSelect.value = 'neutral';
        this.errorContainer.style.display = 'none';
        this.progressContainer.style.display = 'none';
    }

    sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', () => {
    new OneClickReview();
});
```

---

## åç«¯é›†æˆ

### å·²å®ç°çš„å†…å®¹

âœ… **QwenRuleReviewController.java**
- æ–°å¢ `oneClickReview()` æ–¹æ³•
- å®Œæ•´çš„6æ­¥å·¥ä½œæµ
- æ–‡æ¡£å½’æ¡£åŠŸèƒ½
- é”™è¯¯å¤„ç†

âœ… **QwenRuleReviewService.java**
- æ–°å¢ `generateRuleReviewPrompt()` æ–¹æ³•
- åŠ¨æ€ç«‹åœºæ”¯æŒ
- å®Œæ•´çš„Promptç”Ÿæˆ

### å¦‚ä½•ä½¿ç”¨

**1. ç¡®ä¿ä¾èµ–å·²æ³¨å…¥**

åœ¨ `QwenRuleReviewController` ä¸­å·²æœ‰ï¼š

```java
@Autowired
private ContractParseService contractParseService;

@Autowired
private XmlContractAnnotateService xmlContractAnnotateService;

@Autowired
private QwenRuleReviewService qwenRuleReviewService;
```

**2. API å·²è‡ªåŠ¨æš´éœ²**

```
POST /api/qwen/rule-review/one-click-review
```

**3. æ— éœ€é¢å¤–é…ç½®**

åªéœ€ç¡®ä¿ `application.properties` ä¸­é…ç½®äº†Qwenä¿¡æ¯ã€‚

---

## ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯ 1ï¼šä¸­ç«‹å®¡æŸ¥

ç”¨æˆ·ä¸Šä¼ åˆåŒï¼Œä»¥ä¸­ç«‹ç«‹åœºè¿›è¡Œå®¡æŸ¥ï¼Œè·å–å®¢è§‚çš„æ³•å¾‹å»ºè®®ã€‚

```bash
curl -X POST "http://localhost:8080/api/qwen/rule-review/one-click-review" \
  -F "file=@contract.docx" \
  -o result.docx
```

### åœºæ™¯ 2ï¼šAæ–¹è§†è§’å®¡æŸ¥

ç”²æ–¹å¾‹å¸ˆä¸Šä¼ åˆåŒï¼Œä»ç”²æ–¹åˆ©ç›Šå‡ºå‘è¿›è¡Œå®¡æŸ¥ã€‚

```bash
curl -X POST "http://localhost:8080/api/qwen/rule-review/one-click-review" \
  -F "file=@contract.docx" \
  -F "stance=Aæ–¹" \
  -o result.docx
```

### åœºæ™¯ 3ï¼šBæ–¹è§†è§’å®¡æŸ¥

ä¹™æ–¹å¾‹å¸ˆä¸Šä¼ åˆåŒï¼Œä»ä¹™æ–¹åˆ©ç›Šå‡ºå‘è¿›è¡Œå®¡æŸ¥ã€‚

```bash
curl -X POST "http://localhost:8080/api/qwen/rule-review/one-click-review" \
  -F "file=@contract.docx" \
  -F "stance=Bæ–¹" \
  -o result.docx
```

---

## å¸¸è§é—®é¢˜è§£å†³

### Q: ä¸Šä¼ æ–‡ä»¶åæ— ååº”
**A**: æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯ã€‚å¸¸è§åŸå› ï¼š
- æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®
- QwenæœåŠ¡æœªé…ç½®
- ç½‘ç»œè¿æ¥é—®é¢˜

### Q: å®¡æŸ¥è¶…æ—¶
**A**: è°ƒæ•´è¶…æ—¶æ—¶é—´ï¼š
```javascript
fetch('/api/qwen/rule-review/one-click-review', {
    // ...
    timeout: 600000 // å¢åŠ åˆ°10åˆ†é’Ÿ
})
```

### Q: æ–‡æ¡£æ²¡æœ‰æ‰¹æ³¨
**A**: æ£€æŸ¥ï¼š
1. Qwenæ˜¯å¦æ­£ç¡®è¿”å›äº†JSONæ ¼å¼çš„å®¡æŸ¥ç»“æœ
2. æŸ¥çœ‹åç«¯æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯
3. ç¡®è®¤æ–‡æ¡£æ ¼å¼ä¸º.docx

### Q: æ–‡ä»¶ä¿å­˜ä½ç½®
**A**: æ£€æŸ¥é…ç½®ä¸­çš„é¡¹ç›®æ ¹ç›®å½•ï¼š
```
é¡¹ç›®æ ¹ç›®å½•/æ–‡æ¡£ä¸­å¿ƒ/å·²ç”Ÿæˆçš„å®¡æŸ¥æŠ¥å‘Š/
```

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### å‰ç«¯ä¼˜åŒ–

1. **å¼‚æ­¥å¤„ç†** - ä½¿ç”¨ `async/await` é¿å…é˜»å¡UI
2. **è¶…æ—¶å¤„ç†** - è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
3. **è¿›åº¦æç¤º** - å¤§æ–‡ä»¶æ—¶æ˜¾ç¤ºè¿›åº¦æ¡

### åç«¯ä¼˜åŒ–

1. **ç¼“å­˜** - ç¼“å­˜å¸¸ç”¨çš„å®¡æŸ¥è§„åˆ™
2. **å¹¶å‘** - æ”¯æŒå¤šä¸ªå¹¶å‘è¯·æ±‚
3. **æ—¥å¿—** - è®°å½•å¤„ç†æ—¶é—´ä¾¿äºæ€§èƒ½åˆ†æ

---

## ç›¸å…³æ–‡æ¡£

- **APIå¿«é€Ÿå‚è€ƒ**: [`03_ä¸€é”®å¼å®¡æŸ¥APIå¿«é€Ÿå‚è€ƒ.md`](../01_APIæ¥å£è¯´æ˜/03_ä¸€é”®å¼å®¡æŸ¥APIå¿«é€Ÿå‚è€ƒ.md)
- **å®ç°è¯¦æƒ…**: [`09_ä¸€é”®å¼å®¡æŸ¥åŠŸèƒ½å®ç°.md`](../02_å®ç°å’Œä¿®å¤æ€»ç»“/09_ä¸€é”®å¼å®¡æŸ¥åŠŸèƒ½å®ç°.md)
- **å¼€å‘è§„èŒƒ**: [`00_é¡¹ç›®å¼€å‘è§„èŒƒ.md`](../01_APIæ¥å£è¯´æ˜/00_é¡¹ç›®å¼€å‘è§„èŒƒ.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-10-27
