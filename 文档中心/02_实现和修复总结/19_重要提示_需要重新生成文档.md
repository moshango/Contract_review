# ⚠️ 重要提示：需要重新生成文档

## 问题说明

您检查的文件 `测试合同_C档_长文本版_一键审查_A.docx` **是用旧版本的代码生成的**，因此仍然缺少 `word/_rels/document.xml.rels` 文件，批注无法显示。

## 解决方案

### 必须重新生成文档

修复已经完成并编译通过，但是您需要：

1. **重启应用**（使用新编译的 JAR）
2. **重新运行一键审查**（上传长文档再次审查）
3. **下载新生成的文档**

这样才能获得包含完整 `document.xml.rels` 文件的新文档。

### 操作步骤

#### 1. 停止当前运行的应用

找到正在运行的后台进程并停止它。

#### 2. 使用新JAR启动应用

```bash
cd Contract_review
java -jar target/Contract_review-0.0.1-SNAPSHOT.jar
```

#### 3. 重新运行长文档审查

- 打开前端页面（http://localhost:4000）
- 上传长文档（测试合同_C档_长文本版.docx）
- 点击"一键审查"
- 等待审查完成并下载新文档

#### 4. 查看日志验证

在日志中搜索以下关键词，确认修复生效：

```
document.xml.rels不存在，先创建基本文件
【维测】创建/更新document.xml.rels完成，包含6个关系
【维测】✓ document.xml.rels在OPCPackage中
【维测】✓ document.xml.rels包含comments关系
```

#### 5. 验证新文档

使用解压工具（如 7-Zip）打开新生成的 DOCX 文件，检查：

```
✅ word/_rels/document.xml.rels 存在
✅ word/comments.xml 存在  
✅ document.xml.rels 内容包含 comments 关系
```

#### 6. 在 Word 中打开验证

- 在新文档中应该能看到批注
- 批注应该显示在正确的位置

## 为什么需要重新生成？

| 项目 | 旧文档 | 新文档（修复后） |
|------|--------|-----------------|
| 生成时间 | 修复前 | 修复后 |
| document.xml.rels | ❌ 缺失 | ✅ 存在 |
| 批注显示 | ❌ 无法显示 | ✅ 正常显示 |

**代码修复只是修复了生成逻辑**，已经生成的文档不会被自动更新，所以必须重新生成。

## 验证修复是否生效

如果您想快速验证修复是否生效，可以：

1. 重启应用后，查看日志中是否出现上述关键词
2. 对比新旧文档的文件结构（用解压工具）
3. 在新文档中确认批注是否显示

## 如果重新生成后仍然没有批注

如果重新生成后仍然没有批注，请：

1. **提供日志**：包含上述关键词的日志片段
2. **提供文档对比**：新旧文档的文件列表对比
3. **提供更多信息**：审查是否成功完成、AI是否检出了问题等

---

**总结**：您检查的 `测试合同_C档_长文本版_一键审查_A.docx` 是用旧代码生成的，需要重新生成才能看到批注。修复已经完成，只需重启应用并重新审查即可。


