# ä¸€é”®å®¡æŸ¥å‰ç«¯å¯¹æ¥è¶…ç®€æ´æ¸…å•

## âš¡ 60ç§’å¿«é€Ÿç†è§£

### æ ¸å¿ƒæµç¨‹ï¼ˆ3æ­¥ï¼‰

```
1. ä¸Šä¼ æ–‡ä»¶ â†’ /api/parse â†’ è·å–ç”²ä¹™æ–¹
          â†“
2. é€‰ç«‹åœº â†’ /api/qwen/rule-review/one-click-review â†’ ç­‰å¾…5-10ç§’
          â†“
3. è·å–ç»“æœ â†’ minioUrl â†’ åœ¨çº¿é¢„è§ˆæˆ–ä¸‹è½½
```

---

## ğŸ“¡ åªéœ€å¯¹æ¥2ä¸ªAPI

### API #1: è§£æåˆåŒ

```javascript
// è¯·æ±‚
POST /api/parse
FormData: { file, anchors: "generate", returnMode: "json" }

// å“åº”
{
  filename: "xxx.docx",
  partyA: "ç”²æ–¹å…¬å¸å",
  partyB: "ä¹™æ–¹å…¬å¸å",
  clauses: [...]
}
```

### API #2: ä¸€é”®å®¡æŸ¥

```javascript
// è¯·æ±‚
POST /api/qwen/rule-review/one-click-review
FormData: { file, stance: "Aæ–¹" }  // stance: "Aæ–¹"/"Bæ–¹"/"neutral"

// å“åº”
{
  success: true,
  minioUrl: "http://xxx/reports/xxx.docx",  // ç”¨äºé¢„è§ˆ
  originalUrl: "http://xxx/contracts/xxx.docx",  // åŸå§‹æ–‡ä»¶
  issuesCount: 5,  // æ£€å‡ºé—®é¢˜æ•°
  processingTime: 8234  // è€—æ—¶(ms)
}
```

---

## ğŸ’» 3åˆ†é’Ÿæç®€å®ç°

### Vue3 ä»£ç ï¼ˆå¤åˆ¶å³ç”¨ï¼‰

```vue
<script setup lang="ts">
import { ref } from 'vue'
import { ElMessage } from 'element-plus'

// çŠ¶æ€
const step = ref(0)  // 0:ä¸Šä¼  1:é€‰ç«‹åœº 2:å®¡æŸ¥ä¸­ 3:å®Œæˆ
const file = ref<File>()
const partyA = ref('')
const partyB = ref('')
const stance = ref<'A'|'B'|'neutral'>()
const minioUrl = ref('')

// æ­¥éª¤1: ä¸Šä¼ å¹¶è§£æ
async function upload(f: File) {
  const fd = new FormData()
  fd.append('file', f)
  fd.append('anchors', 'generate')
  fd.append('returnMode', 'json')
  
  const res = await fetch('/api/parse', { method: 'POST', body: fd })
  const data = await res.json()
  
  file.value = f
  partyA.value = data.partyA
  partyB.value = data.partyB
  step.value = 1
}

// æ­¥éª¤2: å¼€å§‹å®¡æŸ¥
async function review() {
  step.value = 2
  
  const fd = new FormData()
  fd.append('file', file.value!)
  fd.append('stance', stance.value === 'A' ? 'Aæ–¹' : stance.value === 'B' ? 'Bæ–¹' : 'neutral')
  
  const res = await fetch('/api/qwen/rule-review/one-click-review', { 
    method: 'POST', 
    body: fd 
  })
  const data = await res.json()
  
  if (data.success) {
    minioUrl.value = data.minioUrl
    step.value = 3
    ElMessage.success(`å®¡æŸ¥å®Œæˆï¼æ£€å‡º ${data.issuesCount} ä¸ªé—®é¢˜`)
  }
}

// æ­¥éª¤3: æŸ¥çœ‹ç»“æœ
function view() {
  window.open(`/#/contract-review/editor?fileUrl=${encodeURIComponent(minioUrl.value)}`)
}
</script>
```

---

## âœ… å¯¹æ¥æ£€æŸ¥æ¸…å•

### å¼€å‘å‰ï¼ˆ5åˆ†é’Ÿï¼‰

- [ ] ç¡®è®¤åç«¯å·²å¯åŠ¨ï¼ˆhttp://localhost:8080ï¼‰
- [ ] æµ‹è¯•APIå¯ç”¨ï¼š`curl http://localhost:8080/api/qwen/rule-review/status`
- [ ] å‡†å¤‡æµ‹è¯•æ–‡ä»¶ï¼ˆ.docxæ ¼å¼ï¼Œ<50MBï¼‰

### å¼€å‘ä¸­ï¼ˆ2å°æ—¶ï¼‰

- [ ] å®ç°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆElUploadç»„ä»¶ï¼‰
- [ ] è°ƒç”¨ /api/parse å¹¶æå–partyAã€partyB
- [ ] å®ç°ç«‹åœºé€‰æ‹©ç•Œé¢ï¼ˆ3ä¸ªå¡ç‰‡ï¼‰
- [ ] è°ƒç”¨ /api/qwen/rule-review/one-click-review
- [ ] æ˜¾ç¤ºå®¡æŸ¥è¿›åº¦ï¼ˆæ¨¡æ‹Ÿè¿›åº¦æ¡ï¼‰
- [ ] å¤„ç†å®¡æŸ¥ç»“æœï¼ˆminioUrlï¼‰

### æµ‹è¯•ï¼ˆ30åˆ†é’Ÿï¼‰

- [ ] ä¸Šä¼ .docxæ–‡ä»¶ â†’ æ£€æŸ¥æ˜¯å¦æ­£ç¡®æ˜¾ç¤ºç”²ä¹™æ–¹
- [ ] é€‰æ‹©ç”²æ–¹ç«‹åœº â†’ æäº¤å®¡æŸ¥ â†’ ç­‰å¾…å®Œæˆ
- [ ] é€‰æ‹©ä¹™æ–¹ç«‹åœº â†’ æäº¤å®¡æŸ¥ â†’ ç­‰å¾…å®Œæˆ
- [ ] é€‰æ‹©ä¸­ç«‹ç«‹åœº â†’ æäº¤å®¡æŸ¥ â†’ ç­‰å¾…å®Œæˆ
- [ ] æµ‹è¯•é”™è¯¯æ–‡ä»¶ï¼ˆ.pdfï¼‰ â†’ æ£€æŸ¥é”™è¯¯æç¤º
- [ ] æµ‹è¯•è¶…å¤§æ–‡ä»¶ï¼ˆ>50MBï¼‰ â†’ æ£€æŸ¥é”™è¯¯æç¤º
- [ ] ç‚¹å‡»"æŸ¥çœ‹ç»“æœ" â†’ éªŒè¯åœ¨çº¿é¢„è§ˆ
- [ ] ç‚¹å‡»"ä¸‹è½½æ–‡æ¡£" â†’ éªŒè¯æ–‡ä»¶ä¸‹è½½

---

## ğŸš¨ å¸¸è§å‘ç‚¹

### å‘1: stanceå‚æ•°å€¼é”™è¯¯

```javascript
âŒ é”™è¯¯: stance: "A"  æˆ–  stance: "ç”²æ–¹"
âœ… æ­£ç¡®: stance: "Aæ–¹"

âŒ é”™è¯¯: stance: "B"  æˆ–  stance: "ä¹™æ–¹"
âœ… æ­£ç¡®: stance: "Bæ–¹"

âœ… æ­£ç¡®: stance: "neutral"
```

### å‘2: è¶…æ—¶è®¾ç½®å¤ªçŸ­

```javascript
âŒ é”™è¯¯: timeout: 10000  // 10ç§’ï¼Œå®¡æŸ¥æ¥ä¸åŠå®Œæˆ
âœ… æ­£ç¡®: timeout: 60000  // 60ç§’
```

### å‘3: æ–‡ä»¶å¯¹è±¡ä¸¢å¤±

```javascript
âŒ é”™è¯¯: åªä¿å­˜æ–‡ä»¶åï¼Œç¬¬äºŒæ¬¡è°ƒç”¨æ—¶æ‰¾ä¸åˆ°æ–‡ä»¶
âœ… æ­£ç¡®: ä¿å­˜å®Œæ•´çš„Fileå¯¹è±¡ç”¨äºç¬¬äºŒæ¬¡APIè°ƒç”¨

// æ­£ç¡®åšæ³•
const uploadedFile = ref<File>()  // ä¿å­˜Fileå¯¹è±¡
uploadedFile.value = file  // ç¬¬ä¸€æ¬¡ä¸Šä¼ æ—¶ä¿å­˜

// ç¬¬äºŒæ¬¡è°ƒç”¨æ—¶ä½¿ç”¨
formData.append('file', uploadedFile.value)
```

### å‘4: URLç¼–ç é—®é¢˜

```javascript
âŒ é”™è¯¯: window.open(`/editor?url=${minioUrl}`)
âœ… æ­£ç¡®: window.open(`/editor?url=${encodeURIComponent(minioUrl)}`)
```

---

## ğŸ¯ æœ€å°å¯ç”¨ç‰ˆæœ¬ï¼ˆ20è¡Œä»£ç ï¼‰

å¦‚æœåªæƒ³æœ€å¿«éªŒè¯åŠŸèƒ½ï¼š

```javascript
// ä¸€é”®å®¡æŸ¥ï¼ˆç®€åŒ–ç‰ˆï¼‰
async function quickReview(file, stance) {
  const fd = new FormData()
  fd.append('file', file)
  fd.append('stance', stance === 'A' ? 'Aæ–¹' : stance === 'B' ? 'Bæ–¹' : 'neutral')
  
  const res = await fetch('/api/qwen/rule-review/one-click-review', {
    method: 'POST',
    body: fd
  })
  
  const data = await res.json()
  
  if (data.success) {
    alert(`å®¡æŸ¥å®Œæˆï¼æ£€å‡º ${data.issuesCount} ä¸ªé—®é¢˜`)
    window.open(`/#/contract-review/editor?fileUrl=${encodeURIComponent(data.minioUrl)}`)
  } else {
    alert('å®¡æŸ¥å¤±è´¥: ' + data.error)
  }
}

// è°ƒç”¨
const fileInput = document.querySelector('input[type=file]')
quickReview(fileInput.files[0], 'A')
```

---

## ğŸ“± å®Œæ•´ç¤ºä¾‹ï¼ˆå¯ç›´æ¥ä½¿ç”¨ï¼‰

**æ–‡ä»¶**: `src/views/ContractReview/OneClickReview.vue`

```vue
<template>
  <div class="one-click-review">
    <ElCard>
      <template #header>
        <span>æ™ºèƒ½åˆåŒå®¡æŸ¥</span>
      </template>

      <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
      <ElSteps :active="step" finish-status="success">
        <ElStep title="ä¸Šä¼ " />
        <ElStep title="ç«‹åœº" />
        <ElStep title="å®¡æŸ¥" />
      </ElSteps>

      <!-- ä¸Šä¼  -->
      <div v-if="step === 0">
        <ElUpload
          drag
          :auto-upload="true"
          action="/api/parse"
          :data="{ anchors: 'generate', returnMode: 'json' }"
          :on-success="handleParse"
          accept=".docx,.doc"
        >
          <el-icon class="el-icon--upload"><upload-filled /></el-icon>
          <div class="el-upload__text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ </div>
        </ElUpload>
      </div>

      <!-- é€‰ç«‹åœº -->
      <div v-else-if="step === 1">
        <h4>è¯†åˆ«åˆ°çš„åˆåŒåŒæ–¹</h4>
        <div style="display: flex; gap: 12px; margin: 20px 0">
          <div 
            @click="stance = 'A'" 
            :class="['card', stance === 'A' && 'active']"
          >
            <div>ç”²æ–¹</div>
            <div>{{ partyA }}</div>
          </div>
          <div 
            @click="stance = 'B'" 
            :class="['card', stance === 'B' && 'active']"
          >
            <div>ä¹™æ–¹</div>
            <div>{{ partyB }}</div>
          </div>
          <div 
            @click="stance = 'neutral'" 
            :class="['card', stance === 'neutral' && 'active']"
          >
            <div>ä¸­ç«‹</div>
            <div>å®¢è§‚å®¡æŸ¥</div>
          </div>
        </div>
        <ElButton type="primary" @click="startReview" :disabled="!stance">
          å¼€å§‹å®¡æŸ¥
        </ElButton>
      </div>

      <!-- å®¡æŸ¥ä¸­ -->
      <div v-else-if="step === 2">
        <div style="text-align: center; padding: 40px">
          <el-icon class="is-loading" :size="48"><Loading /></el-icon>
          <p>AIæ­£åœ¨å®¡æŸ¥ä¸­ï¼Œè¯·ç¨å€™...</p>
        </div>
      </div>

      <!-- å®Œæˆ -->
      <div v-else>
        <ElResult icon="success" :title="`æ£€å‡º ${issuesCount} ä¸ªé—®é¢˜`">
          <template #extra>
            <ElButton type="primary" @click="view">æŸ¥çœ‹ç»“æœ</ElButton>
            <ElButton @click="reset">é‡æ–°å®¡æŸ¥</ElButton>
          </template>
        </ElResult>
      </div>
    </ElCard>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { ElMessage } from 'element-plus'

const step = ref(0)
const file = ref<File>()
const partyA = ref('')
const partyB = ref('')
const stance = ref<'A'|'B'|'neutral'>()
const minioUrl = ref('')
const issuesCount = ref(0)

const handleParse = (res: any) => {
  partyA.value = res.partyA || 'æœªè¯†åˆ«'
  partyB.value = res.partyB || 'æœªè¯†åˆ«'
  file.value = res._file  // ä¿å­˜æ–‡ä»¶
  step.value = 1
}

const startReview = async () => {
  step.value = 2
  
  const fd = new FormData()
  fd.append('file', file.value!)
  fd.append('stance', stance.value === 'A' ? 'Aæ–¹' : 
                       stance.value === 'B' ? 'Bæ–¹' : 'neutral')
  
  try {
    const res = await fetch('/api/qwen/rule-review/one-click-review', {
      method: 'POST',
      body: fd
    })
    const data = await res.json()
    
    if (data.success) {
      minioUrl.value = data.minioUrl
      issuesCount.value = data.issuesCount
      step.value = 3
    }
  } catch (e) {
    ElMessage.error('å®¡æŸ¥å¤±è´¥')
    step.value = 1
  }
}

const view = () => {
  window.open(`/#/contract-review/editor?fileUrl=${encodeURIComponent(minioUrl.value)}`)
}

const reset = () => {
  step.value = 0
}
</script>

<style scoped>
.card {
  flex: 1;
  border: 2px solid #ddd;
  padding: 16px;
  border-radius: 8px;
  cursor: pointer;
  text-align: center;
}
.card.active {
  border-color: #409eff;
  background: #ecf5ff;
}
</style>
```

---

## ğŸ“¦ å¯¼å…¥Postmanæµ‹è¯•

1. æ‰“å¼€Postman
2. ç‚¹å‡» Import
3. é€‰æ‹©æ–‡ä»¶: `ä¸€é”®å®¡æŸ¥API.postman_collection.json`
4. å¯¼å…¥æˆåŠŸåï¼Œç›´æ¥æµ‹è¯•

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | ç”¨é€” |
|------|------|
| `ä¸€é”®å®¡æŸ¥å‰åç«¯å¯¹æ¥æ–‡æ¡£.md` | å®Œæ•´æŠ€æœ¯æ–‡æ¡£ï¼ˆè¯¦ç»†ï¼‰ |
| `ä¸€é”®å®¡æŸ¥APIå¯¹æ¥Prompt.md` | ç»™å‰ç«¯å·¥ç¨‹å¸ˆçš„Prompt |
| `ä¸€é”®å®¡æŸ¥API.postman_collection.json` | Postmanæµ‹è¯•é›†åˆ |
| `å‰ç«¯å¯¹æ¥è¶…ç®€æ´æ¸…å•.md` | æœ¬æ–‡æ¡£ï¼ˆå¿«é€Ÿå‚è€ƒï¼‰ |

---

**å¯¹æ¥é¢„è®¡å·¥æ—¶**: 2-3å°æ—¶  
**éš¾åº¦**: â­â­ï¼ˆç®€å•ï¼‰  
**é£é™©**: ä½

