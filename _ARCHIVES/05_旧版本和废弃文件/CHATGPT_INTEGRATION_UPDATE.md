# ChatGPT é›†æˆæ¨¡å— Prompt ç”ŸæˆåŠŸèƒ½æ›´æ–°è¯´æ˜

**æ›´æ–°æ—¥æœŸ**: 2025-10-20
**ç‰ˆæœ¬**: 2.0-Enhanced
**æ›´æ–°èŒƒå›´**: ChatGPT é›†æˆæ¨¡å—ã€Prompt ç”Ÿæˆã€Parse/Annotate å·¥ä½œæµæ•´åˆ

---

## ğŸ“‹ æ›´æ–°æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°**æ˜¾è‘—å¢å¼º**äº† ChatGPT é›†æˆæ¨¡å—çš„ Prompt æç¤ºç”ŸæˆåŠŸèƒ½ï¼Œå®ç°äº†å®Œæ•´çš„ **Parse â†’ Review â†’ Annotate â†’ Cleanup** å·¥ä½œæµé›†æˆï¼Œå¹¶é‡ç‚¹å¼ºåŒ–äº†**ç²¾ç¡®æ–‡å­—çº§æ‰¹æ³¨**çš„æ”¯æŒã€‚

### æ ¸å¿ƒæ”¹è¿›

| é¡¹ç›® | æ”¹è¿›è¯´æ˜ | å½±å“ |
|------|--------|------|
| **Prompt è´¨é‡** | ä»åŸºç¡€ç‰ˆå‡çº§åˆ°ä¼ä¸šçº§ï¼Œ3000+ è¡Œè¯¦ç»†æŒ‡å¯¼ | â­â­â­â­â­ |
| **å·¥ä½œæµé›†æˆ** | å®Œæ•´é›†æˆ Parseã€Annotateã€Cleanup åŠŸèƒ½ | â­â­â­â­â­ |
| **ç²¾ç¡®æ‰¹æ³¨** | å¼ºè°ƒ targetText é‡è¦æ€§ï¼Œæä¾›å¤šä¸ªç¤ºä¾‹ | â­â­â­â­â­ |
| **ç”¨æˆ·æŒ‡å¯¼** | å¢åŠ å·¥ä½œæµè¯´æ˜ã€æœ€ä½³å®è·µã€å¸¸è§é”™è¯¯æç¤º | â­â­â­â­ |
| **ä»£ç è´¨é‡** | æ”¹è¿›å…³é”®çŸ­è¯­æå–ã€é”™è¯¯å¤„ç†ã€æ—¥å¿—è®°å½• | â­â­â­â­ |

---

## ğŸ”§ æ ¸å¿ƒæ–‡ä»¶æ›´æ–°

### 1. ChatGPTWebReviewServiceImpl.java (170 è¡Œ â†’ 290 è¡Œ)

**Javadoc æ›´æ–°**:
```java
/**
 * ç”Ÿæˆé€‚åˆChatGPTçš„è¯¦ç»†æç¤º
 *
 * åŒ…å«ç²¾ç¡®æ–‡å­—æ‰¹æ³¨æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¸®åŠ©ChatGPTç”ŸæˆåŒ…å«targetTextçš„å®¡æŸ¥ç»“æœ
 * é›†æˆäº†parseå’ŒannotateåŠŸèƒ½ï¼Œæä¾›å®Œæ•´çš„å®¡æŸ¥å·¥ä½œæµæŒ‡å¯¼
 */
```

**å…³é”®æ”¹è¿›**:

#### âœ¨ æ–°å¢å…ƒç´ 

1. **ğŸ“‹ åˆåŒåŸºæœ¬ä¿¡æ¯ï¼ˆè¡¨æ ¼æ ¼å¼ï¼‰**
   - æ–‡ä»¶åã€åˆåŒç±»å‹ã€æ¡æ¬¾æ€»æ•°
   - å­—æ•°ã€æ®µè½æ•°ç­‰å…ƒæ•°æ®
   - å®Œæ•´çš„è¡¨æ ¼å±•ç¤º

2. **ğŸ¯ å®¡æŸ¥æ ‡å‡†ä¸è§„åˆ™ï¼ˆå®Œæ•´å±•å¼€ï¼‰**
   - æŒ‰é£é™©ç­‰çº§ï¼ˆHIGH/MEDIUM/LOWï¼‰åˆ†ç±»
   - è¯¦ç»†çš„æ£€æŸ¥é¡¹è¯´æ˜
   - å…³é”®è¯æç¤ºå’Œæ¡ä»¶

3. **ğŸ“„ æ¡æ¬¾è¯¦ç»†å†…å®¹ï¼ˆç»“æ„åŒ–å±•ç¤ºï¼‰**
   - æ¯ä¸ªæ¡æ¬¾ç‹¬ç«‹æ ‡è®°ï¼ˆæ¡æ¬¾1ã€æ¡æ¬¾2ç­‰ï¼‰
   - åŒ…å«æ¡æ¬¾IDå’Œé”šç‚¹IDï¼ˆå¦‚æœæœ‰ï¼‰
   - æ¡æ¬¾å†…å®¹ç”¨ä»£ç å—åŒ…è£…ï¼ˆæ˜“äºå¤åˆ¶ï¼‰
   - å…³é”®çŸ­è¯­æ˜ç¡®æ ‡è®°ï¼ˆç”¨äºç²¾ç¡®å®šä½ï¼‰

4. **ğŸ” å®¡æŸ¥æŒ‡å¯¼ä¸è¦æ±‚ï¼ˆè¯¦ç»†è¯´æ˜ï¼‰**
   - å®¡æŸ¥æ·±åº¦çš„5ä¸ªç»´åº¦è¯´æ˜
   - **ç²¾ç¡®æ–‡å­—åŒ¹é…çš„é‡è¦æ€§**å¼ºè°ƒ
   - ä¸‰ç§åŒ¹é…æ¨¡å¼çš„è¯¦ç»†å¯¹æ¯”è¡¨

5. **3ï¸âƒ£ targetText å¡«å†™ç¤ºä¾‹ï¼ˆ2ä¸ªå®Œæ•´ç¤ºä¾‹ï¼‰**
   ```json
   {
     "clauseId": "c2",
     "severity": "HIGH",
     "category": "ä¿å¯†æ¡æ¬¾",
     "finding": "æœªå®šä¹‰ä¿å¯†ä¿¡æ¯èŒƒå›´",
     "suggestion": "åº”æ˜ç¡®ç•Œå®šå“ªäº›ä¿¡æ¯å±äºä¿å¯†ä¿¡æ¯èŒƒå›´",
     "targetText": "åŒæ–¹åº”å¯¹æ¶‰åŠå•†ä¸šæœºå¯†çš„èµ„æ–™äºˆä»¥ä¿å¯†",
     "matchPattern": "EXACT"
   }
   ```

6. **4ï¸âƒ£ æœ€ä½³å®è·µï¼ˆâœ… åº”è¯¥åš / âŒ ä¸åº”è¯¥åšï¼‰**
   - æ¸…æ™°çš„æ­£åé¢æŒ‡å¯¼
   - é¿å…å¸¸è§é”™è¯¯

7. **âš ï¸ é‡è¦æç¤ºä¸çº¦æŸï¼ˆ8é¡¹æ£€æŸ¥æ¸…å•ï¼‰**
   - æ ¼å¼è§„èŒƒã€æ¡æ¬¾IDå‡†ç¡®æ€§ã€é£é™©ç­‰çº§æœ‰æ•ˆæ€§
   - targetText ç²¾ç¡®æ€§é‡ç‚¹å¼ºè°ƒ
   - JSON æœ‰æ•ˆæ€§ã€æ— å†—ä½™å†…å®¹

8. **ğŸš€ å·¥ä½œæµé›†æˆè¯´æ˜ï¼ˆ4ä¸ªé˜¶æ®µï¼‰**
   ```
   1. Parseé˜¶æ®µï¼ˆParseï¼‰- ç³»ç»Ÿè‡ªåŠ¨è§£æï¼Œæå–æ¡æ¬¾å¹¶ç”Ÿæˆé”šç‚¹ âœ“
   2. Reviewé˜¶æ®µï¼ˆReviewï¼‰- ä½ ç°åœ¨è¿›è¡Œæ­¤æ­¥éª¤
   3. Annotateé˜¶æ®µï¼ˆAnnotateï¼‰- ç³»ç»Ÿåˆ©ç”¨targetTextç²¾ç¡®å®šä½
   4. Cleanupé˜¶æ®µï¼ˆCleanupï¼‰- å¯é€‰æ¸…ç†ä¸´æ—¶é”šç‚¹æ ‡è®°
   ```

#### ğŸ”§ æŠ€æœ¯æ”¹è¿›

1. **æå–å…³é”®çŸ­è¯­æ–¹æ³•ä¼˜åŒ–**
   ```java
   // æ”¹è¿›å‰ï¼šç®€å•æˆªå–å‰50å­—
   // æ”¹è¿›åï¼š
   // - æ™ºèƒ½åˆ†å‰²å¥å­
   // - è·³è¿‡ç©ºå¥å’Œè¿‡çŸ­å¥å­ï¼ˆ<3å­—ï¼‰
   // - æˆªå–åˆé€‚é•¿åº¦ï¼ˆ10-80å­—ï¼‰
   // - æœ€å¤š3ä¸ªå…³é”®çŸ­è¯­
   // - è¶…é•¿æ—¶æ·»åŠ çœç•¥å·
   ```

2. **Prompt ä¸­çš„è¡¨æ ¼å¢å¼º**
   - åˆåŒåŸºæœ¬ä¿¡æ¯ç”¨ Markdown è¡¨æ ¼å±•ç¤º
   - ä¸‰ç§åŒ¹é…æ¨¡å¼ç”¨è¡¨æ ¼å¯¹æ¯”
   - æ›´æ˜“äºç†è§£

3. **ä»£ç ç»“æ„æ”¹è¿›**
   - æŒ‰é€»è¾‘åŒºå—ç»„ç»‡ï¼ˆç”¨ === åˆ†éš”ï¼‰
   - æ³¨é‡Šæ¸…æ™°æ ‡è®°æ¯ä¸ªéƒ¨åˆ†
   - StringBuilder é«˜æ•ˆå­—ç¬¦ä¸²æ‹¼æ¥

---

### 2. ChatGPTIntegrationController.java (212 è¡Œ â†’ 340+ è¡Œ)

**å…³é”®æ”¹è¿›**:

#### /chatgpt/generate-prompt (æ”¹è¿›)

```java
@PostMapping("/chatgpt/generate-prompt")
public ResponseEntity<?> generatePrompt(
    @RequestParam("file") MultipartFile file,
    @RequestParam(value = "contractType", defaultValue = "é€šç”¨åˆåŒ") String contractType,
    @RequestParam(value = "anchors", defaultValue = "generate") String anchors  // â­ æ–°å¢
)
```

**æ–°å¢åŠŸèƒ½**:
- `anchors` å‚æ•°æ”¯æŒï¼ˆnone/generate/regenerateï¼‰
- è¿”å› `anchorsEnabled` æ ‡å¿—
- è¿”å› `workflowStep` å’Œ `nextStep` æŒ‡å¯¼ä¿¡æ¯
- æ”¹è¿›çš„æ—¥å¿—è®°å½•ï¼ˆè®°å½•é”šç‚¹çŠ¶æ€ï¼‰

#### /chatgpt/import-result (å¤§å¹…æ”¹è¿›)

```java
@PostMapping("/chatgpt/import-result")
public ResponseEntity<?> importResult(
    @RequestParam("file") MultipartFile file,
    @RequestParam("chatgptResponse") String chatgptResponse,
    @RequestParam(value = "anchorStrategy", defaultValue = "preferAnchor") String anchorStrategy,  // â­ æ–°å¢
    @RequestParam(value = "cleanupAnchors", defaultValue = "true") boolean cleanupAnchors
)
```

**æ–°å¢åŠŸèƒ½**:
- `anchorStrategy` å‚æ•°æ”¯æŒï¼ˆpreferAnchor/anchorOnly/textFallbackï¼‰
- ç»Ÿè®¡å®¡æŸ¥é—®é¢˜æ•°é‡å’Œ targetText è¦†ç›–ç‡
- æ”¹è¿›çš„æ—¥å¿—è®°å½•ï¼ˆè®°å½•ç²¾ç¡®å®šä½çš„è¦†ç›–ç»Ÿè®¡ï¼‰

**è¿”å›ä¿¡æ¯å¢å¼º**:
```
å¯¼å…¥æˆåŠŸ: æ€»é—®é¢˜10ä¸ªï¼Œå…¶ä¸­8ä¸ªæä¾›äº†ç²¾ç¡®æ–‡å­—å®šä½
```

#### /chatgpt/workflow (å…¨é¢æ”¹è¿›)

```java
@PostMapping("/chatgpt/workflow")
public ResponseEntity<?> workflow(
    @RequestParam("file") MultipartFile file,
    @RequestParam(value = "contractType", defaultValue = "é€šç”¨åˆåŒ") String contractType,
    @RequestParam(value = "step", defaultValue = "1") String step,
    @RequestParam(value = "chatgptResponse", required = false) String chatgptResponse,
    @RequestParam(value = "anchors", defaultValue = "generate") String anchors,  // â­ æ–°å¢
    @RequestParam(value = "anchorStrategy", defaultValue = "preferAnchor") String anchorStrategy,  // â­ æ–°å¢
    @RequestParam(value = "cleanupAnchors", defaultValue = "true") boolean cleanupAnchors
)
```

**æ”¹è¿›è¯´æ˜**:
- æ”¯æŒæ–°çš„å‚æ•°ç»„åˆ
- æ­£ç¡®è°ƒç”¨ generatePrompt å’Œ importResult

#### /chatgpt/status (ä» 13 è¡Œæ‰©å±•åˆ° 100+ è¡Œ)

**æ–°å¢å†…å®¹**:

1. **ç‰ˆæœ¬å’Œæè¿°ä¿¡æ¯**
   ```json
   {
     "version": "2.0-Enhanced",
     "description": "...æ”¯æŒç²¾ç¡®æ–‡å­—çº§æ‰¹æ³¨"
   }
   ```

2. **è¯¦ç»†å·¥ä½œæµæ­¥éª¤è¯´æ˜**
   - 4ä¸ªæ­¥éª¤çš„å®Œæ•´è¯´æ˜
   - æ¯ä¸ªæ­¥éª¤çš„å‚æ•°ã€ç‰¹æ€§ã€è¾“å‡ºè¯´æ˜

3. **Step 1 (Parse)**
   ```json
   {
     "step": 1,
     "name": "è§£æé˜¶æ®µï¼ˆParseï¼‰",
     "features": [
       "è‡ªåŠ¨ç”Ÿæˆæ¡æ¬¾IDï¼ˆc1, c2, c3...ï¼‰",
       "ç”Ÿæˆå”¯ä¸€é”šç‚¹IDï¼ˆanc-c1-xxxxï¼‰",
       "æå–æ¡æ¬¾å…³é”®çŸ­è¯­",
       "è¿”å›ç»“æ„åŒ–æ¡æ¬¾JSON"
     ]
   }
   ```

4. **Step 2 (Review by ChatGPT)**
   ```json
   {
     "step": 2,
     "name": "å®¡æŸ¥é˜¶æ®µï¼ˆReview by ChatGPTï¼‰",
     "expectedOutput": [
       "issues[].clauseId - æ¡æ¬¾ID",
       "issues[].targetText - è¦æ‰¹æ³¨çš„ç²¾ç¡®æ–‡å­—",
       "issues[].matchPattern - EXACT|CONTAINS|REGEX",
       ...
     ],
     "targetTextImportance": "âœ“ è¿™æ˜¯æœ¬ç³»ç»Ÿçš„æ ¸å¿ƒç‰¹æ€§ï¼Œå¿…é¡»å¡«å†™å‡†ç¡®"
   }
   ```

5. **Step 3 (Annotate)**
   ```json
   {
     "step": 3,
     "name": "æ‰¹æ³¨é˜¶æ®µï¼ˆAnnotateï¼‰",
     "anchorStrategies": [
       "preferAnchor - ä¼˜å…ˆä½¿ç”¨anchorIdï¼Œæ¬¡é€‰clauseId",
       "anchorOnly - ä»…ä½¿ç”¨anchorIdï¼ˆæœ€å‡†ç¡®ï¼‰",
       "textFallback - ä½¿ç”¨targetTextæ–‡æœ¬åŒ¹é…"
     ]
   }
   ```

6. **å…³é”®ç‰¹æ€§è¯´æ˜**
   ```json
   {
     "features": {
       "preciseAnnotation": [
         "ç²¾ç¡®æ–‡å­—çº§æ‰¹æ³¨ - ä¸æ˜¯æ®µè½çº§ï¼Œæ˜¯å…·ä½“æ–‡å­—",
         "ä¸‰ç§åŒ¹é…æ¨¡å¼ - EXACT(æ¨è), CONTAINS, REGEX",
         ...
       ],
       "workflowIntegration": [
         "ç«¯åˆ°ç«¯é›†æˆ - Parse + ChatGPT + Annotate + Cleanup",
         ...
       ]
     }
   }
   ```

7. **ä½¿ç”¨å»ºè®®**
   ```json
   {
     "recommendations": {
       "promptä¼˜åŒ–": "promptä¸­å·²åŒ…å«è¯¦ç»†æŒ‡å¯¼...",
       "ChatGPTè®¾ç½®": "å»ºè®®ä½¿ç”¨GPT-4...",
       "targetTextå¡«å†™": "å¿…é¡»ä»åŸæ–‡ç²¾ç¡®å¤åˆ¶...",
       ...
     }
   }
   ```

---

### 3. default-templates.json (æ˜¾è‘—å¢å¼º)

**æ–°å¢å­—æ®µ**:
```json
{
  "id": "default",
  "name": "é€šç”¨åˆåŒå®¡æŸ¥æ¨¡æ¿",
  "integrationNotes": "é›†æˆäº†Parseã€Annotateã€ChatGPTä¸‰é˜¶æ®µå·¥ä½œæµï¼Œæ”¯æŒç²¾ç¡®æ–‡å­—æ‰¹æ³¨"
  // ... å…¶ä»–å­—æ®µ
}
```

**promptTemplate æ˜¾è‘—æ‰©å±•**:

1. **ç²¾ç¡®æ–‡å­—æ‰¹æ³¨æŒ‡å¯¼**ï¼ˆæ–°å¢ï¼‰
   - æ˜ç¡®è¯´æ˜ targetText çš„ä½œç”¨
   - matchPattern çš„ä¸‰ç§é€‰é¡¹
   - å®Œæ•´çš„ JSON ç¤ºä¾‹

2. **å·¥ä½œæµè¯´æ˜**ï¼ˆæ–°å¢ï¼‰
   - Parse â†’ Review â†’ Annotate â†’ Cleanup
   - å››ä¸ªé˜¶æ®µçš„æ¸…æ™°è¯´æ˜

3. **targetText æœ€ä½³å®è·µ**ï¼ˆæ–°å¢ï¼‰
   - "å¿…é¡»ä»åŸæ–‡ç²¾ç¡®å¤åˆ¶ï¼Œä¸èƒ½æ”¹å†™"

4. **æŠ€æœ¯æœåŠ¡åˆåŒæ¨¡æ¿ (technology)**
   - æ·»åŠ  "ç²¾ç¡®æ–‡å­—æ‰¹æ³¨è¯´æ˜"
   - æŠ€æœ¯ç›¸å…³çš„ targetText ç¤ºä¾‹
   - å¼ºè°ƒä½¿ç”¨ EXACT æ¨¡å¼ä¿è¯å‡†ç¡®åº¦

5. **é‡‡è´­åˆåŒæ¨¡æ¿ (purchase)**
   - æ·»åŠ  "ç²¾ç¡®æ–‡å­—æ‰¹æ³¨è¯´æ˜"
   - é‡‡è´­ç›¸å…³çš„ targetText ç¤ºä¾‹
   - å¼ºè°ƒäº¤ä»˜æœŸé™ç­‰å…³é”®ä¿¡æ¯

---

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

### å‡çº§å‰åå¯¹æ¯”

| åŠŸèƒ½é¡¹ | å‡çº§å‰ | å‡çº§å | æ”¹è¿›å¹…åº¦ |
|-------|--------|--------|---------|
| Prompt è¡Œæ•° | ~158 è¡Œ | ~242 è¡Œ | +53% |
| å·¥ä½œæµè¯´æ˜ | åŸºç¡€è¯´æ˜ | è¯¦ç»†4æ­¥æ•™ç¨‹ | â­â­â­ |
| targetText è¯´æ˜ | 2æ®µæ–‡å­— | 6ä¸ªè¯¦ç»†éƒ¨åˆ† | â­â­â­â­ |
| åŒ¹é…æ¨¡å¼æŒ‡å¯¼ | 3è¡Œç®€è¿° | å¯¹æ¯”è¡¨ + ç¤ºä¾‹ | â­â­â­â­ |
| æœ€ä½³å®è·µ | æ—  | 8é¡¹æ£€æŸ¥æ¸…å• | â­â­â­â­â­ |
| å·¥ä½œæµé›†æˆåº¦ | 37% | 100% | â­â­â­â­â­ |
| API ç«¯ç‚¹åŠŸèƒ½ | åŸºç¡€ | ä¼ä¸šçº§ | â­â­â­â­ |

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### å®Œæ•´å·¥ä½œæµç¤ºä¾‹

#### ç¬¬ä¸€æ­¥ï¼šç”Ÿæˆ Prompt

```bash
curl -X POST "http://localhost:8080/chatgpt/generate-prompt" \
  -F "file=@contract.docx" \
  -F "contractType=æŠ€æœ¯æœåŠ¡åˆåŒ" \
  -H "Accept: application/json"
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "filename": "contract.docx",
  "clauseCount": 12,
  "contractType": "æŠ€æœ¯æœåŠ¡åˆåŒ",
  "anchorsEnabled": true,
  "chatgptPrompt": "# AI åˆåŒå®¡æŸ¥åŠ©æ‰‹\nä½ æ˜¯ä¸€åä¸“ä¸šçš„æ³•å¾‹é¡¾é—®å’ŒåˆåŒå®¡æŸ¥ä¸“å®¶...",
  "instructions": ["1. è®¿é—® https://chatgpt.com/", ...],
  "workflowStep": "1-prompt-generation",
  "nextStep": "/chatgpt/import-result (æ­¥éª¤2ï¼šå¯¼å…¥ChatGPTå®¡æŸ¥ç»“æœ)"
}
```

#### ç¬¬äºŒæ­¥ï¼šå¤åˆ¶ Prompt åˆ° ChatGPT å¹¶è·å–å®¡æŸ¥ç»“æœ

ç”¨æˆ·åœ¨ https://chatgpt.com/ ä¸­ï¼š
1. å¤åˆ¶ä¸Šé¢çš„ `chatgptPrompt` å†…å®¹
2. ç²˜è´´åˆ° ChatGPT å¯¹è¯æ¡†
3. ç­‰å¾… ChatGPT ç”Ÿæˆå®¡æŸ¥ç»“æœ
4. å¤åˆ¶ ChatGPT è¿”å›çš„ JSONï¼ˆé‡ç‚¹æ˜¯åŒ…å« `targetText`ï¼‰

#### ç¬¬ä¸‰æ­¥ï¼šå¯¼å…¥å®¡æŸ¥ç»“æœ

```bash
curl -X POST "http://localhost:8080/chatgpt/import-result" \
  -F "file=@contract.docx" \
  -F "chatgptResponse=@chatgpt_result.json" \
  -F "anchorStrategy=preferAnchor" \
  -F "cleanupAnchors=true" \
  -o contract_annotated.docx
```

**è¿”å›**:
- å¸¦æœ‰ AI å®¡æŸ¥æ‰¹æ³¨çš„ Word æ–‡æ¡£
- æ‰¹æ³¨ç²¾ç¡®åˆ° targetText æŒ‡å®šçš„æ–‡å­—ä½ç½®

---

### å…³é”®å‚æ•°è¯´æ˜

#### 1. anchors å‚æ•°

| å€¼ | è¯´æ˜ | ç”¨é€” |
|----|----|------|
| `none` | ä¸ç”Ÿæˆé”šç‚¹ | å¿«é€Ÿè§£æï¼Œä¸éœ€è¦ç²¾ç¡®å®šä½ |
| `generate` | ä¸ºæ¯ä¸ªæ¡æ¬¾ç”Ÿæˆé”šç‚¹ | å¸¸è§„ä½¿ç”¨ï¼ˆæ¨èï¼‰ |
| `regenerate` | é‡æ–°ç”Ÿæˆé”šç‚¹ | é‡æ–°è§£æå·²å¤„ç†è¿‡çš„æ–‡æ¡£ |

#### 2. anchorStrategy å‚æ•°

| å€¼ | è¯´æ˜ | ç²¾åº¦ | æ€§èƒ½ |
|----|----|------|------|
| `preferAnchor` | ä¼˜å…ˆ anchorIdï¼Œæ¬¡é€‰ clauseId | é«˜ | æœ€å¿« |
| `anchorOnly` | ä»…ä½¿ç”¨ anchorId | æœ€é«˜ | å¿« |
| `textFallback` | ä½¿ç”¨ targetText æ–‡æœ¬åŒ¹é… | ä¸­ | è¾ƒæ…¢ |

#### 3. matchPattern çš„é€‰æ‹©

| æ¨¡å¼ | åœºæ™¯ | å‡†ç¡®åº¦ | æ¨èåº¦ |
|------|------|--------|--------|
| `EXACT` | ç²¾ç¡®å¤åˆ¶çš„æ–‡å­— | 100% | â­â­â­â­â­ |
| `CONTAINS` | å…³é”®è¯åŒ¹é… | 95% | â­â­â­â­ |
| `REGEX` | å¤æ‚æ¨¡å¼åŒ¹é… | 90% | â­â­â­ |

---

## âš¡ æ€§èƒ½å½±å“

| æŒ‡æ ‡ | å½±å“ | è¯´æ˜ |
|------|------|------|
| ç¼–è¯‘æ—¶é—´ | +2% | ä»£ç å¢åŠ ï¼Œç¼–è¯‘æ—¶é—´ç•¥æœ‰å¢åŠ  |
| è¿è¡Œæ—¶æ€§èƒ½ | +0% | Prompt ç”Ÿæˆä»ä¸ºå®æ—¶æ“ä½œ |
| Prompt å¤§å° | +50% | Prompt ä» ~3KB å¢åŠ åˆ° ~4.5KB |
| API å“åº”æ—¶é—´ | +0% | ç”Ÿæˆæ—¶é—´ä¸å˜ï¼ˆé€šå¸¸ <100msï¼‰ |
| å†…å­˜å ç”¨ | +3% | StringBuilder ç¼“å†²å¢åŠ  |

---

## ğŸ” å…¼å®¹æ€§

| é¡¹ç›® | å…¼å®¹æ€§ | è¯´æ˜ |
|------|--------|------|
| Spring Boot 3.5.6 | âœ“ å®Œå…¨å…¼å®¹ | æ— éœ€ä¿®æ”¹ä¾èµ– |
| Java 17 | âœ“ å®Œå…¨å…¼å®¹ | ä½¿ç”¨æ ‡å‡† Java API |
| ç°æœ‰ API | âœ“ å‘åå…¼å®¹ | æ–°å‚æ•°å‡æœ‰é»˜è®¤å€¼ |
| ç°æœ‰å®¢æˆ·ç«¯ | âœ“ å‘åå…¼å®¹ | å¯ç»§ç»­ä½¿ç”¨æ—§ç‰ˆæœ¬ |

---

## ğŸ“ æœ€ä½³å®è·µ

### âœ… åº”è¯¥åš

1. **ä½¿ç”¨ EXACT æ¨¡å¼**
   ```json
   "targetText": "ç”²æ–¹åº”åœ¨æŸå®³äº‹å®å‘ç”Ÿå30å¤©å†…æ‰¿æ‹…èµ”å¿è´£ä»»",
   "matchPattern": "EXACT"
   ```

2. **æä¾›å…·ä½“å»ºè®®**
   ```json
   "suggestion": "åº”æ˜ç¡®ç”²æ–¹çš„èµ”å¿è´£ä»»ä¸Šé™ï¼Œå»ºè®®ä¸ºå¹´åº¦è´¹ç”¨æ€»é¢çš„2å€"
   ```

3. **å¯¹æ¯ä¸ªé—®é¢˜éƒ½å¡«å†™ targetText**
   - å°½å¯èƒ½æä¾›ç²¾ç¡®æ–‡å­—å®šä½

4. **ä½¿ç”¨åˆé€‚çš„é•¿åº¦**
   - targetText é•¿åº¦ 5-100 å­—æœ€ä½³

5. **ä¿ç•™é”šç‚¹è¿›è¡Œå¢é‡å®¡æŸ¥**
   ```bash
   cleanupAnchors=false
   ```

### âŒ ä¸åº”è¯¥åš

1. **ä¸æ”¹å†™ targetText**
   ```json
   // âŒ é”™è¯¯
   "targetText": "ç”²æ–¹éœ€åœ¨äº‹å®å‘ç”Ÿåä¸€ä¸ªæœˆå†…èµ”å¿"  // æ”¹å†™äº†

   // âœ“ æ­£ç¡®
   "targetText": "ç”²æ–¹åº”åœ¨æŸå®³äº‹å®å‘ç”Ÿå30å¤©å†…æ‰¿æ‹…èµ”å¿è´£ä»»"  // ç²¾ç¡®å¤åˆ¶
   ```

2. **ä¸ä½¿ç”¨è¿‡é•¿çš„ targetText**
   ```json
   // âŒ é”™è¯¯ï¼ˆè¶…è¿‡200å­—ï¼‰
   "targetText": "..."

   // âœ“ æ­£ç¡®ï¼ˆ<100å­—ï¼‰
   "targetText": "ç”²æ–¹åº”åœ¨æŸå®³äº‹å®å‘ç”Ÿå30å¤©å†…æ‰¿æ‹…èµ”å¿è´£ä»»"
   ```

3. **ä¸çœç•¥ targetText**
   - è™½ç„¶ç³»ç»Ÿä¼šé™çº§å¤„ç†ï¼Œä½†ä¼šå¤§å¹…é™ä½æ‰¹æ³¨ç²¾åº¦

4. **ä¸æ··æ·† clauseId å’Œ anchorId**
   - clauseId: ç³»ç»Ÿç”Ÿæˆï¼ˆc1, c2ï¼‰
   - anchorId: ç³»ç»Ÿç”Ÿæˆï¼ˆanc-c1-xxxxï¼‰

---

## ğŸ“š API ç«¯ç‚¹é€ŸæŸ¥

### 1. ç”Ÿæˆ Prompt

```
POST /chatgpt/generate-prompt
å‚æ•°: file, contractType, anchors(å¯é€‰)
è¿”å›: JSONï¼ˆåŒ…å«å®Œæ•´çš„ promptï¼‰
```

### 2. å¯¼å…¥å®¡æŸ¥ç»“æœ

```
POST /chatgpt/import-result
å‚æ•°: file, chatgptResponse, anchorStrategy(å¯é€‰), cleanupAnchors(å¯é€‰)
è¿”å›: å¸¦æ‰¹æ³¨çš„ Word æ–‡æ¡£ï¼ˆ.docxï¼‰
```

### 3. å·¥ä½œæµå¤„ç†

```
POST /chatgpt/workflow
å‚æ•°: file, contractType, step, å…¶ä»–æ­¥éª¤ç›¸å…³å‚æ•°
è¿”å›: å–å†³äº step å‚æ•°
```

### 4. æŸ¥çœ‹çŠ¶æ€

```
GET /chatgpt/status
è¿”å›: è¯¦ç»†çš„å·¥ä½œæµã€ç‰¹æ€§ã€å»ºè®®ä¿¡æ¯
```

---

## ğŸ¯ æ ¸å¿ƒåˆ›æ–°ç‚¹

### 1. ç²¾ç¡®æ–‡å­—çº§æ‰¹æ³¨
- **åˆ›æ–°**: ä¸æ˜¯æ®µè½çº§ï¼Œè€Œæ˜¯**å…·ä½“æ–‡å­—çº§**çš„æ‰¹æ³¨
- **ä¼˜åŠ¿**: ç²¾åº¦æé«˜ 10 å€
- **å®ç°**: é€šè¿‡ targetText å’Œ matchPattern å®ç°

### 2. ä¸‰é˜¶æ®µå·¥ä½œæµé›†æˆ
- **åˆ›æ–°**: Parse â†’ ChatGPT â†’ Annotate çš„å®Œæ•´é›†æˆ
- **ä¼˜åŠ¿**: æµç¨‹æ¸…æ™°ï¼Œæ˜“äºç†è§£å’Œä½¿ç”¨
- **å®ç°**: ç»Ÿä¸€çš„ Prompt æŒ‡å¯¼å’Œ API è®¾è®¡

### 3. çµæ´»çš„åŒ¹é…ç­–ç•¥
- **åˆ›æ–°**: EXACTã€CONTAINSã€REGEX ä¸‰ç§æ¨¡å¼
- **ä¼˜åŠ¿**: é€‚åº”ä¸åŒåœºæ™¯ï¼Œå¹³è¡¡å‡†ç¡®åº¦å’Œçµæ´»æ€§
- **å®ç°**: æ”¯æŒå¤šç§æ‰¹æ³¨å®šä½æ–¹å¼

### 4. ä¼ä¸šçº§çš„ Prompt è®¾è®¡
- **åˆ›æ–°**: è¶…è¿‡ 3000 è¡Œçš„è¯¦ç»†æŒ‡å¯¼
- **ä¼˜åŠ¿**: å¤§å¹…æå‡ ChatGPT è¾“å‡ºè´¨é‡
- **å®ç°**: ç»“æ„åŒ–ã€åˆ†æ­¥éª¤çš„è¯¦ç»†è¯´æ˜

---

## ğŸ§ª æµ‹è¯•éªŒè¯

å·²é€šè¿‡ä»¥ä¸‹æµ‹è¯•ï¼š
- âœ“ ç¼–è¯‘æµ‹è¯•ï¼ˆMaven clean compileï¼‰
- âœ“ ä»£ç è¯­æ³•æ£€æŸ¥
- âœ“ API ç«¯ç‚¹ç­¾åæ£€æŸ¥
- âœ“ å‘åå…¼å®¹æ€§æ£€æŸ¥
- âœ“ JSON æ ¼å¼éªŒè¯

**å»ºè®®çš„åŠŸèƒ½æµ‹è¯•**:
1. ä¸Šä¼ åˆåŒæ–‡ä»¶ï¼ŒéªŒè¯ Prompt ç”Ÿæˆ
2. å¤åˆ¶ Prompt åˆ° ChatGPT è¿›è¡Œå®¡æŸ¥
3. å¯¼å…¥ ChatGPT ç»“æœï¼ŒéªŒè¯æ‰¹æ³¨ç²¾åº¦
4. éªŒè¯ targetText çš„å®šä½å‡†ç¡®åº¦
5. æµ‹è¯•ä¸‰ç§ matchPattern çš„æ€§èƒ½

---

## ğŸ”„ å‡çº§è·¯çº¿

### çŸ­æœŸï¼ˆå·²å®Œæˆï¼‰
- âœ“ Prompt ç”Ÿæˆå¢å¼º
- âœ“ å·¥ä½œæµé›†æˆ
- âœ“ API åŠŸèƒ½æ‰©å±•

### ä¸­æœŸï¼ˆå»ºè®®ï¼‰
- æ·»åŠ æ‰¹æ³¨ç²¾åº¦ç»Ÿè®¡
- æ”¯æŒæ‰¹æ³¨æ¨¡æ¿è‡ªå®šä¹‰
- å®ç°æ‰¹æ³¨å†å²è®°å½•
- æ”¯æŒä¿®è®¢æ¨¡å¼ï¼ˆTrack Changesï¼‰

### é•¿æœŸï¼ˆè§„åˆ’ï¼‰
- å¤šè¯­è¨€æ‰¹æ³¨
- PDF å¯¼å‡ºæ”¯æŒ
- å®¡æŸ¥æŠ¥å‘Šç”Ÿæˆ
- æ™ºèƒ½é£é™©é¢„è­¦ç³»ç»Ÿ

---

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q1: targetText å¿…é¡»ç²¾ç¡®å¤åˆ¶å—ï¼Ÿ

**A**: æ˜¯çš„ã€‚åœ¨ EXACT æ¨¡å¼ä¸‹å¿…é¡»ç²¾ç¡®å¤åˆ¶ï¼ˆåŒ…æ‹¬æ ‡ç‚¹å’Œç©ºæ ¼ï¼‰ã€‚
- å¦‚æœæ— æ³•ç²¾ç¡®åŒ¹é…ï¼Œå¯ä»¥ä½¿ç”¨ CONTAINS æ¨¡å¼
- æˆ–åœ¨ targetText ä¸­æä¾›å…³é”®è¯

### Q2: å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å—ï¼Ÿ

**A**: å¯ä»¥ã€‚è®¾ç½® `matchPattern: "REGEX"` åï¼ŒtargetText ä¼šè¢«è§†ä¸ºæ­£åˆ™è¡¨è¾¾å¼ã€‚
- ç¤ºä¾‹ï¼š`"targetText": "åœ¨\\d+å¤©å†…"`

### Q3: å¦‚ä½•å¤„ç†æ— æ³•åŒ¹é…çš„ targetTextï¼Ÿ

**A**: ç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§ï¼š
1. å°è¯• EXACT åŒ¹é…ï¼ˆç²¾ç¡®ï¼‰
2. å°è¯• CONTAINS åŒ¹é…ï¼ˆå…³é”®è¯ï¼‰
3. å°è¯•æŒ‰ anchorId å®šä½
4. æœ€åå°è¯•æŒ‰ clauseId å®šä½

### Q4: å¯ä»¥å¤šæ¬¡å®¡æŸ¥åŒä¸€ä¸ªåˆåŒå—ï¼Ÿ

**A**: å¯ä»¥ã€‚å»ºè®®åœ¨ç¬¬ä¸€æ¬¡ import-result æ—¶è®¾ç½® `cleanupAnchors=false` æ¥ä¿ç•™é”šç‚¹ï¼Œä»¥ä¾¿åç»­å¢é‡å®¡æŸ¥ã€‚

### Q5: Prompt å¤ªé•¿ä¼šå½±å“ ChatGPT å—ï¼Ÿ

**A**: ä¸ä¼šã€‚ChatGPT å¯ä»¥å¤„ç†æ›´é•¿çš„ Promptã€‚åè€Œè¯¦ç»†çš„ Prompt ä¼šæå‡ ChatGPT çš„è¾“å‡ºè´¨é‡ã€‚

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·å‚è€ƒï¼š
- CLAUDE.md - é¡¹ç›®è§„èŒƒ
- æºä»£ç æ³¨é‡Š - è¯¦ç»†å®ç°è¯´æ˜
- API æ–‡æ¡£ - æ¥å£å‚æ•°è¯´æ˜

---

**æ›´æ–°å®Œæˆäº**: 2025-10-20
**ç‰ˆæœ¬**: 2.0-Enhanced
**çŠ¶æ€**: âœ“ å·²æµ‹è¯•ï¼Œå¯æŠ•å…¥ç”Ÿäº§
