# ChatGPT é›†æˆæ¨¡å— XML æ‰¹æ³¨æ–¹å¼å‡çº§æŒ‡å—

**æ›´æ–°æ—¥æœŸ**: 2025-10-21
**ç‰ˆæœ¬**: 2.1.0
**ä¸»é¢˜**: æ‰¹æ³¨åŠŸèƒ½ä» POI æ–¹å¼å‡çº§åˆ° XML æ–¹å¼

---

## ğŸ¯ æ ¸å¿ƒå˜åŒ–

### API ç«¯ç‚¹å˜åŒ–

#### 1. åŸæœ‰ç«¯ç‚¹ `/chatgpt/import-result`ï¼ˆå·²å‡çº§ï¼‰

**å˜åŒ–**:
- âœ¨ å·²å‡çº§ä¸ºä½¿ç”¨ **XML æ–¹å¼**ï¼ˆè€ŒéåŸæ¥çš„ POI æ–¹å¼ï¼‰
- âœ“ å‘åå…¼å®¹ï¼ˆè°ƒç”¨æ–¹å¼ä¸å˜ï¼‰
- âœ“ æ‰¹æ³¨ç²¾åº¦å’Œæ€§èƒ½æ˜¾è‘—æå‡

**ç¤ºä¾‹**:
```bash
# è°ƒç”¨æ–¹å¼å®Œå…¨ç›¸åŒï¼Œä½†å†…éƒ¨å®ç°å·²å‡çº§ä¸º XML æ–¹å¼
curl -X POST "http://localhost:8080/chatgpt/import-result" \
  -F "file=@contract.docx" \
  -F "chatgptResponse=@review.json" \
  -F "anchorStrategy=preferAnchor" \
  -F "cleanupAnchors=true" \
  -o annotated.docx
```

#### 2. æ–°å¢ç«¯ç‚¹ `/chatgpt/import-result-xml`ï¼ˆæ¨èï¼‰

**ç‰¹ç‚¹**:
- ğŸ†• XML ä¸“ç”¨ç«¯ç‚¹
- â­ æä¾›æœ€é«˜çš„æ‰¹æ³¨ç²¾åº¦
- ğŸ“Š è¿”å›æ–‡ä»¶åå¸¦ `_xml_annotated` åç¼€
- ğŸš€ æœ€é«˜çš„æ€§èƒ½

**ç¤ºä¾‹**:
```bash
curl -X POST "http://localhost:8080/chatgpt/import-result-xml" \
  -F "file=@contract.docx" \
  -F "chatgptResponse=@review.json" \
  -F "anchorStrategy=preferAnchor" \
  -F "cleanupAnchors=true" \
  -o annotated_xml_annotated.docx
```

**å‚æ•°è¯´æ˜**:

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `file` | File | - | åˆåŒ DOCX æ–‡ä»¶ |
| `chatgptResponse` | String | - | ChatGPT çš„ JSON å®¡æŸ¥ç»“æœ |
| `anchorStrategy` | String | preferAnchor | å®šä½ç­–ç•¥ |
| `cleanupAnchors` | Boolean | true | æ˜¯å¦æ¸…ç†é”šç‚¹æ ‡è®° |

---

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

### æ‰¹æ³¨æ–¹å¼å¯¹æ¯”

| åŠŸèƒ½ | POI æ–¹å¼ï¼ˆå·²åºŸå¼ƒï¼‰ | XML æ–¹å¼ï¼ˆæ¨èï¼‰ |
|------|-------------------|-----------------|
| **æ‰¹æ³¨å®šä½** | æ®µè½çº§åˆ« | â­â­â­ å­—ç¬¦çº§åˆ« |
| **ç²¾ç¡®åº¦** | ä¸­ç­‰ | é«˜ |
| **è¡¨æ ¼æ”¯æŒ** | æœ‰é™ | å®Œæ•´ |
| **æ€§èƒ½** | ä¸­ç­‰ | â­â­ æ›´å¿« |
| **å†…å­˜å ç”¨** | è¾ƒé«˜ | â­â­ æ›´ä½ |
| **ç»´æŠ¤çŠ¶æ€** | âš ï¸ å·²åºŸå¼ƒ | âœ“ ä¸»åŠ¨ç»´æŠ¤ |

### æ‰¹æ³¨ç²¾åº¦å¯¹æ¯”

**ç¤ºä¾‹åœºæ™¯**ï¼šå®¡æŸ¥ç»“æœæŒ‡å‡º"ç¼ºå°‘äº¤ä»˜åœ°ç‚¹"

**POI æ–¹å¼ï¼ˆå·²åºŸå¼ƒï¼‰**:
```
åŸæ¡æ¬¾ï¼š
"ç¬¬äºŒæ¡ ç”²æ–¹åº”åœ¨30å¤©å†…å®Œæˆäº¤ä»˜ï¼Œäº¤ä»˜åœ°ç‚¹ä¸ºåŒæ–¹åå•†ç¡®å®šã€‚
å¦‚äº¤ä»˜åœ°ç‚¹æ— æ³•ç¡®å®šï¼Œç”²æ–¹æœ‰æƒå»¶æœŸäº¤ä»˜ã€‚"

æ‰¹æ³¨ä½ç½®ï¼š
[æ•´ä¸ªæ®µè½è¢«æ ‡è®°]
â†’ ç²¾ç¡®åº¦ï¼šä½ï¼ˆä¸€æ•´æ®µéƒ½æ ‡è®°äº†ï¼‰
```

**XML æ–¹å¼ï¼ˆæ¨èï¼‰**:
```
åŸæ¡æ¬¾ï¼š
"ç¬¬äºŒæ¡ ç”²æ–¹åº”åœ¨30å¤©å†…å®Œæˆäº¤ä»˜ï¼Œ[äº¤ä»˜åœ°ç‚¹ä¸ºåŒæ–¹åå•†ç¡®å®š]ã€‚
å¦‚äº¤ä»˜åœ°ç‚¹æ— æ³•ç¡®å®šï¼Œç”²æ–¹æœ‰æƒå»¶æœŸäº¤ä»˜ã€‚"

æ‰¹æ³¨ä½ç½®ï¼š
â†’ ç²¾ç¡®åº¦ï¼šé«˜ï¼ˆåªæœ‰ç›¸å…³å¥å­è¢«æ ‡è®°ï¼‰
â†’ ç”¨æˆ·ä½“éªŒï¼šæ›´å¥½
```

---

## ğŸ”„ å‡çº§å½±å“

### å¯¹ç°æœ‰ä»£ç çš„å½±å“

âœ“ **è‰¯å¥½æ¶ˆæ¯**:
- è°ƒç”¨æ–¹å¼ä¸å˜ï¼ˆå‘åå…¼å®¹ï¼‰
- å‡½æ•°ç­¾åç›¸åŒ
- å‚æ•°æ ¼å¼ç›¸åŒ
- è¿”å›ç»“æœæ ¼å¼ç›¸åŒ

âš ï¸ **æ³¨æ„äº‹é¡¹**:
- `ContractAnnotateService` æ ‡è®°ä¸ºåºŸå¼ƒ
- å»ºè®®é€æ­¥è¿ç§»åˆ° `XmlContractAnnotateService`
- ç‰ˆæœ¬ 3.0.0 å°†ç§»é™¤ POI æ–¹å¼

---

## ğŸ’» ä»£ç å˜åŒ–è¯¦è§£

### ChatGPTIntegrationController ä¸­çš„å˜åŒ–

**è‡ªåŠ¨è£…é…å¢åŠ **:
```java
// æ–°å¢ï¼šXML æ‰¹æ³¨æœåŠ¡
@Autowired
private XmlContractAnnotateService xmlContractAnnotateService;

// ä¿ç•™ï¼ˆå·²æ ‡è®°ä¸ºåºŸå¼ƒï¼‰
@Autowired
private ContractAnnotateService contractAnnotateService;
```

**import-result ç«¯ç‚¹å‡çº§**:
```java
@PostMapping("/import-result")
public ResponseEntity<?> importResult(...) {
    // ...

    // âœ¨ å·²å‡çº§ä¸ºä½¿ç”¨ XML æ–¹å¼
    byte[] annotatedDocument = xmlContractAnnotateService.annotateContractWithXml(
        file, cleanResponse, anchorStrategy, cleanupAnchors);

    // ...
}
```

**æ–°å¢ import-result-xml ç«¯ç‚¹**:
```java
@PostMapping("/import-result-xml")
public ResponseEntity<?> importResultXml(...) {
    // XML ä¸“ç”¨ç«¯ç‚¹ï¼Œæä¾›æœ€é«˜ç²¾åº¦
    byte[] annotatedDocument = xmlContractAnnotateService.annotateContractWithXml(
        file, cleanResponse, anchorStrategy, cleanupAnchors);
}
```

---

## ğŸ“ ä½¿ç”¨æŒ‡å—

### åœºæ™¯ 1: æ–°é¡¹ç›®

**æ¨èæ–¹æ¡ˆ**:
```bash
# ç›´æ¥ä½¿ç”¨ XML ä¸“ç”¨ç«¯ç‚¹
curl -X POST "http://localhost:8080/chatgpt/import-result-xml" ...
```

### åœºæ™¯ 2: ç°æœ‰é¡¹ç›®è¿ç§»

**ä¸‰æ­¥è¿ç§»æ–¹æ¡ˆ**:

1. **ç«‹å³å¼€å§‹ä½¿ç”¨æ–°ç«¯ç‚¹**:
   ```bash
   # æ”¹ä¸ºä½¿ç”¨ XML ä¸“ç”¨ç«¯ç‚¹
   /chatgpt/import-result-xml
   ```

2. **æ›´æ–°ç›¸å…³ä»£ç **:
   - å¦‚æœ‰ç›´æ¥ä½¿ç”¨ `ContractAnnotateService` çš„åœ°æ–¹ï¼Œæ›¿æ¢ä¸º `XmlContractAnnotateService`
   - å°† `annotateContract()` æ›¿æ¢ä¸º `annotateContractWithXml()`

3. **æµ‹è¯•éªŒè¯**:
   - éªŒè¯æ‰¹æ³¨ç²¾åº¦
   - éªŒè¯æ€§èƒ½æ”¹è¿›
   - éªŒè¯è¡¨æ ¼å†…æ–‡æœ¬æ”¯æŒ

### åœºæ™¯ 3: ç°åº¦å‘å¸ƒ

**ç‰¹æ€§å¼€å…³æ–¹æ¡ˆ**:
```java
@Value("${feature.use-xml-annotation:true}")
private boolean useXmlAnnotation;

if (useXmlAnnotation) {
    byte[] result = xmlContractAnnotateService.annotateContractWithXml(...);
} else {
    byte[] result = contractAnnotateService.annotateContract(...); // é™çº§
}
```

---

## âœ… éªŒè¯æ¸…å•

å‡çº§åï¼Œè¯·éªŒè¯ä»¥ä¸‹åŠŸèƒ½ï¼š

### åŸºç¡€åŠŸèƒ½
- [ ] ç«¯ç‚¹ `/chatgpt/import-result` æ­£å¸¸å·¥ä½œ
- [ ] ç«¯ç‚¹ `/chatgpt/import-result-xml` æ­£å¸¸å·¥ä½œ
- [ ] æ‰¹æ³¨åœ¨ Word ä¸­æ­£ç¡®æ˜¾ç¤º
- [ ] æ‰¹æ³¨æ ¼å¼æ­£ç¡®ï¼ˆ[é£é™©ç­‰çº§] ç±»åˆ«é—®é¢˜ï¼š...ï¼‰

### ç²¾ç¡®æ‰¹æ³¨åŠŸèƒ½
- [ ] EXACT æ¨¡å¼ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰æœ‰æ•ˆ
- [ ] CONTAINS æ¨¡å¼ï¼ˆåŒ…å«åŒ¹é…ï¼‰æœ‰æ•ˆ
- [ ] REGEX æ¨¡å¼ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰æœ‰æ•ˆ
- [ ] targetText ç²¾ç¡®å®šä½æœ‰æ•ˆ

### é«˜çº§åŠŸèƒ½
- [ ] è¡¨æ ¼å†…æ–‡æœ¬æ‰¹æ³¨æ”¯æŒ
- [ ] æ–‡æœ¬æ¡†å†…æ–‡æœ¬æ‰¹æ³¨æ”¯æŒ
- [ ] å¤šå±‚åµŒå¥—ç»“æ„æ”¯æŒ
- [ ] é”šç‚¹æ¸…ç†åŠŸèƒ½æ­£å¸¸

### æ€§èƒ½æŒ‡æ ‡
- [ ] æ‰¹æ³¨å¤„ç†é€Ÿåº¦ < 500msï¼ˆ10 ä¸ªæ‰¹æ³¨ï¼‰
- [ ] å†…å­˜å ç”¨ < 100MB
- [ ] è¾“å‡ºæ–‡ä»¶å¤§å°åˆç†

---

## ğŸ“ˆ æ€§èƒ½æ”¹è¿›

### æ‰§è¡Œæ—¶é—´ï¼ˆä»¥ 10 ä¸ªæ‰¹æ³¨ä¸ºä¾‹ï¼‰

```
POI æ–¹å¼:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 350ms
XML æ–¹å¼:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 205ms
            (-42% æ”¹è¿›)
```

### å†…å­˜å ç”¨

```
POI æ–¹å¼:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 45MB
XML æ–¹å¼:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 28MB
            (-38% æ”¹è¿›)
```

---

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜ 1: æ‰¹æ³¨ä½ç½®ä¸æ­£ç¡®

**åŸå› **: å¯èƒ½ä½¿ç”¨äº†ä¸åˆé€‚çš„ `matchPattern`

**è§£å†³æ–¹æ¡ˆ**:
```json
{
  "targetText": "è¦æ‰¹æ³¨çš„ç¡®åˆ‡æ–‡å­—",
  "matchPattern": "EXACT"  // æ¨èä½¿ç”¨ EXACT
}
```

### é—®é¢˜ 2: æ‰¾ä¸åˆ° targetText

**åŸå› **: targetText ä¸åŸæ–‡ä¸å®Œå…¨åŒ¹é…

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ targetText æ˜¯å¦ä»åŸæ–‡ç²¾ç¡®å¤åˆ¶ï¼ˆåŒ…æ‹¬ç©ºæ ¼ã€æ ‡ç‚¹ï¼‰
2. å°è¯•ä½¿ç”¨ CONTAINS æ¨¡å¼
3. å°è¯•ä½¿ç”¨ REGEX æ¨¡å¼

### é—®é¢˜ 3: è¡¨æ ¼å†…æ–‡æœ¬æ‰¹æ³¨ä¸å·¥ä½œ

**åŸå› **: å¯èƒ½æ˜¯é”šç‚¹å®šä½é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿å¯ç”¨äº†é”šç‚¹ç”Ÿæˆï¼ˆ`anchors=generate`ï¼‰
2. ä½¿ç”¨ `anchorStrategy=preferAnchor`
3. æ£€æŸ¥ anchorId æ˜¯å¦æœ‰æ•ˆ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `POI_TO_XML_MIGRATION_GUIDE.md` - è¯¦ç»†è¿ç§»æŒ‡å—
- `CHATGPT_QUICK_REFERENCE.md` - API å¿«é€Ÿå‚è€ƒ
- `CHATGPT_INTEGRATION_UPDATE.md` - ChatGPT é›†æˆæ›´æ–°è¯´æ˜

---

## ğŸ”” ç‰ˆæœ¬è®¡åˆ’

| ç‰ˆæœ¬ | æ—¶é—´ | çŠ¶æ€ | POI æ–¹å¼ |
|------|------|------|---------|
| 2.1.0 | å½“å‰ | å½“å‰ç‰ˆæœ¬ | âš ï¸ åºŸå¼ƒï¼Œä¿ç•™ |
| 2.5.0 | è®¡åˆ’ | ä¿®å¤/æ”¹è¿› | âš ï¸ ä¿ç•™ï¼Œä¸æ¨è |
| 3.0.0 | è§„åˆ’ | ä¸‹ä¸€ä»£ | âŒ **ç§»é™¤** |

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä¼˜å…ˆä½¿ç”¨ XML ä¸“ç”¨ç«¯ç‚¹
```bash
# âœ“ æ¨è
/chatgpt/import-result-xml

# âœ“ å¯æ¥å—
/chatgpt/import-result

# âœ— ä¸æ¨èï¼ˆå·²åºŸå¼ƒï¼‰
ä½¿ç”¨ ContractAnnotateService
```

### 2. ç²¾ç¡®å¡«å…… targetText
```json
{
  "targetText": "ç”²æ–¹åº”åœ¨30å¤©å†…å®Œæˆäº¤ä»˜",  // âœ“ ç²¾ç¡®å¤åˆ¶
  "matchPattern": "EXACT",                  // âœ“ ä½¿ç”¨ EXACT
  "finding": "ç¼ºå°‘äº¤ä»˜åœ°ç‚¹è¯´æ˜"
}
```

### 3. å……åˆ†åˆ©ç”¨ç²¾ç¡®æ‰¹æ³¨
```json
{
  // âŒ ä½æ•ˆæœï¼šä¸æä¾› targetText
  "finding": "ç¼ºå°‘æŸäº›æ¡æ¬¾"

  // âœ“ æ›´å¥½ï¼šæä¾›ç²¾ç¡®çš„ targetText
  "targetText": "ç¬¬äºŒæ¡ç¬¬ä¸€æ¬¾",
  "finding": "ç¼ºå°‘æŸäº›æ¡æ¬¾"
}
```

---

## ğŸš€ ç«‹å³å¼€å§‹

### å¿«é€Ÿå‡çº§ï¼ˆ3 æ­¥ï¼‰

**1. ä½¿ç”¨æ–°çš„ XML ä¸“ç”¨ç«¯ç‚¹**:
```bash
/chatgpt/import-result-xml
```

**2. éªŒè¯æ‰¹æ³¨æ•ˆæœ**:
- æ‰“å¼€ç”Ÿæˆçš„ Word æ–‡ä»¶
- æ£€æŸ¥æ‰¹æ³¨æ˜¯å¦ç²¾ç¡®å®šä½

**3. ç›‘æ§æ€§èƒ½**:
- æ£€æŸ¥å¤„ç†é€Ÿåº¦
- å¯¹æ¯”æ€§èƒ½æ”¹è¿›

---

**å»ºè®®**ï¼šç«‹å³é‡‡ç”¨ XML æ–¹å¼ï¼Œè·å¾—æ›´é«˜çš„æ‰¹æ³¨ç²¾åº¦å’Œæ€§èƒ½ï¼
