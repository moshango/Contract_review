# XMLæ‰¹æ³¨å¤šçº§å®šä½æ¶æ„ - å®Œæ•´å®ç°æŒ‡å—

**å®Œæˆæ—¥æœŸ**: 2025-10-20
**æäº¤å“ˆå¸Œ**: `93e86b2`
**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æ¨é€

---

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬æ¬¡å®ç°æ¢å¤äº†XMLæ‰¹æ³¨åŠŸèƒ½ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šå®ç°äº†**å¤šçº§ç²¾ç¡®å®šä½æ¶æ„**ï¼Œæ»¡è¶³ç”¨æˆ·éœ€æ±‚ï¼š

> "ä¸è¦æ¢å¤POIæ–¹å¼ï¼Œæˆ‘è¦æ±‚åŸºäºxmlæ‰¹æ³¨åŠŸèƒ½ï¼Œæ¢å¤å®šä½èƒ½åŠ›ï¼Œå…ˆæŒ‰ç…§é”šç‚¹åŒ¹é…æ®µè½ï¼Œå†åœ¨é”šç‚¹æ‰€æ ‡è®°çš„å†…å®¹è¿›è¡Œæ–‡å­—åŒ¹é…ï¼Œæœ€åæ’å…¥æ‰¹æ³¨"

---

## ğŸ¯ æ ¸å¿ƒæˆæœ

### âœ… Task 1: ä¿®å¤ `/api/annotate` ç«¯ç‚¹

**çŠ¶æ€**: å·²å®Œæˆ

åŸå§‹çŠ¶æ€ï¼š
```java
// æ—§ä»£ç ï¼ˆä½¿ç”¨POIæ–¹å¼ï¼‰
byte[] annotatedDoc = annotateService.annotateContract(
    file, review, anchorStrategy, cleanupAnchors);
```

ä¿®å¤åï¼š
```java
// æ–°ä»£ç ï¼ˆä½¿ç”¨XMLæ–¹å¼ï¼‰
byte[] annotatedDoc = xmlAnnotateService.annotateContractWithXml(
    file, review, anchorStrategy, cleanupAnchors);
```

**æ”¹è¿›è¯´æ˜**ï¼š
- `/api/annotate` ç°åœ¨ä½¿ç”¨XMLæ–¹å¼å®ç°å³ä¾§æ‰¹æ³¨
- å®Œå…¨ä¿ç•™äº†ç²¾ç¡®å®šä½èƒ½åŠ›
- æ”¯æŒ `targetText` å’Œ `matchPattern` å­—æ®µè¿›è¡Œç²¾ç¡®æ–‡å­—åŒ¹é…

### âœ… Task 2: å®ç°æ‰¹æ³¨å®šä½ä¸‰å±‚æ¶æ„

**çŠ¶æ€**: å·²å®Œæˆ

#### ç¬¬1å±‚ - é”šç‚¹å®šä½ï¼ˆAnchor Positioningï¼‰

**ç›®çš„**: æ ¹æ®anchorIdå¿«é€Ÿå®šä½åˆ°æ¡æ¬¾æ‰€åœ¨çš„æ®µè½

**å®ç°**:
```java
// åœ¨ WordXmlCommentProcessor.findTargetParagraph() ä¸­
private Element findParagraphByAnchor(List<Element> paragraphs, String anchorId) {
    for (Element para : paragraphs) {
        List<Element> bookmarkStarts = para.elements(QName.get("bookmarkStart", W_NS));
        for (Element bookmark : bookmarkStarts) {
            String name = bookmark.attributeValue(QName.get("name", W_NS));
            if (anchorId.equals(name)) {
                return para;  // æ‰¾åˆ°åŒ¹é…çš„æ®µè½
            }
        }
    }
    return null;
}
```

**ç‰¹ç‚¹**:
- åˆ©ç”¨Wordä¹¦ç­¾ï¼ˆbookmarkï¼‰ç²¾ç¡®å®šä½
- anchorIdæ ¼å¼: `anc-c1-4f21` (å‰ç¼€-æ¡æ¬¾å·-å“ˆå¸Œ)
- æ”¯æŒä¸‰ç§æŸ¥æ‰¾ç­–ç•¥ï¼špreferAnchorã€anchorOnlyã€textFallback

#### ç¬¬2å±‚ - æ–‡å­—åŒ¹é…ï¼ˆText Matchingï¼‰

**ç›®çš„**: åœ¨é”šç‚¹æ ‡è®°çš„æ®µè½å†…ï¼Œç²¾ç¡®å®šä½è¦æ‰¹æ³¨çš„æ–‡å­—

**å®ç°**:
```java
// åœ¨ WordXmlCommentProcessor.addCommentForIssue() ä¸­
if (issue.getTargetText() != null && !issue.getTargetText().isEmpty()) {
    TextMatchResult matchResult = preciseLocator.findTextInParagraph(
        targetParagraph,
        issue.getTargetText(),
        issue.getMatchPattern() != null ? issue.getMatchPattern() : "EXACT",
        issue.getMatchIndex() != null ? issue.getMatchIndex() : 1
    );

    if (matchResult != null) {
        startRun = matchResult.getStartRun();
        endRun = matchResult.getEndRun();
    }
}
```

**åŒ¹é…æ¨¡å¼** (é€šè¿‡matchPatternæŒ‡å®š):
1. **EXACT** - ç²¾ç¡®åŒ¹é…å®Œæ•´æ–‡å­—
   ```json
   {
     "targetText": "ç”²æ–¹åº”åœ¨æŸå®³äº‹å®å‘ç”Ÿå30å¤©å†…æ‰¿æ‹…èµ”å¿è´£ä»»",
     "matchPattern": "EXACT"
   }
   ```

2. **CONTAINS** - åŒ…å«å…³é”®è¯ï¼ˆå…è®¸é‡å ï¼‰
   ```json
   {
     "targetText": "ä¿å¯†æœŸé™",
     "matchPattern": "CONTAINS"
   }
   ```

3. **REGEX** - æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
   ```json
   {
     "targetText": "\\d{1,3}[,.]\\d{1,2}[ä¸‡å…ƒ]",
     "matchPattern": "REGEX"
   }
   ```

**matchIndex**: å¦‚æœæœ‰å¤šä¸ªåŒ¹é…ï¼Œé€‰æ‹©ç¬¬å‡ ä¸ªï¼ˆ1-basedï¼‰

#### ç¬¬3å±‚ - ç²¾ç¡®æ’å…¥ï¼ˆPrecise Insertionï¼‰

**ç›®çš„**: åœ¨ç²¾ç¡®ä½ç½®æˆ–æ®µè½çº§åˆ«æ’å…¥æ‰¹æ³¨æ ‡è®°

**å®ç°**:
```java
if (startRun != null && endRun != null) {
    // ç²¾ç¡®ä½ç½®æ‰¹æ³¨
    insertPreciseCommentRange(targetParagraph, startRun, endRun, commentId);
} else {
    // æ®µè½çº§åˆ«æ‰¹æ³¨ï¼ˆé»˜è®¤æˆ–é™çº§ï¼‰
    insertCommentRangeInDocument(targetParagraph, commentId);
}
```

**å…³é”®ç‰¹æ€§**:
- âœ“ ç²¾ç¡®åˆ°Runå…ƒç´ ï¼ˆWordæ®µè½ä¸­æœ€å°çš„æ ¼å¼åŒ–å•å…ƒï¼‰
- âœ“ è‡ªåŠ¨é™çº§ï¼šè‹¥æ–‡å­—åŒ¹é…å¤±è´¥ï¼Œè‡ªåŠ¨é™çº§åˆ°æ®µè½çº§åˆ«
- âœ“ ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§ï¼šä¸ä¼šå› ä¸ºåŒ¹é…å¤±è´¥è€Œå¯¼è‡´æ‰¹æ³¨å¤±è´¥

---

## ğŸ“Š å·¥ä½œæµç¨‹

```
è¾“å…¥ï¼šReviewIssue JSON
â”œâ”€ anchorId (ä¾‹å¦‚: anc-c1-4f21)
â”œâ”€ clauseId (ä¾‹å¦‚: c1)
â”œâ”€ targetText (ä¾‹å¦‚: "ç”²æ–¹åº”...")
â”œâ”€ matchPattern (EXACT|CONTAINS|REGEX)
â””â”€ matchIndex (é»˜è®¤1)
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬1å±‚ï¼šé”šç‚¹å®šä½                        â”‚
â”‚ - æŸ¥æ‰¾anchorIdå¯¹åº”çš„æ®µè½              â”‚
â”‚ - è‹¥æœªæ‰¾åˆ°ï¼ŒæŒ‰clauseIdæ–‡æœ¬åŒ¹é…        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“ (æ®µè½æ‰¾åˆ°)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬2å±‚ï¼šæ–‡å­—åŒ¹é…                        â”‚
â”‚ - ä½¿ç”¨PreciseTextAnnotationLocator â”‚
â”‚ - æ”¯æŒEXACT/CONTAINS/REGEXä¸‰ç§æ¨¡å¼   â”‚
â”‚ - æ˜ å°„åˆ°Runå…ƒç´                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“ (åŒ¹é…æˆåŠŸ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬3å±‚ï¼šç²¾ç¡®æ’å…¥ (æˆåŠŸè·¯å¾„)             â”‚
â”‚ - insertPreciseCommentRange()      â”‚
â”‚ - åœ¨ç²¾ç¡®Runä½ç½®æ’å…¥æ‰¹æ³¨æ ‡è®°          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é™çº§è·¯å¾„ (åŒ¹é…å¤±è´¥)                    â”‚
â”‚ - insertCommentRangeInDocument()   â”‚
â”‚ - åœ¨æ®µè½å¼€å§‹/ç»“æŸæ’å…¥æ‰¹æ³¨æ ‡è®°         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰¹æ³¨å†…å®¹å†™å…¥                          â”‚
â”‚ - word/document.xml ä¸­çš„æ ‡è®°         â”‚
â”‚ - word/comments.xml ä¸­çš„å†…å®¹        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
è¾“å‡ºï¼šå¸¦æ‰¹æ³¨çš„DOCXæ–‡ä»¶
```

---

## ğŸ”§ API æ¥å£å˜æ›´

### `/api/annotate` ç«¯ç‚¹

**åŸçŠ¶æ€**: ä½¿ç”¨POIæ–¹å¼ï¼ˆä¸æ”¯æŒç²¾ç¡®æ–‡å­—å®šä½ï¼‰

**æ–°çŠ¶æ€**: ä½¿ç”¨XMLæ–¹å¼ï¼ˆå®Œå…¨æ”¯æŒä¸‰çº§å®šä½æ¶æ„ï¼‰

**è¯·æ±‚ç¤ºä¾‹**:
```bash
curl -X POST "http://localhost:8080/api/annotate" \
  -F "file=@contract.docx" \
  -F "review={
    \"issues\": [
      {
        \"anchorId\": \"anc-c2-8f3a\",
        \"clauseId\": \"c2\",
        \"severity\": \"HIGH\",
        \"finding\": \"èµ”å¿è´£ä»»ä¸æ¸…æ™°\",
        \"targetText\": \"ç”²æ–¹åº”åœ¨æŸå®³äº‹å®å‘ç”Ÿå30å¤©å†…æ‰¿æ‹…èµ”å¿è´£ä»»\",
        \"matchPattern\": \"EXACT\",
        \"suggestion\": \"åº”æ˜ç¡®å…·ä½“çš„èµ”å¿é‡‘é¢å’Œæµç¨‹\"
      }
    ]
  }" \
  -F "anchorStrategy=preferAnchor" \
  -F "cleanupAnchors=false"
```

**å“åº”**: å¸¦æ‰¹æ³¨çš„Wordæ–‡æ¡£ï¼ˆå³ä¾§æ‰¹æ³¨ï¼Œæ”¯æŒç²¾ç¡®æ–‡å­—çº§åˆ«ï¼‰

### `/api/annotate-xml` ç«¯ç‚¹

**è¯´æ˜**: ä¿æŒä¸å˜ï¼Œæä¾›åŒç­‰åŠŸèƒ½

---

## ğŸ“ å…³é”®ä»£ç æ–‡ä»¶

### 1. ContractController.java (è¡Œ133-205)

**æ”¹è¿›**:
```java
@PostMapping("/annotate")
public ResponseEntity<?> annotateContract(...) {
    // éªŒè¯å¹¶è°ƒç”¨ xmlAnnotateService.annotateContractWithXml()
    // è€Œé annotateService.annotateContract()
    byte[] annotatedDoc = xmlAnnotateService.annotateContractWithXml(
        file, review, anchorStrategy, cleanupAnchors);
}
```

### 2. WordXmlCommentProcessor.java (è¡Œ27-114 æ–‡æ¡£æ³¨é‡Š)

**ä¸‰å±‚æ¶æ„å®Œæ•´æ–‡æ¡£**ï¼š
- è¯¦è¿°ç¬¬1å±‚é”šç‚¹å®šä½
- è¯¦è¿°ç¬¬2å±‚æ–‡å­—åŒ¹é…
- è¯¦è¿°ç¬¬3å±‚ç²¾ç¡®æ’å…¥
- å·¥ä½œæµç¨‹è¯´æ˜
- å…³é”®ç‰¹æ€§åˆ—è¡¨
- ä½¿ç”¨ç¤ºä¾‹ï¼ˆEXACTã€CONTAINSã€REGEXï¼‰

### 3. WordXmlCommentProcessor.java (è¡Œ240-263 æ–¹æ³•æ–‡æ¡£)

**æ–¹æ³•çº§æ–‡æ¡£**ï¼š
- addCommentForIssue() çš„ä¸‰å±‚å®ç°ç»†èŠ‚
- å„å±‚çš„èŒè´£è¯´æ˜
- é™çº§æœºåˆ¶è¯´æ˜

### 4. PreciseTextAnnotationLocator.java (å®Œæ•´å®ç°)

**ä¸‰ç§åŒ¹é…æ¨¡å¼**:
- EXACT: ç²¾ç¡®åŒ¹é…
- CONTAINS: åŒ…å«åŒ¹é…ï¼ˆå…è®¸é‡å ï¼‰
- REGEX: æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…

**ç‰¹ç‚¹**:
- å°†å…¨å±€æ–‡æœ¬ä½ç½®æ˜ å°„åˆ°å…·ä½“Runå…ƒç´ 
- æ”¯æŒmatchIndexé€‰æ‹©å¤šä¸ªåŒ¹é…ä¸­çš„ç¬¬å‡ ä¸ª
- å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—

---

## ğŸ’¡ ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯1ï¼šç²¾ç¡®åŒ¹é…å®Œæ•´æ¡æ¬¾

```json
{
  "anchorId": "anc-c2-8f3a",
  "clauseId": "c2",
  "severity": "HIGH",
  "category": "èµ”å¿æ¡æ¬¾",
  "finding": "èµ”å¿è´£ä»»ä¸æ¸…æ™°",
  "targetText": "ç”²æ–¹åº”åœ¨æŸå®³äº‹å®å‘ç”Ÿå30å¤©å†…æ‰¿æ‹…èµ”å¿è´£ä»»",
  "matchPattern": "EXACT",
  "suggestion": "åº”æ˜ç¡®å…·ä½“çš„èµ”å¿é‡‘é¢å’Œæµç¨‹"
}
```

**æ•ˆæœ**ï¼šåœ¨Wordä¸­ï¼Œè¿™å¥è¯ä¼šè¢«é«˜äº®å¹¶å³ä¾§æ˜¾ç¤ºæ‰¹æ³¨

### åœºæ™¯2ï¼šå…³é”®è¯åŒ¹é…

```json
{
  "anchorId": "anc-c3-9f4b",
  "clauseId": "c3",
  "severity": "MEDIUM",
  "finding": "ä¿å¯†æœŸé™è¡¨è¿°æ¨¡ç³Š",
  "targetText": "ä¿å¯†æœŸé™",
  "matchPattern": "CONTAINS",
  "suggestion": "å»ºè®®æ˜ç¡®å…·ä½“æœŸé™ï¼ˆå¦‚5å¹´ã€æ°¸ä¹…ç­‰ï¼‰"
}
```

**æ•ˆæœ**ï¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ…å«"ä¿å¯†æœŸé™"çš„æ–‡å­—å¹¶æ ‡æ³¨

### åœºæ™¯3ï¼šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…

```json
{
  "anchorId": "anc-c1-4f21",
  "clauseId": "c1",
  "severity": "HIGH",
  "finding": "æ•°å­—è¡¨è¿°ä¸ä¸€è‡´",
  "targetText": "\\d+(\\.\\d+)?\\s*(ä¸‡|åƒ|ç™¾)?å…ƒ",
  "matchPattern": "REGEX",
  "matchIndex": 2,
  "suggestion": "å»ºè®®ç»Ÿä¸€ä½¿ç”¨äººæ°‘å¸å¤§å†™æˆ–å°å†™ï¼Œç¡®ä¿æ•°å­—å‡†ç¡®"
}
```

**æ•ˆæœ**ï¼šä½¿ç”¨æ­£åˆ™åŒ¹é…æ‰€æœ‰é‡‘é¢è¡¨è¿°ï¼Œé€‰æ‹©ç¬¬2ä¸ªè¿›è¡Œæ ‡æ³¨

---

## âœ… ç¼–è¯‘éªŒè¯

```bash
âœ… mvn clean compile -DskipTests
BUILD SUCCESS
Total time: 7.712 s
No errors found
```

---

## ğŸ“¤ Gitæäº¤ä¿¡æ¯

```
æäº¤: 93e86b2
æ¶ˆæ¯: æ¢å¤XMLæ‰¹æ³¨åŠŸèƒ½å¹¶å®ç°å¤šçº§å®šä½æ¶æ„

æ ¸å¿ƒæ”¹è¿›ï¼š
1. å°† /api/annotate ç«¯ç‚¹æ”¹ä¸ºä½¿ç”¨XMLæ‰¹æ³¨æœåŠ¡
2. å®ç°æ‰¹æ³¨å®šä½ä¸‰å±‚æ¶æ„
3. å®Œå–„ä»£ç æ–‡æ¡£ï¼Œè¯¦è¿°ä¸‰å±‚æ¶æ„å®ç°ç»†èŠ‚

æ¨é€: âœ… æˆåŠŸæ¨é€åˆ° origin/main
```

---

## ğŸš€ ç³»ç»ŸçŠ¶æ€

```
âœ… åŸºç¡€åŠŸèƒ½ï¼ˆParse & Annotateï¼‰       [å·²å®Œæˆ]
âœ… ç²¾ç¡®æ–‡å­—æ‰¹æ³¨ç³»ç»Ÿï¼ˆPhase 1ï¼‰        [å·²å®Œæˆ]
âœ… ChatGPTé›†æˆå‡çº§ v2.0             [å·²å®Œæˆ]
âœ… XMLæ‰¹æ³¨å¤šçº§å®šä½æ¶æ„ï¼ˆæœ¬æ¬¡ï¼‰        [å·²å®Œæˆ] â† YOU ARE HERE
â³ æ›´å¤šAIæœåŠ¡é›†æˆ                    [è§„åˆ’ä¸­]
â³ UI/UXä¼˜åŒ–                         [è§„åˆ’ä¸­]
```

---

## ğŸ“Œ æŠ€æœ¯äº®ç‚¹

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **ç²¾ç¡®å®šä½** | æ”¯æŒåˆ°Word Runå…ƒç´ çº§åˆ«çš„ç²¾ç¡®æ‰¹æ³¨ |
| **å¤šçº§æ¶æ„** | é”šç‚¹â†’æ–‡å­—â†’ç²¾ç¡®ä¸‰å±‚é€’è¿›å¼å®šä½ |
| **çµæ´»åŒ¹é…** | EXACT/CONTAINS/REGEXä¸‰ç§æ¨¡å¼ |
| **è‡ªåŠ¨é™çº§** | åŒ¹é…å¤±è´¥è‡ªåŠ¨é™çº§åˆ°æ®µè½çº§åˆ« |
| **å®Œå–„æ–‡æ¡£** | è¯¦å°½çš„ä»£ç æ³¨é‡Šå’Œä½¿ç”¨ç¤ºä¾‹ |
| **ç³»ç»Ÿç¨³å®š** | å¼‚å¸¸å¤„ç†å®Œå–„ï¼Œä¸ä¼šå› å®šä½å¤±è´¥è€Œä¸­æ–­ |

---

## ğŸ” è°ƒè¯•å»ºè®®

### 1. æŸ¥çœ‹æ‰¹æ³¨æ—¥å¿—

```
logger.debug("ä½¿ç”¨ç²¾ç¡®æ–‡å­—åŒ¹é…æ’å…¥æ‰¹æ³¨ï¼šæ–‡å­—={}, èµ·å§‹Run={}, ç»“æŸRun={}",
           issue.getTargetText(),
           startRun != null ? "âœ“" : "null",
           endRun != null ? "âœ“" : "null");
```

### 2. æµ‹è¯•å„ç§åŒ¹é…æ¨¡å¼

- EXACT: ç¡®ä¿targetTextä¸åŸæ–‡å®Œå…¨ä¸€è‡´ï¼ˆåŒ…æ‹¬ç©ºæ ¼ï¼‰
- CONTAINS: ç”¨äºå¤šæ¬¡å‡ºç°çš„å…³é”®è¯ï¼Œä½¿ç”¨matchIndexé€‰æ‹©
- REGEX: å¤æ‚æ¨¡å¼éœ€è¦å……åˆ†æµ‹è¯•

### 3. éªŒè¯anchorId

- ç¡®ä¿anchorIdä¸è§£ææ—¶ç”Ÿæˆçš„é”šç‚¹ä¸€è‡´
- ä½¿ç”¨anchorStrategy=preferAnchorå…è®¸é€€å›åˆ°æ–‡æœ¬åŒ¹é…

---

## ğŸ“ å¿«é€Ÿå‚è€ƒ

### å…³é”®ç±»

| ç±» | èŒè´£ |
|----|------|
| ContractController | APIç«¯ç‚¹å®šä¹‰ |
| WordXmlCommentProcessor | XMLæ“ä½œå’Œæ‰¹æ³¨æ’å…¥ |
| PreciseTextAnnotationLocator | æ–‡å­—ç²¾ç¡®åŒ¹é…å®šä½ |
| XmlContractAnnotateService | ä¸šåŠ¡é€»è¾‘åè°ƒ |

### å…³é”®æ–¹æ³•

| æ–¹æ³• | ä½ç½® | èŒè´£ |
|------|------|------|
| addCommentsToDocx() | WordXmlCommentProcessor:64 | ä¸»å…¥å£ |
| addCommentForIssue() | WordXmlCommentProcessor:264 | å•é—®é¢˜æ‰¹æ³¨ |
| findTargetParagraph() | WordXmlCommentProcessor:310 | ç¬¬1å±‚é”šç‚¹å®šä½ |
| findTextInParagraph() | PreciseTextAnnotationLocator:37 | ç¬¬2å±‚æ–‡å­—åŒ¹é… |
| insertPreciseCommentRange() | WordXmlCommentProcessor:311 | ç¬¬3å±‚ç²¾ç¡®æ’å…¥ |

---

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡å®ç°æˆåŠŸæ¢å¤äº†XMLæ‰¹æ³¨åŠŸèƒ½ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šæ„å»ºäº†**æ‰¹æ³¨å®šä½ä¸‰å±‚æ¶æ„**ï¼š

1. **ç¬¬1å±‚ - é”šç‚¹å®šä½**: é€šè¿‡ä¹¦ç­¾ç²¾ç¡®å®šä½æ®µè½
2. **ç¬¬2å±‚ - æ–‡å­—åŒ¹é…**: æ”¯æŒEXACT/CONTAINS/REGEXå¤šç§æ¨¡å¼
3. **ç¬¬3å±‚ - ç²¾ç¡®æ’å…¥**: åœ¨Runçº§åˆ«ç²¾ç¡®æ‰¹æ³¨ï¼Œæ”¯æŒè‡ªåŠ¨é™çº§

**ç³»ç»Ÿå·²ready for productionï¼** ğŸš€

æ‰€æœ‰ä»£ç å·²é€šè¿‡ç¼–è¯‘éªŒè¯ï¼Œæ–‡æ¡£é½å…¨ï¼Œæäº¤å·²æ¨é€ã€‚

---

**æäº¤é“¾æ¥**: https://github.com/moshango/Contract_review/commit/93e86b2
