# ğŸ”§ å¿«é€Ÿæ•…éšœæ’é™¤æŒ‡å—

**é’ˆå¯¹**: ç¬¬ 23 ä¸ªæ¡æ¬¾ï¼ˆc23ï¼‰æ— æ³•å®šä½

---

## ğŸ¯ é—®é¢˜è¯Šæ–­

### ç—‡çŠ¶

```
WARN  ? æœªæ‰¾åˆ°anchorIdå¯¹åº”çš„ä¹¦ç­¾ï¼šanchorId=anc-c23-e043
INFO  é”šç‚¹æŸ¥æ‰¾å¤±è´¥ï¼Œå›é€€åˆ°æ–‡æœ¬åŒ¹é…
```

---

## âœ… è¯Šæ–­æ­¥éª¤ï¼ˆæŒ‰é¡ºåºæ‰§è¡Œï¼‰

### ç¬¬ 1 æ­¥: éªŒè¯ä½¿ç”¨çš„æ–‡æ¡£

**é—®é¢˜**: æ˜¯å¦ä½¿ç”¨äº† Parse è¿”å›çš„å¸¦é”šç‚¹æ–‡æ¡£ï¼Ÿ

**æ£€æŸ¥æ–¹æ³•**:
```bash
# æ‰“å¼€æœ€åç”¨æ¥è°ƒç”¨ /import-result-xml çš„æ–‡æ¡£
# ç”¨ Word æ‰“å¼€è¯¥æ–‡ä»¶
# èœå•: Insert â†’ Links â†’ Bookmarks
# æŸ¥çœ‹æ˜¯å¦æœ‰ anc-c1-*, anc-c2-*, ..., anc-c23-* ç­‰ä¹¦ç­¾

# å¦‚æœæ²¡æœ‰çœ‹åˆ°ä»»ä½• anc-* å¼€å¤´çš„ä¹¦ç­¾ï¼Œè¯´æ˜é—®é¢˜åœ¨è¿™é‡Œï¼
```

**é¢„æœŸç»“æœ**:
- âœ… çœ‹åˆ° 23 ä¸ªä¹¦ç­¾ï¼ˆanc-c1 åˆ° anc-c23ï¼‰
- âŒ åªçœ‹åˆ° _GoBack ï¼ˆWord é»˜è®¤ä¹¦ç­¾ï¼‰

**å¦‚æœåªçœ‹åˆ° _GoBackï¼Œé—®é¢˜æ‰¾åˆ°äº†ï¼** ğŸ‘‡

---

### ç¬¬ 2 æ­¥: æ£€æŸ¥ Parse é˜¶æ®µæ˜¯å¦æ­£ç¡®

**é—®é¢˜**: Parse æ—¶æ˜¯å¦æ­£ç¡®ç”Ÿæˆäº†é”šç‚¹ï¼Ÿ

**æ£€æŸ¥æ–¹æ³•**:
```bash
# è°ƒç”¨ /generate-prompt æ—¶æ£€æŸ¥æ—¥å¿—
curl -X POST "http://localhost:8080/chatgpt/generate-prompt" \
  -F "file=@contract.docx" \
  -F "anchors=generate" \
  2>&1 | grep -i "é”šç‚¹\|anchor"

# é¢„æœŸçœ‹åˆ°:
# âœ“ å‘ç°æ¡æ¬¾ [clauseId=c1]
# âœ“ å‘ç°æ¡æ¬¾ [clauseId=c2]
# ...
# âœ“ å‘ç°æ¡æ¬¾ [clauseId=c23]
# ç”Ÿæˆé”šç‚¹: anchorId=anc-c23-xxxx
```

**æ£€æŸ¥å“åº”JSON**:
```bash
curl -X POST "http://localhost:8080/chatgpt/generate-prompt" \
  -F "file=@contract.docx" \
  -F "anchors=generate" \
  | jq '.parseResult.clauses[] | {id, anchorId}' | tail -5

# é¢„æœŸçœ‹åˆ° c23 æœ‰å¯¹åº”çš„ anchorId
```

**å¦‚æœçœ‹ä¸åˆ° c23ï¼Œé—®é¢˜å¯èƒ½åœ¨è¿™é‡Œï¼** ğŸ‘‡

---

### ç¬¬ 3 æ­¥: æ£€æŸ¥æ–‡æ¡£ä¸‹è½½å’Œè§£ç 

**é—®é¢˜**: æ˜¯å¦æ­£ç¡®ä¸‹è½½å’Œè§£ç äº†å¸¦é”šç‚¹çš„æ–‡æ¡£ï¼Ÿ

**æ–¹æ¡ˆ A - ä½¿ç”¨ Base64 (ä» /generate-prompt è¿”å›)**:
```bash
# 1. è·å–å“åº”
curl -X POST "http://localhost:8080/chatgpt/generate-prompt" \
  -F "file=@contract.docx" \
  -F "anchors=generate" \
  > result.json

# 2. æ£€æŸ¥æ˜¯å¦æœ‰ documentWithAnchorsBase64
jq '.documentWithAnchorsBase64' result.json | wc -c
# åº”è¯¥è¾“å‡ºä¸€ä¸ªå¾ˆå¤§çš„æ•°å­—ï¼ˆ> 50000ï¼‰

# 3. è§£ç å¹¶ä¿å­˜
jq -r '.documentWithAnchorsBase64' result.json | base64 -d > contract_with_anchors_decoded.docx

# 4. éªŒè¯æ–‡ä»¶å¤§å°
ls -lh contract_with_anchors_decoded.docx
# åº”è¯¥ä¸åŸæ–‡ä»¶å¤§å°ç›¸è¿‘
```

**æ–¹æ¡ˆ B - ä½¿ç”¨æ–°ç«¯ç‚¹ (æ¨è)**:
```bash
# ç›´æ¥ä¸‹è½½å¸¦é”šç‚¹çš„æ–‡æ¡£
curl -X POST "http://localhost:8080/chatgpt/get-document-with-anchors" \
  -F "file=@contract.docx" \
  -o contract_with_anchors_direct.docx

# éªŒè¯æ–‡ä»¶
ls -lh contract_with_anchors_direct.docx
# åº”è¯¥æ˜¯æœ‰æ•ˆçš„ .docx æ–‡ä»¶
```

**å¦‚æœè§£ç æˆ–ä¸‹è½½å¤±è´¥ï¼Œé—®é¢˜å¯èƒ½åœ¨è¿™é‡Œï¼** ğŸ‘‡

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1: æ–‡æ¡£ä¸­æ²¡æœ‰é”šç‚¹ä¹¦ç­¾

**ç—‡çŠ¶**:
```
æ–‡æ¡£ä¸­åªæœ‰ 1 ä¸ªä¹¦ç­¾ï¼ˆ_GoBackï¼‰
æ²¡æœ‰çœ‹åˆ° anc-c1, anc-c2, ..., anc-c23
```

**åŸå› **:
- âŒ ä½¿ç”¨çš„æ˜¯åŸå§‹æ–‡æ¡£ï¼Œä¸æ˜¯ Parse è¿”å›çš„æ–‡æ¡£
- âŒ Parse æ—¶æ²¡æœ‰è®¾ç½® `anchors=generate` å‚æ•°
- âŒ Base64 è§£ç å‡ºé”™

**è§£å†³æ–¹æ¡ˆ**:
```bash
# é‡æ–°æ‰§è¡Œæ­£ç¡®çš„å·¥ä½œæµç¨‹

# Step 1: ä½¿ç”¨æ–°ç«¯ç‚¹ç›´æ¥è·å–
curl -X POST "http://localhost:8080/chatgpt/get-document-with-anchors" \
  -F "file=@contract.docx" \
  -o contract_with_anchors.docx

# Step 2: éªŒè¯æ–‡æ¡£æœ‰é”šç‚¹ï¼ˆWord ä¸­æ‰“å¼€æŸ¥çœ‹ä¹¦ç­¾ï¼‰

# Step 3: ä½¿ç”¨æ­¤æ–‡æ¡£è¿›è¡Œæ‰¹æ³¨
curl -X POST "http://localhost:8080/chatgpt/import-result-xml" \
  -F "file=@contract_with_anchors.docx" \
  -F "chatgptResponse=@review.json" \
  -o final_annotated.docx
```

---

### é—®é¢˜ 2: Parse æ—¶æ²¡æœ‰æ‰¾åˆ° c23 æ¡æ¬¾

**ç—‡çŠ¶**:
```
parseResult.clauses ä¸­åªæœ‰ 22 ä¸ªæ¡æ¬¾ï¼Œæ²¡æœ‰ c23
```

**åŸå› **:
- âŒ åŸå§‹åˆåŒä¸­ç¬¬ 23 ä¸ªæ¡æ¬¾æ— æ³•è¢«è¯†åˆ«ï¼ˆä¸ç¬¦åˆæ¡æ¬¾æ ‡é¢˜è§„åˆ™ï¼‰
- âŒ æˆ–æ–‡æ¡£è¢«æˆªæ–­

**æ£€æŸ¥æ–¹æ³•**:
```bash
# æŸ¥çœ‹è¿”å›çš„æ¡æ¬¾æ€»æ•°
curl -X POST "http://localhost:8080/chatgpt/generate-prompt" \
  -F "file=@contract.docx" \
  | jq '.clauseCount'

# å¦‚æœè¿”å› 22 è€Œä¸æ˜¯ 23ï¼Œé‚£å°±æ˜¯è¿™ä¸ªé—®é¢˜
```

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥åŸå§‹åˆåŒä¸­ç¬¬ 23 ä¸ªæ¡æ¬¾çš„æ ¼å¼
- æŸ¥çœ‹æ˜¯å¦ç¬¦åˆæ¡æ¬¾æ ‡é¢˜è§„åˆ™ï¼ˆ"ç¬¬XXXæ¡" æˆ–æ•°å­—å¼€å¤´ç­‰ï¼‰
- å¯èƒ½éœ€è¦ä¿®æ”¹åŸå§‹åˆåŒçš„æ ¼å¼

---

### é—®é¢˜ 3: Parse è¿”å›äº† c23ï¼Œä½†æ²¡æœ‰é”šç‚¹

**ç—‡çŠ¶**:
```
parseResult.clauses[22].id = "c23"
parseResult.clauses[22].anchorId = null
```

**åŸå› **:
- âŒ æ²¡æœ‰ä½¿ç”¨ `anchors=generate` å‚æ•°

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ç¡®ä¿ä½¿ç”¨ anchors=generate
curl -X POST "http://localhost:8080/chatgpt/generate-prompt" \
  -F "file=@contract.docx" \
  -F "anchors=generate"  # â† è¿™è¡Œå¾ˆå…³é”®ï¼
```

---

## âœ… å®Œæ•´çš„æ­£ç¡®å·¥ä½œæµç¨‹

### æ¨èæµç¨‹ï¼ˆæœ€ç®€å•ï¼‰

```bash
# 1ï¸âƒ£ è·å–å¸¦é”šç‚¹çš„æ–‡æ¡£
curl -X POST "http://localhost:8080/chatgpt/get-document-with-anchors" \
  -F "file=@contract.docx" \
  -o contract_with_anchors.docx

# 2ï¸âƒ£ éªŒè¯æ–‡æ¡£æœ‰é”šç‚¹
# ç”¨ Word æ‰“å¼€ contract_with_anchors.docx
# Insert â†’ Links â†’ Bookmarks
# åº”è¯¥çœ‹åˆ° anc-c1 åˆ° anc-c23 ç­‰ä¹¦ç­¾

# 3ï¸âƒ£ ç”Ÿæˆ Promptï¼ˆè·å–æ¡æ¬¾ä¿¡æ¯ï¼‰
curl -X POST "http://localhost:8080/chatgpt/generate-prompt" \
  -F "file=@contract.docx" \
  -F "anchors=generate" \
  | jq '.chatgptPrompt' > prompt.txt

# 4ï¸âƒ£ åœ¨ ChatGPT ä¸­å®¡æŸ¥ï¼ˆç”¨æˆ·æ‰‹åŠ¨æ“ä½œï¼‰

# 5ï¸âƒ£ å¯¼å…¥å®¡æŸ¥ç»“æœï¼ˆä½¿ç”¨å¸¦é”šç‚¹çš„æ–‡æ¡£ï¼‰
curl -X POST "http://localhost:8080/chatgpt/import-result-xml" \
  -F "file=@contract_with_anchors.docx" \
  -F "chatgptResponse=@review.json" \
  -o final_annotated.docx

# 6ï¸âƒ£ å®Œæˆï¼åœ¨ Word ä¸­æŸ¥çœ‹å¸¦æ‰¹æ³¨çš„æ–‡æ¡£
```

---

## ğŸ¯ å¿«é€Ÿæ£€æŸ¥æ¸…å•

- [ ] ä½¿ç”¨çš„æ–‡æ¡£æ˜¯å¦æ˜¯ Parse è¿”å›çš„å¸¦é”šç‚¹æ–‡æ¡£ï¼Ÿ
- [ ] æ–‡æ¡£ä¸­æ˜¯å¦æœ‰ 23 ä¸ªé”šç‚¹ä¹¦ç­¾ï¼ˆanc-c1 åˆ° anc-c23ï¼‰ï¼Ÿ
- [ ] Parse æ—¶æ˜¯å¦ä½¿ç”¨äº† `anchors=generate` å‚æ•°ï¼Ÿ
- [ ] c23 æ¡æ¬¾åœ¨ parseResult ä¸­æ˜¯å¦å­˜åœ¨ï¼Ÿ
- [ ] c23 çš„ anchorId æ˜¯å¦ä¸ä¸º nullï¼Ÿ

---

## ğŸ“Š ç—‡çŠ¶åˆ°åŸå› çš„æ˜ å°„

| ç—‡çŠ¶ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|---------|
| æ–‡æ¡£ä¸­æ²¡æœ‰ä»»ä½•é”šç‚¹ä¹¦ç­¾ | ä½¿ç”¨äº†åŸå§‹æ–‡æ¡£ | ä½¿ç”¨ /get-document-with-anchors |
| parseResult ä¸­æ²¡æœ‰ c23 | åˆåŒæ ¼å¼é—®é¢˜æˆ–æ–‡æ¡£æˆªæ–­ | æ£€æŸ¥åŸå§‹åˆåŒä¸­ç¬¬ 23 æ¡ |
| c23 çš„ anchorId ä¸º null | æ²¡æœ‰è®¾ç½® anchors=generate | æ·»åŠ  -F "anchors=generate" |
| æ‰¹æ³¨å®šä½åˆ°é”™è¯¯ä½ç½® | targetText ä¸å®é™…æ–‡æœ¬ä¸åŒ¹é… | ä»åŸæ–‡ç²¾ç¡®å¤åˆ¶ targetText |

---

## ğŸ’¡ å¿«é€Ÿè¯Šæ–­å‘½ä»¤

**ä¸€é”®è¯Šæ–­**:
```bash
echo "=== æ£€æŸ¥æ–‡æ¡£ä¸­çš„é”šç‚¹ ===" && \
echo "è¿›è¡Œä¸­... (éœ€è¦åœ¨ Word ä¸­æ‰‹åŠ¨æ“ä½œ)" && \
echo "èœå•: Insert â†’ Links â†’ Bookmarks" && \
echo "" && \
echo "=== æ£€æŸ¥ ParseResult ===" && \
curl -s -X POST "http://localhost:8080/chatgpt/generate-prompt" \
  -F "file=@contract.docx" \
  -F "anchors=generate" \
  | jq '{
    clauseCount: .clauseCount,
    lastClause: .parseResult.clauses[-1],
    hasDocumentWithAnchors: (.documentWithAnchorsBase64 != null)
  }' && \
echo "" && \
echo "=== ä¸‹è½½æ–‡æ¡£å¹¶æ£€æŸ¥ ===" && \
curl -s -X POST "http://localhost:8080/chatgpt/get-document-with-anchors" \
  -F "file=@contract.docx" \
  -o test_doc.docx && \
ls -lh test_doc.docx
```

---

**å»ºè®®**: æŒ‰ç…§å¿«é€Ÿæ£€æŸ¥æ¸…å•é€ä¸€æ’æŸ¥ï¼Œæ‰¾åˆ°é—®é¢˜æ‰€åœ¨ï¼
