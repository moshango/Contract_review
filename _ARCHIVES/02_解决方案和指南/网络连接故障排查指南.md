# AIåˆåŒå®¡æŸ¥ç³»ç»Ÿ - ç½‘ç»œè¿æ¥æ•…éšœæ’æŸ¥æŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—å¸®åŠ©æ‚¨è§£å†³è°ƒç”¨ Claude æˆ– OpenAI API æ—¶é‡åˆ°çš„ç½‘ç»œè¿æ¥é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯ `HttpURLConnection timeout` é”™è¯¯ã€‚

---

## ğŸ” é—®é¢˜è¯Šæ–­

### 1. ç¡®è®¤é”™è¯¯ç±»å‹

å½“æ‚¨çœ‹åˆ°ä»¥ä¸‹é”™è¯¯ä¿¡æ¯æ—¶ï¼Œè¡¨æ˜å­˜åœ¨ç½‘ç»œè¿æ¥é—®é¢˜ï¼š

- `HttpURLConnection.plainConnect timeout`
- `Connection refused`
- `Connect timeout`
- `Read timeout`
- `ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œæ— æ³•è®¿é—®AIæœåŠ¡`

---

## âœ… è§£å†³æ–¹æ¡ˆ

### âš ï¸ æ–¹æ¡ˆ 0: æ£€æŸ¥å¹¶æ¸…é™¤ç³»ç»Ÿä»£ç†ç¯å¢ƒå˜é‡ï¼ˆæœ€å¸¸è§é—®é¢˜ï¼‰

**é—®é¢˜ï¼š** å¦‚æœæ‚¨ä½¿ç”¨äº† Clashã€V2Ray ç­‰ä»£ç†è½¯ä»¶ï¼Œç³»ç»Ÿå¯èƒ½è®¾ç½®äº†ä»£ç†ç¯å¢ƒå˜é‡ï¼Œä½†ä»£ç†ç«¯å£ä¸å¯ç”¨ï¼Œå¯¼è‡´è¿æ¥è¶…æ—¶ã€‚

#### 0.1 æ£€æŸ¥ç³»ç»Ÿä»£ç†

åœ¨ Git Bash æˆ– PowerShell ä¸­è¿è¡Œï¼š

```bash
# Git Bash
set | grep -i proxy

# PowerShell
Get-ChildItem Env:*proxy*
```

å¦‚æœçœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
```
HTTP_PROXY=http://127.0.0.1:33210
HTTPS_PROXY=http://127.0.0.1:33210
ALL_PROXY=socks5://127.0.0.1:33211
```

è¿™äº›ä»£ç†å¯èƒ½æ­£åœ¨å¹²æ‰°åº”ç”¨çš„ç½‘ç»œè¿æ¥ã€‚

#### 0.2 è§£å†³æ–¹æ³•

**æ–¹æ³• Aï¼šä½¿ç”¨æä¾›çš„å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰**

å·²ä¸ºæ‚¨åˆ›å»ºäº†æ¸…é™¤ä»£ç†çš„å¯åŠ¨è„šæœ¬ï¼š

**Windowsï¼š**
```bash
start-without-proxy.bat
```

**Linux/Macï¼š**
```bash
chmod +x start-without-proxy.sh
./start-without-proxy.sh
```

è¿™äº›è„šæœ¬ä¼šåœ¨å¯åŠ¨åº”ç”¨å‰æ¸…é™¤æ‰€æœ‰ä»£ç†ç¯å¢ƒå˜é‡ã€‚

**æ–¹æ³• Bï¼šæ‰‹åŠ¨æ¸…é™¤ä»£ç†å¹¶å¯åŠ¨**

```bash
# Windows CMD
set HTTP_PROXY=
set HTTPS_PROXY=
set ALL_PROXY=
mvn spring-boot:run

# Git Bash / Linux / Mac
unset HTTP_PROXY HTTPS_PROXY ALL_PROXY http_proxy https_proxy all_proxy
mvn spring-boot:run
```

**æ–¹æ³• Cï¼šä»£ç å·²è‡ªåŠ¨å¤„ç†**

æœ€æ–°ç‰ˆæœ¬çš„ä»£ç å·²ç»æ·»åŠ äº† `Proxy.NO_PROXY` è®¾ç½®ï¼Œä¼šè‡ªåŠ¨å¿½ç•¥ç³»ç»Ÿä»£ç†ï¼ˆé™¤éæ‚¨åœ¨ `application.properties` ä¸­æ˜ç¡®å¯ç”¨ä»£ç†ï¼‰ã€‚

---

### æ–¹æ¡ˆ 1: æ£€æŸ¥ç½‘ç»œè¿æ¥

#### 1.1 æµ‹è¯•åŸºæœ¬ç½‘ç»œè¿é€šæ€§

```bash
# æµ‹è¯•èƒ½å¦è®¿é—® Anthropic API (Claude)
curl -v https://api.anthropic.com/v1/messages

# æµ‹è¯•èƒ½å¦è®¿é—® OpenAI API
curl -v https://api.openai.com/v1/chat/completions
```

**é¢„æœŸç»“æœï¼š**
- å¦‚æœè¿”å› `401 Unauthorized` æˆ–ç±»ä¼¼è®¤è¯é”™è¯¯ï¼Œè¯´æ˜ç½‘ç»œè¿é€šæ­£å¸¸ï¼Œåªæ˜¯ç¼ºå°‘APIå¯†é’¥
- å¦‚æœè¿”å› `Connection refused` æˆ– `timeout`ï¼Œè¯´æ˜ç½‘ç»œæ— æ³•è®¿é—®

#### 1.2 æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

ç¡®ä¿æ‚¨çš„é˜²ç«å¢™å…è®¸è®¿é—®ä»¥ä¸‹åŸŸåï¼š
- `api.anthropic.com` (Claude)
- `api.openai.com` (OpenAI)

---

### æ–¹æ¡ˆ 2: é…ç½®ä»£ç†æœåŠ¡å™¨

å¦‚æœæ‚¨çš„ç½‘ç»œç¯å¢ƒéœ€è¦é€šè¿‡ä»£ç†è®¿é—®å¤–ç½‘ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤é…ç½®ï¼š

#### 2.1 ç¼–è¾‘é…ç½®æ–‡ä»¶

æ‰“å¼€ `src/main/resources/application.properties`ï¼Œæ‰¾åˆ°ä»£ç†é…ç½®éƒ¨åˆ†ï¼š

```properties
# Proxy Configuration (optional)
# å–æ¶ˆæ³¨é‡Šå¹¶é…ç½®æ‚¨çš„ä»£ç†ä¿¡æ¯
ai.service.proxy.enabled=true
ai.service.proxy.host=your-proxy-host
ai.service.proxy.port=8080
ai.service.proxy.type=HTTP
```

#### 2.2 é…ç½®ç¤ºä¾‹

**HTTP ä»£ç†ç¤ºä¾‹ï¼š**
```properties
ai.service.proxy.enabled=true
ai.service.proxy.host=proxy.company.com
ai.service.proxy.port=8080
ai.service.proxy.type=HTTP
```

**SOCKS ä»£ç†ç¤ºä¾‹ï¼š**
```properties
ai.service.proxy.enabled=true
ai.service.proxy.host=127.0.0.1
ai.service.proxy.port=1080
ai.service.proxy.type=SOCKS
```

#### 2.3 é‡å¯åº”ç”¨

ä¿®æ”¹é…ç½®åï¼Œéœ€è¦é‡å¯åº”ç”¨ï¼š

```bash
mvn spring-boot:run
```

---

### æ–¹æ¡ˆ 3: éªŒè¯ API å¯†é’¥

#### 3.1 æ£€æŸ¥ API å¯†é’¥é…ç½®

æ‰“å¼€ `application.properties`ï¼Œç¡®è®¤å·²æ­£ç¡®é…ç½® API å¯†é’¥ï¼š

```properties
# ç¡®è®¤ä½¿ç”¨å“ªä¸ªæä¾›å•†
ai.service.provider=openai

# OpenAI é…ç½®
ai.service.openai.api-key=your-actual-api-key
ai.service.openai.api-endpoint=https://api.openai.com/v1/chat/completions

# Claude é…ç½®
ai.service.claude.api-key=your-actual-api-key
ai.service.claude.api-endpoint=https://api.anthropic.com/v1/messages
```

#### 3.2 ç‹¬ç«‹æµ‹è¯• API å¯†é’¥

**æµ‹è¯• OpenAI APIï¼š**

```bash
curl https://api.openai.com/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -d '{
    "model": "gpt-4",
    "messages": [{"role": "user", "content": "Hello"}],
    "max_tokens": 10
  }'
```

**æµ‹è¯• Claude APIï¼š**

```bash
curl https://api.anthropic.com/v1/messages \
  -H "content-type: application/json" \
  -H "x-api-key: YOUR_API_KEY" \
  -H "anthropic-version: 2023-06-01" \
  -d '{
    "model": "claude-3-5-sonnet-20241022",
    "max_tokens": 10,
    "messages": [{"role": "user", "content": "Hello"}]
  }'
```

**æˆåŠŸå“åº”ç¤ºä¾‹ï¼š**
- å¦‚æœ API å¯†é’¥æœ‰æ•ˆï¼Œä¼šè¿”å›å¸¦æœ‰ `content` å­—æ®µçš„ JSON å“åº”
- å¦‚æœ API å¯†é’¥æ— æ•ˆï¼Œä¼šè¿”å› `401 Unauthorized` é”™è¯¯

---

### æ–¹æ¡ˆ 4: è°ƒæ•´è¶…æ—¶è®¾ç½®

å¦‚æœæ‚¨çš„ç½‘ç»œé€Ÿåº¦è¾ƒæ…¢ï¼Œå¯ä»¥å¢åŠ è¶…æ—¶æ—¶é—´ï¼š

ç¼–è¾‘ `application.properties`ï¼š

```properties
# å¢åŠ è¶…æ—¶æ—¶é—´ï¼ˆå½“å‰å·²è®¾ç½®ä¸ºè¾ƒé•¿æ—¶é—´ï¼‰
ai.service.timeout=120
ai.service.max-retries=5
```

æˆ–è€…ç›´æ¥ä¿®æ”¹ `WebClientConfig.java`ï¼š

```java
factory.setConnectTimeout(120000);  // 120ç§’è¿æ¥è¶…æ—¶
factory.setReadTimeout(240000);     // 240ç§’è¯»å–è¶…æ—¶
```

---

### æ–¹æ¡ˆ 5: ä½¿ç”¨å¤‡ç”¨ API ç«¯ç‚¹

æŸäº›åœ°åŒºå¯èƒ½æ— æ³•è®¿é—®å®˜æ–¹ APIï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ç¬¬ä¸‰æ–¹è½¬å‘æœåŠ¡æˆ–å¤‡ç”¨ç«¯ç‚¹ï¼š

```properties
# ä½¿ç”¨å¤‡ç”¨ç«¯ç‚¹ï¼ˆä»…ç¤ºä¾‹ï¼Œéœ€è¦æ‚¨è‡ªå·±æ‰¾åˆ°å¯ç”¨çš„ï¼‰
ai.service.openai.api-endpoint=https://your-proxy-domain.com/v1/chat/completions
```

---

## ğŸ”§ ç³»ç»Ÿå·²å®ç°çš„å®¹é”™æœºåˆ¶

ç³»ç»Ÿå·²å†…ç½®ä»¥ä¸‹å®¹é”™æªæ–½ï¼š

### 1. è‡ªåŠ¨é‡è¯•æœºåˆ¶

- **é»˜è®¤é‡è¯•æ¬¡æ•°ï¼š** 3 æ¬¡
- **é‡è¯•ç­–ç•¥ï¼š** æŒ‡æ•°é€€é¿ï¼ˆ2ç§’ã€4ç§’ã€8ç§’ï¼‰
- **é…ç½®ä½ç½®ï¼š** `application.properties` â†’ `ai.service.max-retries`

### 2. å¢å¼ºçš„é”™è¯¯æç¤º

ç³»ç»Ÿä¼šæ ¹æ®ä¸åŒçš„é”™è¯¯ç±»å‹æä¾›å‹å¥½çš„é”™è¯¯ä¿¡æ¯ï¼š

| HTTP çŠ¶æ€ç  | é”™è¯¯ä¿¡æ¯ |
|------------|---------|
| 401 | APIå¯†é’¥æ— æ•ˆæˆ–å·²è¿‡æœŸï¼Œè¯·æ£€æŸ¥é…ç½® |
| 403 | APIè®¿é—®è¢«æ‹’ç»ï¼Œè¯·æ£€æŸ¥APIå¯†é’¥æƒé™ |
| 429 | APIè°ƒç”¨é¢‘ç‡è¶…é™ï¼Œè¯·ç¨åé‡è¯• |
| 500 | AIæœåŠ¡å†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯• |
| 503 | AIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯• |
| ç½‘ç»œé”™è¯¯ | ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œæ— æ³•è®¿é—®AIæœåŠ¡ã€‚è¯·æ£€æŸ¥ç½‘ç»œé…ç½® |

### 3. è¯¦ç»†æ—¥å¿—è®°å½•

æ‰€æœ‰ API è°ƒç”¨éƒ½ä¼šè®°å½•è¯¦ç»†æ—¥å¿—ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜ï¼š

```
è°ƒç”¨OpenAI API - å°è¯• 1/3
OpenAI APIè°ƒç”¨å¤±è´¥ (å°è¯• 1/3): Connection timeout
ç­‰å¾…2ç§’åé‡è¯•...
```

---

## ğŸ“‹ å®Œæ•´æ£€æŸ¥æ¸…å•

åœ¨è”ç³»æŠ€æœ¯æ”¯æŒå‰ï¼Œè¯·ä¾æ¬¡æ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] 1. ç½‘ç»œè¿æ¥æ­£å¸¸ï¼Œå¯ä»¥è®¿é—®å¤–ç½‘
- [ ] 2. é˜²ç«å¢™å…è®¸è®¿é—® `api.anthropic.com` å’Œ `api.openai.com`
- [ ] 3. API å¯†é’¥å·²æ­£ç¡®é…ç½®ä¸”æœªè¿‡æœŸ
- [ ] 4. ä½¿ç”¨ curl æµ‹è¯• API å¯†é’¥æœ‰æ•ˆ
- [ ] 5. å¦‚éœ€ä»£ç†ï¼Œå·²æ­£ç¡®é…ç½®ä»£ç†ä¿¡æ¯
- [ ] 6. æ£€æŸ¥åº”ç”¨æ—¥å¿— (`logs/` ç›®å½•) æŸ¥çœ‹è¯¦ç»†é”™è¯¯
- [ ] 7. å°è¯•åˆ‡æ¢ä¸åŒçš„ AI æä¾›å•†ï¼ˆClaude â†” OpenAIï¼‰
- [ ] 8. é‡å¯åº”ç”¨åé‡æ–°æµ‹è¯•

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•æµç¨‹

### æ­¥éª¤ 1: å¯åŠ¨åº”ç”¨

```bash
cd "D:\å·¥ä½œ\åˆåŒå®¡æŸ¥ç³»ç»Ÿå¼€å‘\spring boot\Contract_review"
mvn spring-boot:run
```

### æ­¥éª¤ 2: æ£€æŸ¥ AI æœåŠ¡çŠ¶æ€

è®¿é—®ï¼š`http://localhost:8080`ï¼Œæ‰“å¼€"è‡ªåŠ¨åŒ–å®¡æŸ¥"é€‰é¡¹å¡ï¼ŒæŸ¥çœ‹ AI æœåŠ¡çŠ¶æ€æŒ‡ç¤ºå™¨ã€‚

### æ­¥éª¤ 3: ä¸Šä¼ æµ‹è¯•æ–‡ä»¶

é€‰æ‹©ä¸€ä¸ªç®€å•çš„ `.docx` åˆåŒæ–‡ä»¶ï¼ˆå»ºè®® < 10 é¡µï¼‰ï¼Œé€‰æ‹©åˆåŒç±»å‹ï¼Œç‚¹å‡»"å¼€å§‹è‡ªåŠ¨å®¡æŸ¥"ã€‚

### æ­¥éª¤ 4: è§‚å¯Ÿé”™è¯¯ä¿¡æ¯

- å¦‚æœå‡ºç°ç½‘ç»œé”™è¯¯ï¼ŒæŸ¥çœ‹å…·ä½“é”™è¯¯æç¤º
- æ ¹æ®é”™è¯¯ç±»å‹é€‰æ‹©å¯¹åº”çš„è§£å†³æ–¹æ¡ˆ
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°å’Œåç«¯æ—¥å¿—

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœä»¥ä¸Šæ–¹æ¡ˆéƒ½æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **é”™è¯¯æ—¥å¿—ï¼š** å®Œæ•´çš„é”™è¯¯å †æ ˆä¿¡æ¯
2. **ç½‘ç»œç¯å¢ƒï¼š** æ˜¯å¦ä½¿ç”¨ä»£ç†ã€é˜²ç«å¢™è®¾ç½®
3. **æµ‹è¯•ç»“æœï¼š** curl æµ‹è¯• API çš„è¿”å›ç»“æœ
4. **é…ç½®ä¿¡æ¯ï¼š** `application.properties` çš„ç›¸å…³é…ç½®ï¼ˆéšè— API å¯†é’¥ï¼‰
5. **ç³»ç»Ÿç‰ˆæœ¬ï¼š** Java ç‰ˆæœ¬ã€æ“ä½œç³»ç»Ÿç‰ˆæœ¬

---

## ğŸ“ é™„å½•ï¼šå¸¸è§é”™è¯¯ä»£ç 

### Java ç½‘ç»œå¼‚å¸¸

| å¼‚å¸¸ç±»å‹ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|------|---------|
| `ConnectException: Connection refused` | ç›®æ ‡æœåŠ¡å™¨æ‹’ç»è¿æ¥ | æ£€æŸ¥ API ç«¯ç‚¹ URL æ˜¯å¦æ­£ç¡® |
| `ConnectException: Connection timed out` | è¿æ¥è¶…æ—¶ | æ£€æŸ¥ç½‘ç»œè¿æ¥ã€é…ç½®ä»£ç† |
| `SocketTimeoutException: Read timed out` | è¯»å–è¶…æ—¶ | å¢åŠ è¯»å–è¶…æ—¶æ—¶é—´ |
| `UnknownHostException` | æ— æ³•è§£æåŸŸå | æ£€æŸ¥ DNS è®¾ç½®ã€ç½‘ç»œè¿æ¥ |
| `SSLHandshakeException` | SSL æ¡æ‰‹å¤±è´¥ | æ£€æŸ¥ç³»ç»Ÿè¯ä¹¦ã€æ›´æ–° JDK |

### HTTP çŠ¶æ€ç 

| çŠ¶æ€ç  | å«ä¹‰ | å¤„ç†æ–¹å¼ |
|-------|------|---------|
| 200 | æˆåŠŸ | æ­£å¸¸å¤„ç†å“åº” |
| 400 | è¯·æ±‚æ ¼å¼é”™è¯¯ | æ£€æŸ¥è¯·æ±‚å‚æ•° |
| 401 | æœªæˆæƒ | æ£€æŸ¥ API å¯†é’¥ |
| 403 | ç¦æ­¢è®¿é—® | æ£€æŸ¥ API æƒé™ |
| 429 | è¯·æ±‚è¿‡å¤š | ç­‰å¾…åé‡è¯• |
| 500 | æœåŠ¡å™¨é”™è¯¯ | ç¨åé‡è¯• |
| 503 | æœåŠ¡ä¸å¯ç”¨ | ç¨åé‡è¯• |

---

**æœ€åæ›´æ–°ï¼š** 2025-10-13
**ç‰ˆæœ¬ï¼š** 1.0
