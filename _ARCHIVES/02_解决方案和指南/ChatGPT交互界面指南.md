# ChatGPTé›†æˆæ¨¡å— UI ä½¿ç”¨å®Œå…¨æŒ‡å—

## ğŸ“‹ ç›®å½•
1. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
2. [å·¥ä½œæµç¨‹](#å·¥ä½œæµç¨‹)
3. [UI ä½¿ç”¨æ­¥éª¤](#ui-ä½¿ç”¨æ­¥éª¤)
4. [å‰åç«¯é€šä¿¡æµç¨‹](#å‰åç«¯é€šä¿¡æµç¨‹)
5. [å¸¸è§é—®é¢˜æ’æŸ¥](#å¸¸è§é—®é¢˜æ’æŸ¥)
6. [æ—¥å¿—è§£è¯»æŒ‡å—](#æ—¥å¿—è§£è¯»æŒ‡å—)

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒæ¦‚å¿µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      UI å±‚ (å‰ç«¯)                            â”‚
â”‚  - æ–‡ä»¶ä¸Šä¼                                                   â”‚
â”‚  - å‚æ•°é…ç½®                                                  â”‚
â”‚  - parseResultId å­˜å‚¨å’Œä¼ é€’                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   API å±‚ (åç«¯)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ /chatgpt/generate-prompt (æ­¥éª¤1)                     â”‚  â”‚
â”‚  â”‚ - ç”Ÿæˆå¸¦é”šç‚¹çš„æ–‡æ¡£                                    â”‚  â”‚
â”‚  â”‚ - è¿”å› parseResultId                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ /chatgpt/import-result (æ­¥éª¤2)                       â”‚  â”‚
â”‚  â”‚ - ä½¿ç”¨ç¼“å­˜çš„å¸¦é”šç‚¹æ–‡æ¡£è¿›è¡Œæ‰¹æ³¨ (ä½¿ç”¨parseResultId)  â”‚  â”‚
â”‚  â”‚ - è¿”å›æ‰¹æ³¨åçš„æ–‡æ¡£                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å­˜å‚¨å±‚ (ç¼“å­˜)                               â”‚
â”‚  - ParseResultCache: å­˜å‚¨å¸¦é”šç‚¹çš„æ–‡æ¡£ (4å°æ—¶æœ‰æ•ˆæœŸ)         â”‚
â”‚  - æ”¯æŒå¤šä¸ª parseResultId å¹¶è¡Œå¤„ç†                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®ä¿®å¤ç‚¹

| ç»„ä»¶ | ä¿®å¤å†…å®¹ | æ•ˆæœ |
|------|--------|------|
| **åç«¯ API** | `/generate-prompt` è¿”å› `parseResultId` | âœ… UI å¯è·å¾—ç¼“å­˜ ID |
| **åç«¯ API** | `/import-result` æ”¯æŒ `parseResultId` å‚æ•° | âœ… ä½¿ç”¨å¸¦é”šç‚¹æ–‡æ¡£ |
| **UI å…¨å±€å˜é‡** | æ·»åŠ  `chatgptParseResultId` | âœ… å­˜å‚¨ç¼“å­˜ ID |
| **UI ç”Ÿæˆæµç¨‹** | `generateChatGPTPrompt()` ä¿å­˜ ID | âœ… è‡ªåŠ¨å…³è” |
| **UI å¯¼å…¥æµç¨‹** | `importChatGPTResult()` ä¼ é€’ ID å‚æ•° | âœ… ç²¾ç¡®å®šä½ |

---

## ğŸ”„ å·¥ä½œæµç¨‹

### å®Œæ•´æµç¨‹å›¾

```
ç”¨æˆ·æ‰“å¼€ UI
    â†“
[æ­¥éª¤1] ä¸Šä¼ æ–‡ä»¶ (contract.docx)
    â†“
ğŸ“ handleChatGPTFileSelect()
    â””â”€â†’ chatgptFile = file
    â””â”€â†’ chatgptParseResultId = null (é‡ç½®)
    â†“
[æŒ‰é’®] ç”ŸæˆChatGPTæç¤º
    â†“
ğŸš€ generateChatGPTPrompt()
    â”œâ”€â†’ è°ƒç”¨ /chatgpt/generate-prompt?anchors=generate
    â”œâ”€â†’ åç«¯: è§£ææ–‡ä»¶ + ç”Ÿæˆé”šç‚¹ + ç¼“å­˜æ–‡æ¡£
    â””â”€â†’ è¿”å›å“åº”åŒ…å«: parseResultId + prompt + instructions
    â†“
ğŸ’¾ showChatGPTPrompt(data)
    â”œâ”€â†’ chatgptPrompt = data.chatgptPrompt
    â”œâ”€â†’ chatgptParseResultId = data.parseResultId  ã€å…³é”®ï¼ã€‘
    â””â”€â†’ æ˜¾ç¤ºæç¤ºå†…å®¹ + å¯¼å…¥åŒºåŸŸ
    â†“
[ç”¨æˆ·æ“ä½œ] å¤åˆ¶æç¤º â†’ æ‰“å¼€ChatGPT â†’ è¿›è¡Œå®¡æŸ¥
    â†“
[ç”¨æˆ·æ“ä½œ] å¤åˆ¶ChatGPTè¿”å›çš„JSON â†’ ç²˜è´´åˆ°æ–‡æœ¬æ¡†
    â†“
[æŒ‰é’®] å¯¼å…¥å¹¶ç”Ÿæˆæ‰¹æ³¨æ–‡æ¡£
    â†“
ğŸ”„ importChatGPTResult()
    â”œâ”€â†’ éªŒè¯JSONæ ¼å¼
    â”œâ”€â†’ æ£€æŸ¥ chatgptParseResultId æ˜¯å¦å­˜åœ¨
    â”œâ”€â†’ è°ƒç”¨ /chatgpt/import-result?parseResultId=XXX&cleanupAnchors=true
    â”‚   â”œâ”€ ã€ä½¿ç”¨ç¼“å­˜æ–‡æ¡£ã€‘ â† ç²¾ç¡®å®šä½ âœ…
    â”‚   â””â”€ ã€ä½¿ç”¨åŸå§‹æ–‡ä»¶ã€‘ â† å®šä½ä¸ç²¾ç¡® âš ï¸
    â””â”€â†’ è¿”å›æ‰¹æ³¨åçš„æ–‡æ¡£
    â†“
ğŸ“¥ downloadFile()
    â”œâ”€â†’ ä¸‹è½½ contract_ChatGPTå®¡æŸ¥.docx
    â””â”€â†’ æ˜¾ç¤ºå®Œæˆæç¤º + å®šä½æ–¹å¼è¯´æ˜
    â†“
âœ… å®Œæˆ
```

---

## ğŸ¯ UI ä½¿ç”¨æ­¥éª¤

### å¿…è¯»ï¼šå®Œæ•´æ“ä½œæ­¥éª¤

#### æ­¥éª¤ 1ï¸âƒ£: ä¸Šä¼ æ–‡ä»¶å¹¶ç”Ÿæˆæç¤º

```
1. æ‰“å¼€ http://localhost:8080
2. åˆ‡æ¢åˆ° "ğŸ’¬ ChatGPTé›†æˆ" æ ‡ç­¾
3. åœ¨ "ğŸ“ æ­¥éª¤1" åŒºåŸŸï¼š
   - ç‚¹å‡» "ğŸ“ é€‰æ‹©åˆåŒæ–‡ä»¶"
   - é€‰æ‹©ä½ çš„ .docx æ–‡ä»¶
   - æ–‡ä»¶åä¼šæ˜¾ç¤ºåœ¨ä¸‹æ–¹
4. é€‰æ‹©"åˆåŒç±»å‹"ï¼ˆé»˜è®¤: æŠ€æœ¯æœåŠ¡åˆåŒï¼‰
5. ç‚¹å‡» "ğŸ¤– ç”ŸæˆChatGPTæç¤º"
   â†“ ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
   - è§£ææ–‡ä»¶
   - ç”Ÿæˆé”šç‚¹
   - ç¼“å­˜æ–‡æ¡£å¹¶è¿”å› parseResultId
   - æ˜¾ç¤º ChatGPT æç¤ºå†…å®¹
```

âœ… **å…³é”®æ£€æŸ¥ç‚¹**ï¼š
- çœ‹åˆ° toast æç¤º: `âœ… å·²ç”Ÿæˆé”šç‚¹ï¼ŒparseResultIdå·²ä¿å­˜ç”¨äºåç»­æ‰¹æ³¨`
- æµè§ˆå™¨æ§åˆ¶å° (F12) æ˜¾ç¤º: `âœ… æˆåŠŸè·å–parseResultId: a1b2c3d4-...`
- ç”Ÿæˆçš„æç¤ºå†…å®¹æ˜¾ç¤ºåœ¨ä¸‹æ–¹

#### æ­¥éª¤ 2ï¸âƒ£: åœ¨ ChatGPT ä¸­è¿›è¡Œå®¡æŸ¥

```
1. ç‚¹å‡» "ğŸŒ æ‰“å¼€ChatGPT" æŒ‰é’®
   â†’ è‡ªåŠ¨æ‰“å¼€ https://chatgpt.com/
2. æˆ–æ‰‹åŠ¨æ‰“å¼€ https://chatgpt.com/
3. ç‚¹å‡» "ğŸ“‹ å¤åˆ¶æç¤º" æŒ‰é’®
   â†’ Prompt å·²å¤åˆ¶åˆ°å‰ªè´´æ¿
   â†’ ä¼šçœ‹åˆ° toast æç¤º: `è¯·æ‰“å¼€ https://chatgpt.com/ å¹¶ç²˜è´´æç¤º`
4. åœ¨ ChatGPT ä¸­ç²˜è´´æç¤º
5. ç­‰å¾… ChatGPT è¿”å›å®¡æŸ¥ç»“æœï¼ˆJSON æ ¼å¼ï¼‰
6. å¤åˆ¶å®Œæ•´çš„ ChatGPT å›å¤
```

âœ… **å…³é”®æ£€æŸ¥ç‚¹**ï¼š
- ChatGPT è¿”å›åŒ…å« `"issues"` å­—æ®µçš„ JSON
- æ¯ä¸ª issue æœ€å¥½åŒ…å« `"targetText"` å’Œ `"severity"` å­—æ®µ
- å›å¤å¯ä»¥åŒ…å« markdown ä»£ç å— (```json...```)ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ¸…ç†

#### æ­¥éª¤ 3ï¸âƒ£: å¯¼å…¥å®¡æŸ¥ç»“æœå¹¶ç”Ÿæˆæ‰¹æ³¨æ–‡æ¡£

```
1. åœ¨ "ğŸ“¥ æ­¥éª¤2: å¯¼å…¥ChatGPTå®¡æŸ¥ç»“æœ" åŒºåŸŸ
2. ç‚¹å‡» ChatGPT å›å¤æ–‡æœ¬æ¡†
3. ç²˜è´´ ChatGPT çš„å®Œæ•´å›å¤
4. ï¼ˆå¯é€‰ï¼‰å–æ¶ˆå‹¾é€‰ "æ‰¹æ³¨å®Œæˆåæ¸…ç†é”šç‚¹"
   â†’ ä¿ç•™é”šç‚¹ä»¥æ”¯æŒåç»­å¢é‡å®¡æŸ¥
5. ç‚¹å‡» "ğŸ“¥ å¯¼å…¥å¹¶ç”Ÿæˆæ‰¹æ³¨æ–‡æ¡£"
   â†“ ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
   - éªŒè¯ JSON æ ¼å¼
   - ã€å…³é”®ã€‘ä½¿ç”¨ç¼“å­˜çš„å¸¦é”šç‚¹æ–‡æ¡£è¿›è¡Œæ‰¹æ³¨
   - è¿”å›æ‰¹æ³¨åçš„æ–‡æ¡£å¹¶ä¸‹è½½
```

âœ… **å…³é”®æ£€æŸ¥ç‚¹**ï¼š
- çœ‹åˆ° toast: `âœ… ChatGPTå®¡æŸ¥ç»“æœå¯¼å…¥æˆåŠŸ! æ–‡æ¡£å·²ä¸‹è½½`
- å®Œæˆæç¤ºæ˜¾ç¤º: `âœ… ä½¿ç”¨ç¼“å­˜çš„å¸¦é”šç‚¹æ–‡æ¡£è¿›è¡Œæ‰¹æ³¨ - å®šä½ç²¾åº¦æœ€é«˜`
- æ–‡æ¡£è‡ªåŠ¨ä¸‹è½½: `contract_ChatGPTå®¡æŸ¥.docx`

---

## ğŸ”— å‰åç«¯é€šä¿¡æµç¨‹

### è¯·æ±‚/å“åº”è¯¦è§£

#### è¯·æ±‚1: ç”Ÿæˆæç¤º

**å‰ç«¯ JavaScript:**
```javascript
const url = `/chatgpt/generate-prompt?contractType=technology&anchors=generate`;
// ã€å…³é”®ã€‘anchors=generate ç¡®ä¿è¿”å› parseResultId

const response = await fetch(url, {
    method: 'POST',
    body: formData  // åŒ…å« file
});

const data = await response.json();
chatgptParseResultId = data.parseResultId;  // ã€å…³é”®ã€‘ä¿å­˜ID
```

**åç«¯ Java:**
```java
@PostMapping("/generate-prompt")
public ResponseEntity<?> generatePrompt(
    @RequestParam("file") MultipartFile file,
    @RequestParam(value = "anchors", defaultValue = "generate") String anchors) {

    // 1. è§£ææ–‡ä»¶
    ParseResultWithDocument resultWithDoc =
        contractParseService.parseContractWithDocument(file, anchors);

    // 2. ç”Ÿæˆé”šç‚¹å¹¶ç¼“å­˜æ–‡æ¡£
    String parseResultId = parseResultCache.store(
        resultWithDoc.getParseResult(),
        resultWithDoc.getDocumentBytes(),
        file.getOriginalFilename()
    );

    // 3. è¿”å› parseResultId ç»™å‰ç«¯
    result.put("parseResultId", parseResultId);  // ã€å…³é”®ã€‘
    result.put("chatgptPrompt", ...);
    return ResponseEntity.ok(result);
}
```

**å“åº”æ•°æ®ç»“æ„:**
```json
{
  "parseResultId": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "filename": "contract.docx",
  "chatgptPrompt": "è¯·å®¡æŸ¥ä»¥ä¸‹åˆåŒ...",
  "instructions": ["å¤åˆ¶æç¤º", "ç²˜è´´åˆ°ChatGPT", ...],
  "parseResult": { "clauses": [...] },
  "documentWithAnchorsBase64": "UEsDBAoAAA...",
  "anchorsEnabled": true
}
```

---

#### è¯·æ±‚2: å¯¼å…¥å®¡æŸ¥ç»“æœ

**å‰ç«¯ JavaScript:**
```javascript
// ã€å…³é”®ä¿®å¤ã€‘ä¼ é€’ parseResultId å‚æ•°
let url = `/chatgpt/import-result?cleanupAnchors=true`;

if (chatgptParseResultId) {
    url += `&parseResultId=${encodeURIComponent(chatgptParseResultId)}`;
    // ä½¿ç”¨ç¼“å­˜çš„å¸¦é”šç‚¹æ–‡æ¡£ âœ…
}

const response = await fetch(url, {
    method: 'POST',
    body: formData  // åŒ…å« chatgptResponse (JSON å®¡æŸ¥ç»“æœ)
});
```

**åç«¯ Java:**
```java
@PostMapping("/import-result")
public ResponseEntity<?> importResult(
    @RequestParam(value = "file", required = false) MultipartFile file,
    @RequestParam(value = "parseResultId", required = false) String parseResultId,
    @RequestParam("chatgptResponse") String chatgptResponse,
    @RequestParam(value = "cleanupAnchors", defaultValue = "true") boolean cleanupAnchors) {

    byte[] documentToAnnotate = null;

    // ã€å…³é”®ä¿®å¤ã€‘ä¼˜å…ˆä½¿ç”¨ç¼“å­˜çš„å¸¦é”šç‚¹æ–‡æ¡£
    if (parseResultId != null && !parseResultId.isEmpty()) {
        ParseResultCache.CachedParseResult cached =
            parseResultCache.retrieve(parseResultId);

        if (cached != null && cached.documentWithAnchorsBytes != null) {
            // âœ… ä½¿ç”¨ç¼“å­˜çš„å¸¦é”šç‚¹æ–‡æ¡£
            documentToAnnotate = cached.documentWithAnchorsBytes;
            logger.info("âœ… [ç¼“å­˜å‘½ä¸­] æˆåŠŸä½¿ç”¨ç¼“å­˜çš„å¸¦é”šç‚¹æ–‡æ¡£");
        }
    }

    // ã€é™çº§ã€‘å¦‚æœç¼“å­˜å¤±è´¥ï¼Œä½¿ç”¨ä¸Šä¼ çš„æ–‡ä»¶
    if (documentToAnnotate == null && file != null) {
        documentToAnnotate = file.getBytes();
        logger.warn("âš ï¸ [é™çº§æ–¹æ¡ˆ] ä½¿ç”¨ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ï¼ˆä¸åŒ…å«é”šç‚¹ï¼‰");
    }

    // æ‰¹æ³¨å¹¶è¿”å›
    byte[] annotatedDocument =
        xmlContractAnnotateService.annotateContractWithXml(
            mockFile, chatgptResponse, anchorStrategy, cleanupAnchors);

    return ResponseEntity.ok().body(new ByteArrayResource(annotatedDocument));
}
```

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### âŒ é—®é¢˜ 1: "defineIssueså­˜åœ¨ä½†éƒ½æ— æ³•å®šä½"

**ç—‡çŠ¶ï¼š**
```
âš ï¸ æœªæ‰¾åˆ°anchorIdå¯¹åº”çš„ä¹¦ç­¾ï¼šanchorId=anc-c1-xxxx, æ–‡æ¡£ä¸­æ€»ä¹¦ç­¾æ•°=1
ğŸ“Œ é”šç‚¹æŸ¥æ‰¾å¤±è´¥ï¼Œå›é€€åˆ°æ–‡æœ¬åŒ¹é…
```

**åŸå› ï¼š**
- åç«¯ä½¿ç”¨çš„æ˜¯**ä¸å¸¦é”šç‚¹çš„åŸå§‹æ–‡æ¡£**
- parseResultId æ²¡æœ‰æ­£ç¡®ä¼ é€’

**æ’æŸ¥æ­¥éª¤ï¼š**
1. æ‰“å¼€æµè§ˆå™¨ F12 æ§åˆ¶å°
2. æŸ¥çœ‹æ˜¯å¦è¾“å‡º: `âœ… æˆåŠŸè·å–parseResultId: ...`
   - âœ… æœ‰ â†’ é—®é¢˜åœ¨æ­¥éª¤2
   - âŒ æ—  â†’ é—®é¢˜åœ¨æ­¥éª¤1

**è§£å†³æ–¹æ¡ˆï¼š**
- âœ… æ­¥éª¤1: ç¡®ä¿çœ‹åˆ° `âœ… å·²ç”Ÿæˆé”šç‚¹...` çš„ toast
- âœ… æ­¥éª¤2: æŸ¥çœ‹ç½‘ç»œè¯·æ±‚ (F12 Network)
  - æ£€æŸ¥ `/import-result` è¯·æ±‚çš„ URL å‚æ•°
  - åº”è¯¥åŒ…å«: `?parseResultId=...&cleanupAnchors=...`

---

### âŒ é—®é¢˜ 2: "ChatGPTè¿”å›çš„JSONæ— æ³•è§£æ"

**ç—‡çŠ¶ï¼š**
```
âŒ ChatGPTå“åº”æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥JSONæ ¼å¼
```

**åŸå› ï¼š**
- ChatGPT è¿”å›çš„ä¸æ˜¯æœ‰æ•ˆçš„ JSON
- åŒ…å« markdown ä»£ç å—æœªæ­£ç¡®æ¸…ç†

**æ’æŸ¥æ­¥éª¤ï¼š**
1. å¤åˆ¶ç²˜è´´çš„å†…å®¹åŒ…å«äº† markdown æ ‡è®°?
   ```
   ```json
   { ... }
   ```
   ```
   â†’ âœ… ç³»ç»Ÿä¼šè‡ªåŠ¨æ¸…ç†

2. JSON å­—ç¬¦ä¸²åŒ…å«æœªè½¬ä¹‰çš„å¼•å·?
   â†’ âŒ éœ€è¦åœ¨ ChatGPT ä¸­ä¿®å¤

**è§£å†³æ–¹æ¡ˆï¼š**
```javascript
// ç³»ç»Ÿè‡ªåŠ¨æ¸…ç†ä»¥ä¸‹æ ¼å¼ï¼š
// 1. ```json ... ``` â†’ ç§»é™¤ markdown æ ‡è®°
// 2. ``` ... ``` â†’ ç§»é™¤ markdown æ ‡è®°
// 3. å‰åç©ºç™½ â†’ trim()

// å¦‚æœä»å¤±è´¥ï¼Œæ£€æŸ¥ JSON ç»“æ„ï¼š
{
  "issues": [
    {
      "clauseId": "c1",
      "severity": "HIGH",
      "targetText": "è¦æ‰¹æ³¨çš„æ–‡å­—",
      "finding": "æ‰¾åˆ°çš„é—®é¢˜",
      "suggestion": "å»ºè®®"
    }
  ]
}
```

---

### âŒ é—®é¢˜ 3: "ä¸‹è½½çš„æ–‡ä»¶é‡Œæ²¡æœ‰æ‰¹æ³¨"

**ç—‡çŠ¶ï¼š**
- æ–‡ä»¶ä¸‹è½½æˆåŠŸ
- ä½†æ‰“å¼€åçœ‹ä¸åˆ° ChatGPT çš„æ‰¹æ³¨

**åŸå› ï¼š**
1. ä½¿ç”¨äº†åŸå§‹æ–‡ä»¶ï¼ˆä¸å¸¦é”šç‚¹ï¼‰
2. targetText ä¸åŸæ–‡å®Œå…¨ä¸åŒ¹é…
3. ChatGPT è¿”å›çš„ JSON ä¸­æ²¡æœ‰ issues

**æ’æŸ¥æ­¥éª¤ï¼š**
1. æ£€æŸ¥å®Œæˆæç¤ºï¼š
   - âœ… `âœ… ä½¿ç”¨ç¼“å­˜çš„å¸¦é”šç‚¹æ–‡æ¡£è¿›è¡Œæ‰¹æ³¨ - å®šä½ç²¾åº¦æœ€é«˜`
   - âš ï¸ `âš ï¸ ä½¿ç”¨åŸå§‹æ–‡ä»¶è¿›è¡Œæ‰¹æ³¨ - å®šä½ç²¾åº¦å¯èƒ½é™ä½`

2. å¦‚æœæ˜¯ âš ï¸ â†’ é‡æ–°æŒ‰æ­¥éª¤1ç”Ÿæˆï¼ˆç¡®ä¿ parseResultId è¢«ä¿å­˜ï¼‰

3. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼š
   ```
   âœ… [ç¼“å­˜å‘½ä¸­] æˆåŠŸä½¿ç”¨ç¼“å­˜çš„å¸¦é”šç‚¹æ–‡æ¡£...
   æˆ–
   âš ï¸ [é™çº§æ–¹æ¡ˆ] ä½¿ç”¨ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶...
   ```

**è§£å†³æ–¹æ¡ˆï¼š**
- æ¸…ç©ºè¡¨å•ï¼Œé‡æ–°ä»æ­¥éª¤1å¼€å§‹
- ç¡®ä¿ parseResultId è¢«æ­£ç¡®ä¿å­˜å’Œä¼ é€’

---

### âŒ é—®é¢˜ 4: "parseResultId å·²è¿‡æœŸ"

**ç—‡çŠ¶ï¼š**
```
parseResultId å·²è¿‡æœŸä¸”æ²¡æœ‰æä¾› file å‚æ•°
```

**åŸå› ï¼š**
- parseResultId è¶…è¿‡ 4 å°æ—¶
- ç¼“å­˜åœ¨æœåŠ¡å™¨ä¸­è¢«æ¸…ç†

**è§£å†³æ–¹æ¡ˆï¼š**
- é‡æ–°è°ƒç”¨ `/generate-prompt` ç«¯ç‚¹è·å–æ–°çš„ parseResultId
- ç¼“å­˜æœ‰æ•ˆæœŸä¸º 4 å°æ—¶ï¼Œè¶³ä»¥å®Œæˆæ•´ä¸ªå®¡æŸ¥æµç¨‹

---

## ğŸ“Š æ—¥å¿—è§£è¯»æŒ‡å—

### å‰ç«¯æ—¥å¿— (æµè§ˆå™¨æ§åˆ¶å°)

#### ç”Ÿæˆæç¤ºæ—¶çš„æ—¥å¿—

**âœ… æˆåŠŸæƒ…å†µï¼š**
```javascript
âœ… æˆåŠŸè·å–parseResultId: a1b2c3d4-e5f6-7890-abcd-ef1234567890
```
â†’ parseResultId å·²ä¿å­˜åˆ° `chatgptParseResultId` å…¨å±€å˜é‡

**âš ï¸ è­¦å‘Šæƒ…å†µï¼š**
```javascript
âš ï¸ å“åº”ä¸­æœªåŒ…å«parseResultIdï¼Œåç»­æ‰¹æ³¨å¯èƒ½ä¸ç²¾ç¡®
```
â†’ åç«¯æ²¡æœ‰è¿”å› parseResultIdï¼Œéœ€è¦æ£€æŸ¥åç«¯ä»£ç 

#### å¯¼å…¥ç»“æœæ—¶çš„æ—¥å¿—

**âœ… æˆåŠŸæƒ…å†µï¼š**
```javascript
âœ… ä½¿ç”¨parseResultIdè¿›è¡Œæ‰¹æ³¨: a1b2c3d4-e5f6-...
```
â†’ ä½¿ç”¨äº†ç¼“å­˜çš„å¸¦é”šç‚¹æ–‡æ¡£

**âš ï¸ è­¦å‘Šæƒ…å†µï¼š**
```javascript
âš ï¸ parseResultIdä¸å­˜åœ¨ï¼Œå°†ä½¿ç”¨åŸå§‹æ–‡ä»¶è¿›è¡Œæ‰¹æ³¨ï¼ˆå¯èƒ½å®šä½ä¸ç²¾ç¡®ï¼‰
âš ï¸ æ— æ³•ä½¿ç”¨parseResultIdï¼Œæ‰¹æ³¨å®šä½ç²¾åº¦å¯èƒ½é™ä½
```
â†’ parseResultId ä¸¢å¤±æˆ–ä¸ºç©ºï¼Œé™çº§åˆ°åŸå§‹æ–‡ä»¶æ¨¡å¼

---

### åç«¯æ—¥å¿— (æœåŠ¡å™¨æ§åˆ¶å°)

#### ç”Ÿæˆæç¤ºç«¯ç‚¹æ—¥å¿—

```
ğŸ” [/generate-prompt] è¯·æ±‚å‚æ•°:
   filename=contract.docx,
   contractType=technology,
   anchors=generate

ã€ç¼“å­˜ã€‘Parse ç»“æœå·²å­˜å‚¨:
   parseResultId=a1b2c3d4-e5f6-7890-abcd-ef1234567890,
   æ¡æ¬¾æ•°=8,
   æ–‡æ¡£å¤§å°=45328 å­—èŠ‚
```

#### å¯¼å…¥ç»“æœç«¯ç‚¹æ—¥å¿—

**âœ… ä½¿ç”¨ç¼“å­˜æ–‡æ¡£ï¼š**
```
ğŸ” [/import-result] è¯·æ±‚å‚æ•°:
   parseResultId=âœ“ a1b2c3d4-e5f6-7890-abcd-ef1234567890,
   hasFile=âœ“ contract.docx

ğŸ” [ç¼“å­˜æ£€ç´¢] å°è¯•ä»ç¼“å­˜ä¸­æ£€ç´¢parseResultId: a1b2c3d4-e5f6-...

âœ… [ç¼“å­˜å‘½ä¸­] æˆåŠŸä½¿ç”¨ç¼“å­˜çš„å¸¦é”šç‚¹æ–‡æ¡£:
   parseResultId=a1b2c3d4-e5f6-...,
   å¤§å°=45328 å­—èŠ‚,
   æ–‡ä»¶å=contract.docx
```

**âš ï¸ ä½¿ç”¨åŸå§‹æ–‡ä»¶ï¼š**
```
âš ï¸ [å‚æ•°ç¼ºå¤±] parseResultId ä¸ºç©ºï¼Œå°†å°è¯•ä½¿ç”¨ file å‚æ•°

âš ï¸ [é™çº§æ–¹æ¡ˆ] ä½¿ç”¨ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œæ‰¹æ³¨ï¼Œå¯èƒ½ä¸åŒ…å«é”šç‚¹ã€‚
   å»ºè®®ï¼šè¯·ä½¿ç”¨ parseResultId å‚æ•°ä»¥è·å¾—æœ€ä½³æ•ˆæœã€‚
```

#### æ‰¹æ³¨å®šä½æ—¥å¿—

**ä½¿ç”¨é”šç‚¹å®šä½ï¼ˆç²¾ç¡®ï¼‰ï¼š**
```
âœ… [ç¼“å­˜å‘½ä¸­] æˆåŠŸä½¿ç”¨ç¼“å­˜çš„å¸¦é”šç‚¹æ–‡æ¡£...

å¼€å§‹æŸ¥æ‰¾ç›®æ ‡æ®µè½ï¼šclauseId=c1, anchorId=anc-c1-4f21

âœ“ é€šè¿‡anchorIdæ‰¾åˆ°å¯¹åº”çš„ä¹¦ç­¾ï¼šanchorId=anc-c1-4f21, æ–‡æ¡£ä¸­æ€»ä¹¦ç­¾æ•°=8

ä½¿ç”¨ç²¾ç¡®æ–‡å­—åŒ¹é…æ’å…¥æ‰¹æ³¨ï¼š...
```

**å›é€€åˆ°æ–‡æœ¬åŒ¹é…ï¼ˆå¯èƒ½ä¸ç²¾ç¡®ï¼‰ï¼š**
```
âš ï¸ [å‚æ•°ç¼ºå¤±] parseResultId ä¸ºç©º...

å¼€å§‹æŒ‰anchorIdæŸ¥æ‰¾æ®µè½ï¼šanchorId=anc-c1-4f21, æ€»æ®µè½æ•°=60

? æœªæ‰¾åˆ°anchorIdå¯¹åº”çš„ä¹¦ç­¾ï¼šanchorId=anc-c1-4f21, æ–‡æ¡£ä¸­æ€»ä¹¦ç­¾æ•°=1
   é”šç‚¹æŸ¥æ‰¾å¤±è´¥ï¼Œå›é€€åˆ°æ–‡æœ¬åŒ¹é…

å¼€å§‹æŒ‰æ–‡æœ¬åŒ¹é…æŸ¥æ‰¾æ®µè½ï¼šclauseId=c1, åŒ¹é…æ¨¡å¼æ•°=10
```

---

## âœ… å®Œæ•´éªŒè¯æ¸…å•

åœ¨æ‰¹æ³¨åï¼Œæ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ç¡®è®¤æˆåŠŸï¼š

- [ ] å‰ç«¯æ—¥å¿—æ˜¾ç¤º `âœ… æˆåŠŸè·å–parseResultId`
- [ ] ç”Ÿæˆæç¤ºåçœ‹åˆ° toast: `âœ… å·²ç”Ÿæˆé”šç‚¹ï¼ŒparseResultIdå·²ä¿å­˜`
- [ ] å¯¼å…¥ç»“æœåçœ‹åˆ° toast: `âœ… ChatGPTå®¡æŸ¥ç»“æœå¯¼å…¥æˆåŠŸ`
- [ ] å®Œæˆæç¤ºæ˜¾ç¤º: `âœ… ä½¿ç”¨ç¼“å­˜çš„å¸¦é”šç‚¹æ–‡æ¡£è¿›è¡Œæ‰¹æ³¨`
- [ ] åç«¯æ—¥å¿—æ˜¾ç¤º `âœ… [ç¼“å­˜å‘½ä¸­]`
- [ ] æ–‡ä»¶æˆåŠŸä¸‹è½½
- [ ] æ‰“å¼€æ–‡ä»¶åå¯çœ‹åˆ° ChatGPT çš„æ‰¹æ³¨

---

## ğŸ”„ ç³»ç»Ÿæ¼”è¿›åŠæ•…éšœè¯Šæ–­

### ä¿®å¤å‰çš„é—®é¢˜

| ç¯èŠ‚ | é—®é¢˜ | ç—‡çŠ¶ |
|------|------|------|
| æ­¥éª¤1 | è¿”å› parseResultId âŒ | UI æ— æ³•è·å¾—ç¼“å­˜ ID |
| æ­¥éª¤2 | ä¸æ”¯æŒ parseResultId å‚æ•° âŒ | åªèƒ½ä½¿ç”¨åŸå§‹æ–‡ä»¶ |
| UI å…¨å±€å˜é‡ | æ²¡æœ‰å­˜å‚¨æœºåˆ¶ âŒ | ID ä¸¢å¤±æ— æ³•ä¼ é€’ |
| æ‰¹æ³¨å®šä½ | å…¨éƒ¨å›é€€æ–‡æœ¬åŒ¹é… | å®šä½ä¸ç²¾ç¡®ï¼Œé—æ¼æ‰¹æ³¨ |
| æ—¥å¿— | ç¼ºå°‘è¯Šæ–­ä¿¡æ¯ | æ— æ³•åˆ¤æ–­ä½¿ç”¨å“ªä¸ªæ–‡æ¡£ |

### ä¿®å¤åçš„çŠ¶æ€

| ç¯èŠ‚ | æ”¹è¿› | éªŒè¯æ–¹å¼ |
|------|------|--------|
| æ­¥éª¤1 | âœ… è¿”å› parseResultId | æŸ¥çœ‹å“åº” JSON |
| æ­¥éª¤2 | âœ… æ”¯æŒ parseResultId å‚æ•° | æŸ¥çœ‹ URL å‚æ•° |
| UI å…¨å±€å˜é‡ | âœ… chatgptParseResultId | F12 è¾“å…¥æ£€æŸ¥ |
| æ‰¹æ³¨å®šä½ | âœ… ä¼˜å…ˆä½¿ç”¨é”šç‚¹ | æŸ¥çœ‹åç«¯æ—¥å¿— |
| æ—¥å¿— | âœ… è¯¦ç»†è¯Šæ–­ä¿¡æ¯ | æŸ¥çœ‹ toast å’Œåç«¯æ—¥å¿— |

---

## ğŸ“š å‚è€ƒèµ„æº

### ç›¸å…³æ–‡ä»¶

- **åç«¯ä»£ç **: `ChatGPTIntegrationController.java` (ç¬¬ 60-312 è¡Œ)
- **åç«¯æœåŠ¡**: `XmlContractAnnotateService.java`
- **ç¼“å­˜æœåŠ¡**: `ParseResultCache.java`
- **å‰ç«¯ä»£ç **: `main.js` (ç¬¬ 770-1065 è¡Œ)

### ç›¸å…³ç«¯ç‚¹

- `POST /chatgpt/generate-prompt` - ç”Ÿæˆæç¤ºå¹¶ç¼“å­˜æ–‡æ¡£
- `POST /chatgpt/import-result` - å¯¼å…¥ç»“æœå¹¶æ‰¹æ³¨ã€å·²ä¿®å¤ã€‘
- `POST /chatgpt/import-result-xml` - XML ä¸“ç”¨ç«¯ç‚¹ï¼ˆæ¨èï¼‰
- `GET /chatgpt/status` - æŸ¥çœ‹ ChatGPT é›†æˆçŠ¶æ€

---

**æœ€åæ›´æ–°**: 2025-10-22
**çŠ¶æ€**: âœ… å‰åç«¯å·²å®Œæ•´é€šè”ï¼Œæ”¯æŒ parseResultId ä¼ é€’
