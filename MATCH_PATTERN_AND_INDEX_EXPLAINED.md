# matchPattern 与 matchIndex 详解

---

## 🎯 matchPattern - 匹配模式

### 定义
`matchPattern` 决定**如何**在段落中查找您要批注的文字。

### 三种模式详解

#### 1️⃣ **EXACT** - 精确匹配（最严格）

**含义**: 必须完全匹配整个targetText

**使用场景**:
- 章节标题（唯一性强）
- 完整的短语或句子
- 不希望有任何偏差

**例子**:
```json
{
  "targetText": "五、保密与数据安全",
  "matchPattern": "EXACT"
}
```

Word文档中必须**完全相同**才能匹配：
```
✅ 匹配: "五、保密与数据安全"
❌ 不匹配: "五、 保密与数据安全"  (多了一个空格)
❌ 不匹配: "5. 保密与数据安全"    (格式不同)
❌ 不匹配: "保密与数据安全"        (少了"五、")
```

---

#### 2️⃣ **CONTAINS** - 包含匹配（中等严格）

**含义**: 只要段落中**包含**targetText就匹配

**使用场景**:
- 关键词查找
- 关键短语定位
- 文字可能出现多次

**例子**:
```json
{
  "targetText": "全部经济损失",
  "matchPattern": "CONTAINS"
}
```

Word文档中只要**包含**这个短语就能匹配：
```
✅ 匹配: "赔偿范围表述为"全部经济损失"，缺乏可预见性限制"
✅ 匹配: "需要赔偿全部经济损失"
✅ 匹配: "甲方需赔偿全部经济损失及其他费用"
❌ 不匹配: "赔偿全部经济"  (缺少"损失")
❌ 不匹配: "全部损失"      (缺少"经济")
```

---

#### 3️⃣ **REGEX** - 正则表达式匹配（最灵活）

**含义**: 使用正则表达式来匹配，非常灵活

**使用场景**:
- 复杂的匹配模式
- 多种变体（如时间表达）
- 模糊匹配

**例子**:

```json
{
  "targetText": "\\d{1,3}天",
  "matchPattern": "REGEX"
}
```

可以匹配：
```
✅ "30天" (1-3位数字+天)
✅ "15天"
✅ "365天"
✅ "合同有效期30天内完成"
❌ "三十天"    (不是数字)
❌ "30 天"     (中间有空格)
❌ "30天以内"  (要求精确的"30天")
```

**常用的REGEX模式**:

| 模式 | 含义 | 匹配例子 |
|------|------|---------|
| `\\d{1,3}天` | 1-3位数字+天 | 30天、15天、365天 |
| `\\d{1,2}[个月]` | 1-2位数字+个或月 | 6个、12月 |
| `[A-Z]+` | 一个或多个大写字母 | ABC、HIGH、MEDIUM |
| `甲方.*乙方` | 甲方...任意内容...乙方 | 甲方应协助乙方 |
| `(30\|60\|90)天` | 30天或60天或90天 | 30天、60天、90天 |

---

## 🔄 matchIndex - 匹配索引

### 定义
当文字在段落中**出现多次**时，`matchIndex` 指定**要批注第几个**。

### 用法说明

**基本规则**:
- `matchIndex = 1` - 第1个匹配（默认值）
- `matchIndex = 2` - 第2个匹配
- `matchIndex = 3` - 第3个匹配
- ...以此类推

### 实际例子

假设段落中有这样的文字：
```
"甲方应在30天内完成交付，若超过30天则需支付违约金。
在60天内甲方未支付款项，乙方有权解除合同。"
```

#### 情景1：您要批注"第一个'30天'"

```json
{
  "targetText": "30天",
  "matchPattern": "CONTAINS",
  "matchIndex": 1
}
```

**结果**:
```
"甲方应在[30天]内完成交付，..."
       ↑ 只有这个被批注
```

#### 情景2：您要批注"第二个'30天'"

```json
{
  "targetText": "30天",
  "matchPattern": "CONTAINS",
  "matchIndex": 2
}
```

**结果**:
```
"...若超过[30天]则需支付违约金。"
        ↑ 这个被批注
```

#### 情景3：您要批注"60天"

```json
{
  "targetText": "60天",
  "matchPattern": "CONTAINS",
  "matchIndex": 1
}
```

**结果**:
```
"在[60天]内甲方未支付款项..."
   ↑ 唯一的"60天"被批注
```

---

## 🎨 三种模式对比

### 直观对比表

| matchPattern | 严格程度 | 灵活性 | 适用场景 | 例子 |
|---|---|---|---|---|
| **EXACT** | 严格 ⭐⭐⭐ | 低 | 标题、唯一短语 | "五、保密与数据安全" |
| **CONTAINS** | 中等 ⭐⭐ | 中 | 关键词、短语 | "全部经济损失" |
| **REGEX** | 灵活 ⭐ | 高 | 复杂模式 | `\d{1,3}天` |

### 选择指南

```
❓ 如何选择matchPattern？

第1步: 问自己这个问题
  "我要批注的文字在段落中出现多次吗？"

  ✅ 是 → 考虑用REGEX或CONTAINS
  ❌ 否 → 用EXACT

第2步: 根据格式统一性
  "这个文字的格式是否固定？"

  ✅ 固定（如章节标题） → 用EXACT
  ⚠️ 可能变化（如时间表达） → 用REGEX

第3步: 根据关键词长度
  "我要批注的是完整短语还是关键词？"

  ✅ 完整短语 → 用EXACT
  ⚠️ 只是关键词 → 用CONTAINS或REGEX
```

---

## 💡 实战例子

### 例子1：金额条款

**文档内容**:
```
合同总额为500万元，其中：
- 首付款100万元
- 中期款200万元
- 尾款200万元
```

**需求**: 批注"首付款100万元"

**方案**:
```json
{
  "targetText": "首付款100万元",
  "matchPattern": "EXACT",
  "matchIndex": 1
}
```

**结果**: ✅ 精确匹配到"首付款100万元"

---

### 例子2：时间条款

**文档内容**:
```
甲方应在15天内交付初稿，
30天内完成全部交付，
60天内乙方应完成审核。
```

**需求**: 批注所有的时间要求

**方案1** - 批注"15天":
```json
{
  "targetText": "\\d{1,2}天",
  "matchPattern": "REGEX",
  "matchIndex": 1  // 第1个匹配"15天"
}
```

**方案2** - 批注"30天":
```json
{
  "targetText": "\\d{1,2}天",
  "matchPattern": "REGEX",
  "matchIndex": 2  // 第2个匹配"30天"
}
```

**方案3** - 批注"60天":
```json
{
  "targetText": "\\d{1,2}天",
  "matchPattern": "REGEX",
  "matchIndex": 3  // 第3个匹配"60天"
}
```

**结果**: ✅ 每个时间都能精确定位

---

### 例子3：关键词查找

**文档内容**:
```
甲方对乙方的违约责任包括：
1. 未按时交付导致的直接损失
2. 因泄密造成的经济损失
3. 由此引发的所有经济损失及间接损失
```

**需求**: 批注所有提到"经济损失"的地方

**方案**:
```json
{
  "targetText": "经济损失",
  "matchPattern": "CONTAINS",
  "matchIndex": 1  // 第1个"经济损失"
}
```

如果要批注第2个：
```json
{
  "targetText": "经济损失",
  "matchPattern": "CONTAINS",
  "matchIndex": 2  // 第2个"经济损失"
}
```

**结果**: ✅ 可以分别批注不同位置的相同短语

---

## 🔧 常见配置组合

### 组合1：标题定位（最常见）

```json
{
  "targetText": "五、保密与数据安全",
  "matchPattern": "EXACT",
  "matchIndex": 1
}
```

**特点**: 精确匹配章节标题

---

### 组合2：关键词定位

```json
{
  "targetText": "全部经济损失",
  "matchPattern": "CONTAINS",
  "matchIndex": 1
}
```

**特点**: 只要包含这个短语就匹配

---

### 组合3：灵活模式定位

```json
{
  "targetText": "[0-9]+个工作日",
  "matchPattern": "REGEX",
  "matchIndex": 1
}
```

**特点**: 可以匹配"7个工作日"、"10个工作日"等

---

### 组合4：多次匹配选择

```json
{
  "targetText": "30天",
  "matchPattern": "CONTAINS",
  "matchIndex": 2  // 选择第2个"30天"
}
```

**特点**: 同一文字出现多次时，选择其中一个

---

## 📊 annotate_PRECISE.json中的配置

让我们看看实际的配置：

```json
{
  "clauseId": "c7",
  "targetText": "首付款：合同签订后7个工作日内支付30%",
  "matchPattern": "CONTAINS"    // ← 使用包含模式
}
// matchIndex: 不设置，默认为1（第1个匹配）

{
  "clauseId": "c16",
  "targetText": "全部经济损失",
  "matchPattern": "CONTAINS"    // ← 使用包含模式
}
// matchIndex: 不设置，默认为1

{
  "clauseId": "c11",
  "targetText": "五、保密与数据安全",
  "matchPattern": "EXACT"       // ← 使用精确模式
}
// matchIndex: 不设置，因为这是唯一的
```

---

## ✅ 总结表

| 字段 | 作用 | 默认值 | 例子 |
|------|------|--------|------|
| **matchPattern** | 指定**如何**匹配文字 | EXACT | EXACT、CONTAINS、REGEX |
| **matchIndex** | 多个匹配时选**第几个** | 1 | 1、2、3... |

---

## 🎯 快速决策流程

```
想要批注某个文字

↓
第1步：选择matchPattern
  ├─ 固定格式、唯一出现 → EXACT
  ├─ 关键词、可能多次 → CONTAINS
  └─ 复杂模式、需正则 → REGEX

↓
第2步：选择matchIndex
  ├─ 文字只出现1次 → 1（默认）
  ├─ 文字出现多次 → 2、3、4...（选择要批注的那个）
  └─ 不确定 → 先试1，不行再改
```

---

## 💻 实战测试

想亲自体验吗？

```bash
# 使用EXACT模式
{
  "targetText": "五、保密与数据安全",
  "matchPattern": "EXACT"
}

# 使用CONTAINS模式
{
  "targetText": "保密与数据安全",
  "matchPattern": "CONTAINS"
}

# 使用REGEX模式
{
  "targetText": ".*保密.*",
  "matchPattern": "REGEX"
}
```

都会批注到关于保密的条款，但精确程度不同。

---

**记住这一点**:
- `matchPattern` = **如何找**（严格程度）
- `matchIndex` = **找第几个**（多个匹配时选择）

两者配合使用，可以精确定位任何您要批注的文字！
