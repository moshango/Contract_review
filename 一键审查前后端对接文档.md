# ä¸€é”®å®¡æŸ¥åŠŸèƒ½å‰åç«¯å¯¹æ¥æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

**ç›®æ ‡**ï¼šå‰ç«¯Vue3åº”ç”¨å¯¹æ¥åç«¯Spring Bootçš„ä¸€é”®å®¡æŸ¥API  
**ç‰ˆæœ¬**ï¼šv1.0  
**æœ€åæ›´æ–°**ï¼š2025-11-03  
**é€‚ç”¨åœºæ™¯**ï¼šåˆåŒä¸Šä¼  â†’ è‡ªåŠ¨å®¡æŸ¥ â†’ è¿”å›æ‰¹æ³¨ç»“æœ

---

## ğŸ¯ æ ¸å¿ƒæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸€é”®å®¡æŸ¥å®Œæ•´æµç¨‹                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  ã€æ­¥éª¤1ã€‘ç”¨æˆ·ä¸Šä¼ åˆåŒæ–‡ä»¶                                â”‚
â”‚     â†“                                                    â”‚
â”‚  ã€æ­¥éª¤2ã€‘å‰ç«¯ï¼šè°ƒç”¨è§£æAPIï¼ˆè·å–ç”²ä¹™æ–¹ä¿¡æ¯ï¼‰              â”‚
â”‚     â”‚  POST /api/parse?anchors=generate                 â”‚
â”‚     â”‚  FormData: { file }                               â”‚
â”‚     â†“                                                    â”‚
â”‚  ã€æ­¥éª¤3ã€‘åç«¯ï¼šè¿”å›è§£æç»“æœ                               â”‚
â”‚     â”‚  { filename, partyA, partyB, clauses }            â”‚
â”‚     â†“                                                    â”‚
â”‚  ã€æ­¥éª¤4ã€‘å‰ç«¯ï¼šå±•ç¤ºç”²ä¹™æ–¹ï¼Œç”¨æˆ·é€‰æ‹©ç«‹åœº                    â”‚
â”‚     â”‚  ç”¨æˆ·é€‰æ‹©ï¼šç”²æ–¹ / ä¹™æ–¹ / ä¸­ç«‹                      â”‚
â”‚     â†“                                                    â”‚
â”‚  ã€æ­¥éª¤5ã€‘å‰ç«¯ï¼šè°ƒç”¨ä¸€é”®å®¡æŸ¥API                            â”‚
â”‚     â”‚  POST /api/qwen/rule-review/one-click-review      â”‚
â”‚     â”‚  FormData: { file, stance }                       â”‚
â”‚     â†“                                                    â”‚
â”‚  ã€æ­¥éª¤6ã€‘åç«¯ï¼šè§„åˆ™åŒ¹é… â†’ AIå®¡æŸ¥ â†’ ç”Ÿæˆæ‰¹æ³¨æ–‡æ¡£           â”‚
â”‚     â”‚  è€—æ—¶ï¼š5-10ç§’                                      â”‚
â”‚     â†“                                                    â”‚
â”‚  ã€æ­¥éª¤7ã€‘åç«¯ï¼šè¿”å›JSONå“åº”                               â”‚
â”‚     â”‚  {                                                 â”‚
â”‚     â”‚    success: true,                                 â”‚
â”‚     â”‚    minioUrl: "æ–‡æ¡£åœ¨çº¿é¢„è§ˆURL",                    â”‚
â”‚     â”‚    originalUrl: "åŸå§‹æ–‡æ¡£URL",                     â”‚
â”‚     â”‚    issuesCount: 5                                 â”‚
â”‚     â”‚  }                                                 â”‚
â”‚     â†“                                                    â”‚
â”‚  ã€æ­¥éª¤8ã€‘å‰ç«¯ï¼šè·³è½¬åˆ°åœ¨çº¿é¢„è§ˆé¡µé¢                         â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¡ APIæ¥å£è¯¦æƒ…

### æ¥å£1ï¼šåˆåŒè§£æï¼ˆè·å–ç”²ä¹™æ–¹ä¿¡æ¯ï¼‰

#### åŸºæœ¬ä¿¡æ¯

- **æ¥å£åœ°å€**ï¼š`POST /api/parse`
- **Content-Type**ï¼š`multipart/form-data`
- **ç”¨é€”**ï¼šè§£æåˆåŒï¼Œæå–ç”²ä¹™æ–¹ä¿¡æ¯ï¼Œç”Ÿæˆé”šç‚¹

#### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| file | File | âœ… | åˆåŒæ–‡ä»¶ï¼ˆ.docx/.docï¼‰ |
| anchors | String | âœ… | å›ºå®šå€¼ï¼š"generate" |
| returnMode | String | âŒ | å›ºå®šå€¼ï¼š"json"ï¼ˆé»˜è®¤ï¼‰ |

#### è¯·æ±‚ç¤ºä¾‹

```javascript
// Vue3 + Element Plus
const uploadUrl = '/api/parse'

<ElUpload
  :action="uploadUrl"
  :data="{ anchors: 'generate', returnMode: 'json' }"
  :on-success="handleUploadSuccess"
  :before-upload="beforeUpload"
  accept=".docx,.doc"
>
  <el-button type="primary">é€‰æ‹©æ–‡ä»¶</el-button>
</ElUpload>

// æˆ–ä½¿ç”¨åŸç”Ÿ fetch
const formData = new FormData()
formData.append('file', file)
formData.append('anchors', 'generate')
formData.append('returnMode', 'json')

const response = await fetch('/api/parse', {
  method: 'POST',
  body: formData
})
const result = await response.json()
```

#### å“åº”æ ¼å¼

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰**ï¼š

```json
{
  "filename": "æŠ€æœ¯æœåŠ¡åè®®.docx",
  "title": "æŠ€æœ¯æœåŠ¡åè®®",
  "partyA": "å¹¿è¥¿å•†èª‰çŒ«ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸",
  "partyB": "ä¸­å›½é“¶è”è‚¡ä»½æœ‰é™å…¬å¸å¹¿è¥¿åˆ†å…¬å¸",
  "clauses": [
    {
      "id": "clause_1",
      "anchorId": "anc-c1-a1b2c3",
      "heading": "ç¬¬ä¸€æ¡ å®šä¹‰",
      "fullText": "æœ¬åè®®ä¸­çš„æœ¯è¯­å®šä¹‰å¦‚ä¸‹...",
      "startParagraphIndex": 5,
      "endParagraphIndex": 7
    }
  ],
  "meta": {
    "wordCount": 3500,
    "paragraphCount": 45
  }
}
```

**å¤±è´¥å“åº”ï¼ˆ400/500ï¼‰**ï¼š

```json
{
  "error": "æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ",
  "message": "ä»…æ”¯æŒ .docx å’Œ .doc æ ¼å¼"
}
```

---

### æ¥å£2ï¼šä¸€é”®å®¡æŸ¥

#### åŸºæœ¬ä¿¡æ¯

- **æ¥å£åœ°å€**ï¼š`POST /api/qwen/rule-review/one-click-review`
- **Content-Type**ï¼š`multipart/form-data`
- **ç”¨é€”**ï¼šæ‰§è¡Œå®Œæ•´çš„åˆåŒå®¡æŸ¥æµç¨‹
- **è€—æ—¶**ï¼š5-10ç§’ï¼ˆå–å†³äºåˆåŒé•¿åº¦å’Œå¤æ‚åº¦ï¼‰

#### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| file | File | âœ… | åˆåŒæ–‡ä»¶ï¼ˆ.docx/.docï¼‰ | - |
| stance | String | âŒ | å®¡æŸ¥ç«‹åœº | "Aæ–¹"/"Bæ–¹"/"neutral" |

**stance å‚æ•°è¯´æ˜**ï¼š

| å€¼ | è¯´æ˜ | å®¡æŸ¥è§’åº¦ |
|----|------|---------|
| `neutral` | ä¸­ç«‹ï¼ˆé»˜è®¤ï¼‰ | å®¢è§‚å…¨é¢å®¡æŸ¥ |
| `A` æˆ– `Aæ–¹` æˆ– `ç”²æ–¹` | ç”²æ–¹è§†è§’ | é‡ç‚¹å…³æ³¨ç”²æ–¹é£é™© |
| `B` æˆ– `Bæ–¹` æˆ– `ä¹™æ–¹` | ä¹™æ–¹è§†è§’ | é‡ç‚¹å…³æ³¨ä¹™æ–¹é£é™© |

#### è¯·æ±‚ç¤ºä¾‹

```javascript
// æ–¹å¼1ï¼šä½¿ç”¨ FormData + fetch
async function submitReview(file, stance) {
  const formData = new FormData()
  formData.append('file', file)
  formData.append('stance', stance || 'neutral')

  try {
    const response = await fetch('/api/qwen/rule-review/one-click-review', {
      method: 'POST',
      body: formData
    })

    if (!response.ok) {
      throw new Error('å®¡æŸ¥è¯·æ±‚å¤±è´¥')
    }

    const result = await response.json()
    return result
  } catch (error) {
    console.error('å®¡æŸ¥å¤±è´¥:', error)
    throw error
  }
}

// è°ƒç”¨ç¤ºä¾‹
const result = await submitReview(fileObject, 'Aæ–¹')
```

```javascript
// æ–¹å¼2ï¼šä½¿ç”¨ axios
import axios from 'axios'

async function submitReview(file, stance) {
  const formData = new FormData()
  formData.append('file', file)
  formData.append('stance', stance || 'neutral')

  try {
    const response = await axios.post(
      '/api/qwen/rule-review/one-click-review',
      formData,
      {
        headers: {
          'Content-Type': 'multipart/form-data'
        },
        timeout: 60000  // 60ç§’è¶…æ—¶
      }
    )
    return response.data
  } catch (error) {
    console.error('å®¡æŸ¥å¤±è´¥:', error)
    throw error
  }
}
```

#### å“åº”æ ¼å¼

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰- æœ‰MinIOé›†æˆ**ï¼š

```json
{
  "success": true,
  "message": "åˆåŒå®¡æŸ¥å®Œæˆ",
  "filename": "æŠ€æœ¯æœåŠ¡åè®®_ä¸€é”®å®¡æŸ¥_Aæ–¹_20251103_145030.docx",
  "fileSize": 245678,
  "issuesCount": 5,
  "processingTime": 8234,
  "minioUrl": "http://127.0.0.1:9000/contract-review/reports/æŠ€æœ¯æœåŠ¡åè®®_ä¸€é”®å®¡æŸ¥_Aæ–¹.docx",
  "originalUrl": "http://127.0.0.1:9000/contract-review/contracts/æŠ€æœ¯æœåŠ¡åè®®.docx",
  "savedToMinio": true
}
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰- æœªå‘½ä¸­è§„åˆ™**ï¼š

```json
{
  "success": true,
  "message": "æœªå‘½ä¸­ä»»ä½•è§„åˆ™ï¼Œå·²è·³è¿‡LLMå¹¶ä¿å­˜åŸæ–‡æ¡£",
  "issuesCount": 0,
  "processingTime": 1234,
  "minioUrl": "http://127.0.0.1:9000/contract-review/reports/æŠ€æœ¯æœåŠ¡åè®®_ä¸€é”®å®¡æŸ¥_æœªå‘½ä¸­è§„åˆ™.docx",
  "originalUrl": "http://127.0.0.1:9000/contract-review/contracts/æŠ€æœ¯æœåŠ¡åè®®.docx",
  "savedToMinio": true
}
```

**å¤±è´¥å“åº”ï¼ˆ400ï¼‰**ï¼š

```json
{
  "success": false,
  "error": "æ–‡ä»¶ä¸èƒ½ä¸ºç©º"
}
```

```json
{
  "success": false,
  "error": "ä»…æ”¯æŒ .docx å’Œ .doc æ ¼å¼"
}
```

**å¤±è´¥å“åº”ï¼ˆ500ï¼‰**ï¼š

```json
{
  "success": false,
  "error": "ä¸€é”®å®¡æŸ¥å¤±è´¥: QwenæœåŠ¡ä¸å¯ç”¨",
  "timestamp": 1698734567890
}
```

---

## ğŸ¨ å‰ç«¯å®Œæ•´å®ç°

### Vue3 ç»„åˆå¼APIå®ç°

```vue
<template>
  <div class="contract-review">
    <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
    <ElSteps :active="currentStep" finish-status="success">
      <ElStep title="ä¸Šä¼ æ–‡ä»¶" />
      <ElStep title="é€‰æ‹©ç«‹åœº" />
      <ElStep title="å®¡æŸ¥ä¸­" />
      <ElStep title="æŸ¥çœ‹ç»“æœ" />
    </ElSteps>

    <!-- æ­¥éª¤1: ä¸Šä¼ æ–‡ä»¶ -->
    <div v-if="currentStep === 0" class="step-content">
      <ElUpload
        drag
        :auto-upload="true"
        :action="uploadUrl"
        :data="uploadData"
        :on-success="handleParseSuccess"
        :on-error="handleParseError"
        :before-upload="beforeUpload"
        accept=".docx,.doc"
      >
        <el-icon class="el-icon--upload"><upload-filled /></el-icon>
        <div class="el-upload__text">
          æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ï¼Œæˆ–<em>ç‚¹å‡»ä¸Šä¼ </em>
        </div>
        <template #tip>
          <div class="el-upload__tip">
            æ”¯æŒ .docx å’Œ .doc æ ¼å¼ï¼Œæ–‡ä»¶å¤§å°ä¸è¶…è¿‡ 50MB
          </div>
        </template>
      </ElUpload>
    </div>

    <!-- æ­¥éª¤2: é€‰æ‹©ç«‹åœº -->
    <div v-else-if="currentStep === 1" class="step-content">
      <div class="party-info">
        <h3>è¯†åˆ«åˆ°çš„åˆåŒåŒæ–¹</h3>
        <div class="party-cards">
          <div 
            class="party-card"
            :class="{ active: selectedStance === 'A' }"
            @click="selectedStance = 'A'"
          >
            <div class="party-label">ç”²æ–¹</div>
            <div class="party-name">{{ partyA || 'æœªè¯†åˆ«' }}</div>
            <div class="party-action">
              <span v-if="selectedStance === 'A'" class="current">âœ“ å·²é€‰æ‹©</span>
              <a v-else>é€‰æ‹©æ­¤ç«‹åœº</a>
            </div>
          </div>
          <div 
            class="party-card"
            :class="{ active: selectedStance === 'B' }"
            @click="selectedStance = 'B'"
          >
            <div class="party-label">ä¹™æ–¹</div>
            <div class="party-name">{{ partyB || 'æœªè¯†åˆ«' }}</div>
            <div class="party-action">
              <span v-if="selectedStance === 'B'" class="current">âœ“ å·²é€‰æ‹©</span>
              <a v-else>é€‰æ‹©æ­¤ç«‹åœº</a>
            </div>
          </div>
          <div 
            class="party-card neutral"
            :class="{ active: selectedStance === 'neutral' }"
            @click="selectedStance = 'neutral'"
          >
            <div class="party-label">ä¸­ç«‹</div>
            <div class="party-name">å®¢è§‚å…¨é¢å®¡æŸ¥</div>
            <div class="party-action">
              <span v-if="selectedStance === 'neutral'" class="current">âœ“ å·²é€‰æ‹©</span>
              <a v-else>é€‰æ‹©æ­¤ç«‹åœº</a>
            </div>
          </div>
        </div>
      </div>

      <div class="action-buttons">
        <ElButton @click="currentStep = 0">ä¸Šä¸€æ­¥</ElButton>
        <ElButton 
          type="primary" 
          :disabled="!selectedStance"
          @click="startReview"
        >
          å¼€å§‹å®¡æŸ¥
        </ElButton>
      </div>
    </div>

    <!-- æ­¥éª¤3: å®¡æŸ¥ä¸­ -->
    <div v-else-if="currentStep === 2" class="step-content">
      <div class="review-progress">
        <ElProgress 
          :percentage="progress" 
          :status="progressStatus"
          :stroke-width="20"
        />
        <div class="progress-text">{{ progressText }}</div>
      </div>
    </div>

    <!-- æ­¥éª¤4: å®¡æŸ¥å®Œæˆ -->
    <div v-else-if="currentStep === 3" class="step-content">
      <ElResult
        icon="success"
        title="å®¡æŸ¥å®Œæˆ"
        :sub-title="`æ£€å‡º ${issuesCount} ä¸ªé—®é¢˜ï¼Œè€—æ—¶ ${processingTime}ms`"
      >
        <template #extra>
          <ElButton type="primary" @click="viewResult">æŸ¥çœ‹å®¡æŸ¥ç»“æœ</ElButton>
          <ElButton @click="downloadResult">ä¸‹è½½æ–‡æ¡£</ElButton>
          <ElButton @click="reset">é‡æ–°å®¡æŸ¥</ElButton>
        </template>
      </ElResult>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, computed } from 'vue'
import { ElMessage } from 'element-plus'
import { UploadFilled } from '@element-plus/icons-vue'
import dayjs from 'dayjs'

// ==================== çŠ¶æ€ç®¡ç† ====================

const currentStep = ref(0)
const uploadUrl = ref('/api/parse')
const uploadData = reactive({
  anchors: 'generate',
  returnMode: 'json'
})

// è§£æç»“æœ
const parseResult = ref<any>(null)
const partyA = ref('')
const partyB = ref('')
const uploadedFile = ref<File | null>(null)

// ç«‹åœºé€‰æ‹©
const selectedStance = ref<'A' | 'B' | 'neutral'>('')

// å®¡æŸ¥è¿›åº¦
const progress = ref(0)
const progressStatus = ref<'success' | 'exception' | 'warning' | ''>('')
const progressText = ref('å‡†å¤‡ä¸­...')

// å®¡æŸ¥ç»“æœ
const reviewResult = ref<any>(null)
const issuesCount = ref(0)
const processingTime = ref(0)

// ==================== æ­¥éª¤1: æ–‡ä»¶ä¸Šä¼  ====================

const beforeUpload = (file: File) => {
  // éªŒè¯æ–‡ä»¶ç±»å‹
  const allowedTypes = [
    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
    'application/msword'
  ]
  
  if (!allowedTypes.includes(file.type)) {
    ElMessage.error('åªæ”¯æŒ .docx å’Œ .doc æ ¼å¼çš„æ–‡ä»¶')
    return false
  }

  // éªŒè¯æ–‡ä»¶å¤§å°
  const maxSize = 50 * 1024 * 1024 // 50MB
  if (file.size > maxSize) {
    ElMessage.error('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 50MB')
    return false
  }

  uploadedFile.value = file
  return true
}

const handleParseSuccess = (response: any) => {
  console.log('è§£ææˆåŠŸ:', response)
  
  if (response && response.filename) {
    parseResult.value = response
    partyA.value = response.partyA || 'æœªè¯†åˆ«'
    partyB.value = response.partyB || 'æœªè¯†åˆ«'
    
    ElMessage.success('æ–‡ä»¶è§£ææˆåŠŸ')
    currentStep.value = 1 // è¿›å…¥ç«‹åœºé€‰æ‹©
  } else {
    ElMessage.error('æ–‡ä»¶è§£æå¤±è´¥')
  }
}

const handleParseError = (error: any) => {
  console.error('è§£æå¤±è´¥:', error)
  ElMessage.error('æ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·é‡è¯•')
}

// ==================== æ­¥éª¤2: å¼€å§‹å®¡æŸ¥ ====================

const startReview = async () => {
  if (!uploadedFile.value || !selectedStance.value) {
    ElMessage.error('è¯·å…ˆä¸Šä¼ æ–‡ä»¶å¹¶é€‰æ‹©ç«‹åœº')
    return
  }

  currentStep.value = 2 // è¿›å…¥å®¡æŸ¥ä¸­çŠ¶æ€

  // æ¨¡æ‹Ÿè¿›åº¦æ›´æ–°
  simulateProgress()

  try {
    // è°ƒç”¨ä¸€é”®å®¡æŸ¥API
    const formData = new FormData()
    formData.append('file', uploadedFile.value)
    formData.append('stance', selectedStance.value === 'A' ? 'Aæ–¹' : 
                               selectedStance.value === 'B' ? 'Bæ–¹' : 'neutral')

    const response = await fetch('/api/qwen/rule-review/one-click-review', {
      method: 'POST',
      body: formData
    })

    if (!response.ok) {
      throw new Error('å®¡æŸ¥è¯·æ±‚å¤±è´¥')
    }

    const result = await response.json()
    
    if (result.success) {
      // å®¡æŸ¥æˆåŠŸ
      reviewResult.value = result
      issuesCount.value = result.issuesCount || 0
      processingTime.value = result.processingTime || 0
      
      progress.value = 100
      progressStatus.value = 'success'
      progressText.value = 'å®¡æŸ¥å®Œæˆï¼'
      
      setTimeout(() => {
        currentStep.value = 3 // æ˜¾ç¤ºç»“æœ
      }, 500)
      
      ElMessage.success('åˆåŒå®¡æŸ¥å®Œæˆ')
    } else {
      throw new Error(result.error || 'å®¡æŸ¥å¤±è´¥')
    }
  } catch (error: any) {
    console.error('å®¡æŸ¥å¤±è´¥:', error)
    progress.value = 100
    progressStatus.value = 'exception'
    progressText.value = 'å®¡æŸ¥å¤±è´¥ï¼š' + error.message
    ElMessage.error('å®¡æŸ¥å¤±è´¥ï¼š' + error.message)
  }
}

// æ¨¡æ‹Ÿè¿›åº¦æ›´æ–°
const simulateProgress = () => {
  progress.value = 0
  progressText.value = 'æ­£åœ¨è§£æåˆåŒ...'
  
  const interval = setInterval(() => {
    if (progress.value < 90) {
      progress.value += 10
      
      if (progress.value === 20) {
        progressText.value = 'æ­£åœ¨åŒ¹é…è§„åˆ™...'
      } else if (progress.value === 40) {
        progressText.value = 'æ­£åœ¨è°ƒç”¨AIå®¡æŸ¥...'
      } else if (progress.value === 60) {
        progressText.value = 'æ­£åœ¨ç”Ÿæˆæ‰¹æ³¨...'
      } else if (progress.value === 80) {
        progressText.value = 'æ­£åœ¨ä¿å­˜æ–‡æ¡£...'
      }
    } else {
      clearInterval(interval)
    }
  }, 800)
}

// ==================== æ­¥éª¤3: æŸ¥çœ‹ç»“æœ ====================

const viewResult = () => {
  if (!reviewResult.value || !reviewResult.value.minioUrl) {
    ElMessage.error('æ²¡æœ‰å¯æŸ¥çœ‹çš„ç»“æœ')
    return
  }

  // æ‰“å¼€æ–°çª—å£æŸ¥çœ‹æ–‡æ¡£
  const fileName = reviewResult.value.filename || 'å®¡æŸ¥ç»“æœ.docx'
  const fileUrl = reviewResult.value.minioUrl
  
  const editorUrl = `/#/contract-review/editor?fileUrl=${encodeURIComponent(fileUrl)}&originalFileName=${encodeURIComponent(fileName)}`
  window.open(editorUrl, '_blank')
}

const downloadResult = () => {
  if (!reviewResult.value || !reviewResult.value.minioUrl) {
    ElMessage.error('æ²¡æœ‰å¯ä¸‹è½½çš„æ–‡ä»¶')
    return
  }

  // ä½¿ç”¨ä»£ç†ä¸‹è½½
  const url = reviewResult.value.minioUrl
  const fileName = reviewResult.value.filename || 'å®¡æŸ¥ç»“æœ.docx'
  
  // ä»MinIO URLä¸­æå–objectName
  try {
    const urlObj = new URL(url)
    const pathParts = urlObj.pathname.split('/')
    const objectName = pathParts.slice(2).join('/')
    
    const proxyUrl = `/api/preview/proxy?fileName=${encodeURIComponent(objectName)}`
    const a = document.createElement('a')
    a.href = proxyUrl
    a.download = fileName
    a.click()
  } catch (e) {
    console.error('ä¸‹è½½å¤±è´¥:', e)
    ElMessage.error('ä¸‹è½½å¤±è´¥')
  }
}

const reset = () => {
  currentStep.value = 0
  uploadedFile.value = null
  parseResult.value = null
  selectedStance.value = ''
  reviewResult.value = null
  progress.value = 0
  progressStatus.value = ''
}
</script>

<style scoped lang="scss">
.contract-review {
  padding: 20px;
}

.step-content {
  margin-top: 30px;
  min-height: 400px;
}

.party-info {
  h3 {
    font-size: 18px;
    margin-bottom: 20px;
  }
}

.party-cards {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
}

.party-card {
  border: 2px solid #e4e7ed;
  border-radius: 8px;
  padding: 20px;
  cursor: pointer;
  transition: all 0.3s;
  
  &:hover {
    border-color: #409eff;
    box-shadow: 0 2px 12px rgba(64, 158, 255, 0.2);
  }
  
  &.active {
    border-color: #409eff;
    background: #ecf5ff;
  }
  
  .party-label {
    font-size: 14px;
    color: #909399;
    margin-bottom: 8px;
  }
  
  .party-name {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 12px;
    min-height: 48px;
  }
  
  .party-action {
    .current {
      color: #67c23a;
      font-weight: 600;
    }
    
    a {
      color: #409eff;
      cursor: pointer;
      
      &:hover {
        text-decoration: underline;
      }
    }
  }
}

.action-buttons {
  margin-top: 30px;
  text-align: right;
  
  .el-button {
    margin-left: 12px;
  }
}

.review-progress {
  text-align: center;
  padding: 60px 20px;
  
  .progress-text {
    margin-top: 20px;
    font-size: 16px;
    color: #606266;
  }
}
</style>
```

---

## ğŸ”§ é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯åŠå¤„ç†æ–¹æ¡ˆ

#### 1. æ–‡ä»¶æ ¼å¼é”™è¯¯

**é”™è¯¯**ï¼š
```json
{
  "success": false,
  "error": "ä»…æ”¯æŒ .docx å’Œ .doc æ ¼å¼"
}
```

**å‰ç«¯å¤„ç†**ï¼š
```javascript
if (response.data.error && response.data.error.includes('æ ¼å¼')) {
  ElMessage.error('æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒï¼Œè¯·ä¸Šä¼  .docx æˆ– .doc æ ¼å¼çš„æ–‡ä»¶')
}
```

#### 2. æ–‡ä»¶è¿‡å¤§

**é”™è¯¯**ï¼šHTTP 413 Payload Too Large

**å‰ç«¯å¤„ç†**ï¼š
```javascript
const beforeUpload = (file) => {
  const maxSize = 50 * 1024 * 1024 // 50MB
  if (file.size > maxSize) {
    ElMessage.error('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 50MB')
    return false
  }
  return true
}
```

#### 3. ç½‘ç»œè¶…æ—¶

**é”™è¯¯**ï¼šNetwork Timeout

**å‰ç«¯å¤„ç†**ï¼š
```javascript
const response = await axios.post(url, formData, {
  timeout: 60000, // 60ç§’
  onUploadProgress: (progressEvent) => {
    // æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
    const percentCompleted = Math.round(
      (progressEvent.loaded * 100) / progressEvent.total
    )
    console.log(`ä¸Šä¼ è¿›åº¦: ${percentCompleted}%`)
  }
})
```

#### 4. åç«¯æœåŠ¡ä¸å¯ç”¨

**é”™è¯¯**ï¼š
```json
{
  "success": false,
  "error": "QwenæœåŠ¡æœªé…ç½®æˆ–ä¸å¯ç”¨"
}
```

**å‰ç«¯å¤„ç†**ï¼š
```javascript
if (response.data.error && response.data.error.includes('Qwen')) {
  ElMessage.error('AIå®¡æŸ¥æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•')
}
```

---

## ğŸ“Š çŠ¶æ€ç®¡ç†ç¤ºä¾‹ï¼ˆPiniaï¼‰

å¦‚æœé¡¹ç›®ä½¿ç”¨Piniaè¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼š

```typescript
// stores/contractReview.ts
import { defineStore } from 'pinia'

export const useContractReviewStore = defineStore('contractReview', {
  state: () => ({
    currentStep: 0,
    uploadedFile: null as File | null,
    parseResult: null as any,
    selectedStance: '' as 'A' | 'B' | 'neutral' | '',
    reviewResult: null as any,
    isReviewing: false
  }),

  getters: {
    partyA: (state) => state.parseResult?.partyA || 'æœªè¯†åˆ«',
    partyB: (state) => state.parseResult?.partyB || 'æœªè¯†åˆ«',
    issuesCount: (state) => state.reviewResult?.issuesCount || 0
  },

  actions: {
    async parseContract(file: File) {
      const formData = new FormData()
      formData.append('file', file)
      formData.append('anchors', 'generate')
      formData.append('returnMode', 'json')

      try {
        const response = await fetch('/api/parse', {
          method: 'POST',
          body: formData
        })
        this.parseResult = await response.json()
        this.uploadedFile = file
        this.currentStep = 1
      } catch (error) {
        console.error('è§£æå¤±è´¥:', error)
        throw error
      }
    },

    async startReview() {
      if (!this.uploadedFile || !this.selectedStance) {
        throw new Error('ç¼ºå°‘å¿…è¦å‚æ•°')
      }

      this.isReviewing = true
      this.currentStep = 2

      const formData = new FormData()
      formData.append('file', this.uploadedFile)
      
      const stanceMap = { A: 'Aæ–¹', B: 'Bæ–¹', neutral: 'neutral' }
      formData.append('stance', stanceMap[this.selectedStance])

      try {
        const response = await fetch('/api/qwen/rule-review/one-click-review', {
          method: 'POST',
          body: formData
        })
        this.reviewResult = await response.json()
        this.currentStep = 3
      } catch (error) {
        console.error('å®¡æŸ¥å¤±è´¥:', error)
        throw error
      } finally {
        this.isReviewing = false
      }
    },

    reset() {
      this.$reset()
    }
  }
})
```

ä½¿ç”¨ç¤ºä¾‹ï¼š

```vue
<script setup lang="ts">
import { useContractReviewStore } from '@/stores/contractReview'

const reviewStore = useContractReviewStore()

const handleFileUpload = async (file: File) => {
  try {
    await reviewStore.parseContract(file)
    ElMessage.success('æ–‡ä»¶è§£ææˆåŠŸ')
  } catch (error) {
    ElMessage.error('æ–‡ä»¶è§£æå¤±è´¥')
  }
}

const startReview = async () => {
  try {
    await reviewStore.startReview()
    ElMessage.success('å®¡æŸ¥å®Œæˆ')
  } catch (error) {
    ElMessage.error('å®¡æŸ¥å¤±è´¥')
  }
}
</script>
```

---

## ğŸ§ª æµ‹è¯•æ•°æ®

### Mockæ•°æ®ï¼ˆå¼€å‘è°ƒè¯•ç”¨ï¼‰

```javascript
// mock/contractReview.ts
export default [
  {
    url: '/api/parse',
    method: 'post',
    response: () => {
      return {
        filename: 'æŠ€æœ¯æœåŠ¡åè®®.docx',
        title: 'æŠ€æœ¯æœåŠ¡åè®®',
        partyA: 'å¹¿è¥¿å•†èª‰çŒ«ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸',
        partyB: 'ä¸­å›½é“¶è”è‚¡ä»½æœ‰é™å…¬å¸å¹¿è¥¿åˆ†å…¬å¸',
        clauses: [
          {
            id: 'clause_1',
            anchorId: 'anc-c1-hash',
            heading: 'ç¬¬ä¸€æ¡ æœåŠ¡å†…å®¹',
            fullText: 'ç”²æ–¹å§”æ‰˜ä¹™æ–¹æä¾›æŠ€æœ¯æœåŠ¡...'
          }
        ],
        meta: {
          wordCount: 3500,
          paragraphCount: 45
        }
      }
    }
  },
  {
    url: '/api/qwen/rule-review/one-click-review',
    method: 'post',
    response: () => {
      return {
        success: true,
        message: 'åˆåŒå®¡æŸ¥å®Œæˆ',
        filename: 'æŠ€æœ¯æœåŠ¡åè®®_ä¸€é”®å®¡æŸ¥_Aæ–¹_20251103.docx',
        fileSize: 245678,
        issuesCount: 5,
        processingTime: 8234,
        minioUrl: 'http://localhost:9000/contract-review/reports/test.docx',
        originalUrl: 'http://localhost:9000/contract-review/contracts/test.docx',
        savedToMinio: true
      }
    }
  }
]
```

---

## ğŸ“‹ å¯¹æ¥æ£€æŸ¥æ¸…å•

### å‰ç«¯æ£€æŸ¥é¡¹

- [ ] âœ… å·²å®‰è£…å¿…è¦ä¾èµ–ï¼ˆElement Plusã€axiosç­‰ï¼‰
- [ ] âœ… é…ç½®äº†APIåŸºç¡€è·¯å¾„ï¼ˆbaseURLï¼‰
- [ ] âœ… å®ç°äº†æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
- [ ] âœ… å®ç°äº†ç«‹åœºé€‰æ‹©ç•Œé¢
- [ ] âœ… å®ç°äº†è¿›åº¦æ˜¾ç¤º
- [ ] âœ… å®ç°äº†ç»“æœå±•ç¤º
- [ ] âœ… æ·»åŠ äº†é”™è¯¯å¤„ç†
- [ ] âœ… æ·»åŠ äº†LoadingçŠ¶æ€
- [ ] âœ… æµ‹è¯•äº†å®Œæ•´æµç¨‹

### åç«¯æ£€æŸ¥é¡¹

- [ ] âœ… `/api/parse` æ¥å£æ­£å¸¸è¿”å›
- [ ] âœ… `/api/qwen/rule-review/one-click-review` æ¥å£æ­£å¸¸è¿”å›
- [ ] âœ… MinIOæœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] âœ… Qwen APIé…ç½®æ­£ç¡®
- [ ] âœ… æ–‡ä»¶å¤§å°é™åˆ¶é…ç½®ï¼ˆapplication.propertiesï¼‰
- [ ] âœ… CORSè·¨åŸŸé…ç½®æ­£ç¡®
- [ ] âœ… é”™è¯¯å“åº”æ ¼å¼ç»Ÿä¸€

### è”è°ƒæµ‹è¯•

- [ ] âœ… ä¸Šä¼ .docxæ–‡ä»¶æµ‹è¯•
- [ ] âœ… ä¸Šä¼ .docæ–‡ä»¶æµ‹è¯•
- [ ] âœ… è¶…å¤§æ–‡ä»¶æµ‹è¯•ï¼ˆ>50MBï¼‰
- [ ] âœ… é”™è¯¯æ ¼å¼æ–‡ä»¶æµ‹è¯•
- [ ] âœ… ä¸­æ–‡æ–‡ä»¶åæµ‹è¯•
- [ ] âœ… ç½‘ç»œè¶…æ—¶æµ‹è¯•
- [ ] âœ… å¹¶å‘è¯·æ±‚æµ‹è¯•

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤1ï¼šåç«¯å¯åŠ¨

```bash
cd Contract_review
mvn spring-boot:run
```

éªŒè¯ï¼šè®¿é—® `http://localhost:8080/api/qwen/rule-review/status`

### æ­¥éª¤2ï¼šå‰ç«¯å¯åŠ¨

```bash
cd vue-element-plus-admin
pnpm install
pnpm run dev
```

è®¿é—®ï¼š`http://localhost:3000`

### æ­¥éª¤3ï¼šæµ‹è¯•æµç¨‹

1. è®¿é—®åˆåŒå®¡æŸ¥é¡µé¢
2. ä¸Šä¼ æµ‹è¯•æ–‡ä»¶
3. é€‰æ‹©å®¡æŸ¥ç«‹åœº
4. ç‚¹å‡»å¼€å§‹å®¡æŸ¥
5. ç­‰å¾…å®¡æŸ¥å®Œæˆ
6. æŸ¥çœ‹å®¡æŸ¥ç»“æœ

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. **åç«¯æ—¥å¿—**ï¼šæŸ¥çœ‹ `Contract_review` æ§åˆ¶å°è¾“å‡º
2. **å‰ç«¯æ§åˆ¶å°**ï¼šæŸ¥çœ‹æµè§ˆå™¨ Console å’Œ Network
3. **APIæ–‡æ¡£**ï¼šå‚è€ƒ `Contract_review/æ–‡æ¡£ä¸­å¿ƒ/01_APIæ¥å£è¯´æ˜/`

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æœ€åæ›´æ–°**ï¼š2025-11-03  
**ç»´æŠ¤äººå‘˜**ï¼šå¼€å‘å›¢é˜Ÿ

